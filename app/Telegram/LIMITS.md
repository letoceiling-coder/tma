# –õ–∏–º–∏—Ç—ã –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è Telegram Bot API

–í—Å–µ –∫–ª–∞—Å—Å—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –≤ Telegram API.

## üìù –¢–µ–∫—Å—Ç–æ–≤—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### –°–æ–æ–±—â–µ–Ω–∏—è
- **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ —Ç–µ–∫—Å—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏—è**: 4096 —Å–∏–º–≤–æ–ª–æ–≤
- **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –ø–æ–¥–ø–∏—Å–∏ –∫ –º–µ–¥–∏–∞**: 1024 —Å–∏–º–≤–æ–ª–∞
- **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ callback_data**: 64 –±–∞–π—Ç–∞
- **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ inline query**: 256 —Å–∏–º–≤–æ–ª–æ–≤

### –ò–º–µ–Ω–∞ –∏ –Ω–∞–∑–≤–∞–Ω–∏—è
- **–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**: –¥–æ 64 —Å–∏–º–≤–æ–ª–æ–≤
- **–§–∞–º–∏–ª–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**: –¥–æ 64 —Å–∏–º–≤–æ–ª–æ–≤
- **–ù–∞–∑–≤–∞–Ω–∏–µ —á–∞—Ç–∞**: –¥–æ 255 —Å–∏–º–≤–æ–ª–æ–≤
- **–û–ø–∏—Å–∞–Ω–∏–µ —á–∞—Ç–∞**: –¥–æ 255 —Å–∏–º–≤–æ–ª–æ–≤
- **–ö–∞—Å—Ç–æ–º–Ω—ã–π —Ç–∏—Ç—É–ª –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞**: –¥–æ 16 —Å–∏–º–≤–æ–ª–æ–≤

### –ö–Ω–æ–ø–∫–∏
- **–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏**: –¥–æ 64 —Å–∏–º–≤–æ–ª–æ–≤
- **URL –≤ –∫–Ω–æ–ø–∫–µ**: –¥–æ 2048 —Å–∏–º–≤–æ–ª–æ–≤
- **–ú–∞–∫—Å–∏–º—É–º –∫–Ω–æ–ø–æ–∫ –≤ —Å—Ç—Ä–æ–∫–µ**: 8
- **–ú–∞–∫—Å–∏–º—É–º —Å—Ç—Ä–æ–∫ –≤ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ**: 100

## üìä –û–ø—Ä–æ—Å—ã

- **–í–æ–ø—Ä–æ—Å**: –¥–æ 300 —Å–∏–º–≤–æ–ª–æ–≤
- **–í–∞—Ä–∏–∞–Ω—Ç –æ—Ç–≤–µ—Ç–∞**: –¥–æ 100 —Å–∏–º–≤–æ–ª–æ–≤
- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤**: –æ—Ç 2 –¥–æ 10
- **–û–±—ä—è—Å–Ω–µ–Ω–∏–µ –≤ quiz**: –¥–æ 200 —Å–∏–º–≤–æ–ª–æ–≤

## üìÅ –ú–µ–¥–∏–∞ —Ñ–∞–π–ª—ã

### –†–∞–∑–º–µ—Ä—ã —Ñ–∞–π–ª–æ–≤
- **–§–æ—Ç–æ**: –¥–æ 10 MB
- **–î–æ–∫—É–º–µ–Ω—Ç**: –¥–æ 50 MB
- **–ê—É–¥–∏–æ**: –¥–æ 50 MB
- **–í–∏–¥–µ–æ**: –¥–æ 50 MB
- **–ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ**: –¥–æ 1 MB
- **–í–∏–¥–µ–æ –∑–∞–º–µ—Ç–∫–∞**: –¥–æ 1 MB
- **–°—Ç–∏–∫–µ—Ä**: –¥–æ 512 KB

### Media Group
- **–ú–∏–Ω–∏–º—É–º —Ñ–∞–π–ª–æ–≤**: 2
- **–ú–∞–∫—Å–∏–º—É–º —Ñ–∞–π–ª–æ–≤**: 10

## ‚ö° Rate Limits (–õ–∏–º–∏—Ç—ã –Ω–∞ —á–∞—Å—Ç–æ—Ç—É –∑–∞–ø—Ä–æ—Å–æ–≤)

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ RateLimiter

- **30 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É** - –æ–±—â–∏–π –ª–∏–º–∏—Ç –∫ Bot API
- **1 —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —Å–µ–∫—É–Ω–¥—É** - –¥–ª—è –æ–¥–Ω–æ–≥–æ —á–∞—Ç–∞
- **20 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –º–∏–Ω—É—Ç—É** - –¥–ª—è –≥—Ä—É–ø–ø
- **30 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Å–µ–∫—É–Ω–¥—É** - –æ–±—â–∏–π –ª–∏–º–∏—Ç –¥–ª—è –≤—Å–µ—Ö —á–∞—Ç–æ–≤

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```php
use App\Telegram\RateLimiter;

$limiter = new RateLimiter();

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–π API –ª–∏–º–∏—Ç
$limiter->checkApiLimit();

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–∏–º–∏—Ç –¥–ª—è —á–∞—Ç–∞
$limiter->checkChatLimit(123456789);

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–∏–º–∏—Ç –¥–ª—è –≥—Ä—É–ø–ø—ã
$limiter->checkGroupLimit(-1001234567890);

// –£–º–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ (–¥–ª—è –º–∞—Å—Å–æ–≤—ã—Ö —Ä–∞—Å—Å—ã–ª–æ–∫)
foreach ($users as $user) {
    $limiter->throttle($user->telegram_id);
    Telegram::send($user->telegram_id, '–°–æ–æ–±—â–µ–Ω–∏–µ');
}
```

## ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è

–í—Å–µ –¥–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π:

```php
use App\Telegram\Telegram;
use App\Telegram\Exceptions\TelegramValidationException;

try {
    // –ï—Å–ª–∏ —Ç–µ–∫—Å—Ç –¥–ª–∏–Ω–Ω–µ–µ 4096 —Å–∏–º–≤–æ–ª–æ–≤ - –≤—ã–±—Ä–æ—Å–∏—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ
    Telegram::send(123456789, str_repeat('A', 5000));
} catch (TelegramValidationException $e) {
    echo $e->getMessage();
    // "Message text is too long (5000 characters). Maximum: 4096"
}
```

## üõ†Ô∏è –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã Validator

### –û–±—Ä–µ–∑–∫–∞ —Ç–µ–∫—Å—Ç–∞

```php
use App\Telegram\Validator;

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–µ–∑–∞—Ç—å –¥–æ –¥–æ–ø—É—Å—Ç–∏–º–æ–π –¥–ª–∏–Ω—ã
$text = str_repeat('A', 5000);
$truncated = Validator::truncateText($text, 4096);
// –†–µ–∑—É–ª—å—Ç–∞—Ç: 4093 —Å–∏–º–≤–æ–ª–∞ + "..."
```

### –†–∞–∑–±–∏–µ–Ω–∏–µ –¥–ª–∏–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞

```php
// –†–∞–∑–±–∏—Ç—å –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–æ–æ–±—â–µ–Ω–∏–π
$longText = file_get_contents('long_article.txt');
$messages = Validator::splitLongText($longText);

foreach ($messages as $message) {
    Telegram::send(123456789, $message);
}
```

## üîç –†—É—á–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è

–ú–æ–∂–Ω–æ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤—Ä—É—á–Ω—É—é –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π:

```php
use App\Telegram\Validator;

// –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
Validator::validateMessageText($text);

// –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å chat_id
Validator::validateChatId('@channel_name');
Validator::validateChatId(123456789);

// –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å URL
Validator::validateUrl('https://example.com');

// –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
Validator::validateLatitude(55.7558);
Validator::validateLongitude(37.6173);

// –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –æ–ø—Ä–æ—Å
Validator::validatePollQuestion('–ö–∞–∫–æ–π —è–∑—ã–∫ –ª—É—á—à–µ?');
Validator::validatePollOptions(['PHP', 'JavaScript', 'Python']);

// –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å callback data
Validator::validateCallbackData('button_clicked');
```

## üìã –ü—Ä–∏–º–µ—Ä—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏

### –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è

```php
use App\Telegram\Telegram;
use App\Telegram\Validator;

$text = "–û—á–µ–Ω—å –¥–ª–∏–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç...";

// –ü—Ä–æ–≤–µ—Ä–∫–∞
if (mb_strlen($text) > 4096) {
    // –û–±—Ä–µ–∑–∞—Ç—å
    $text = Validator::truncateText($text, 4096);
    // –ò–ª–∏ —Ä–∞–∑–±–∏—Ç—å –Ω–∞ —á–∞—Å—Ç–∏
    // $messages = Validator::splitLongText($text);
}

Telegram::send(123456789, $text);
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è chat_id

```php
try {
    // Username –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å @
    Validator::validateChatId('channel'); // ‚ùå –û—à–∏–±–∫–∞
    Validator::validateChatId('@channel'); // ‚úÖ OK
    
    // Username –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 5 –¥–æ 32 —Å–∏–º–≤–æ–ª–æ–≤
    Validator::validateChatId('@abc'); // ‚ùå –û—à–∏–±–∫–∞ (—Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π)
    Validator::validateChatId('@my_channel_123'); // ‚úÖ OK
    
    // –ß–∏—Å–ª–æ–≤–æ–π ID –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ 0
    Validator::validateChatId(0); // ‚ùå –û—à–∏–±–∫–∞
    Validator::validateChatId(123456789); // ‚úÖ OK
    
} catch (TelegramValidationException $e) {
    echo $e->getMessage();
}
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã

```php
use App\Telegram\Keyboard;

$keyboard = Keyboard::inline();

// –¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
$keyboard->button('–û—á–µ–Ω—å –¥–ª–∏–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏...'); // –ï—Å–ª–∏ >64 —Å–∏–º–≤–æ–ª–æ–≤ - –æ—à–∏–±–∫–∞

// URL –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
$keyboard->url('–°–∞–π—Ç', 'invalid-url'); // ‚ùå –û—à–∏–±–∫–∞
$keyboard->url('–°–∞–π—Ç', 'https://example.com'); // ‚úÖ OK

// callback_data –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
$keyboard->callback('–ö–Ω–æ–ø–∫–∞', 'data'); // ‚úÖ OK (–¥–æ 64 –±–∞–π—Ç)
$keyboard->callback('–ö–Ω–æ–ø–∫–∞', str_repeat('A', 65)); // ‚ùå –û—à–∏–±–∫–∞
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç

```php
use App\Telegram\Telegram;

try {
    // –®–∏—Ä–æ—Ç–∞: –æ—Ç -90 –¥–æ 90
    Telegram::bot()->sendLocation(123456789, 100.0, 37.0); // ‚ùå –û—à–∏–±–∫–∞
    Telegram::bot()->sendLocation(123456789, 55.7558, 37.0); // ‚úÖ OK
    
    // –î–æ–ª–≥–æ—Ç–∞: –æ—Ç -180 –¥–æ 180
    Telegram::bot()->sendLocation(123456789, 55.0, 200.0); // ‚ùå –û—à–∏–±–∫–∞
    Telegram::bot()->sendLocation(123456789, 55.0, 37.6173); // ‚úÖ OK
    
} catch (TelegramValidationException $e) {
    echo $e->getMessage();
}
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è parse_mode

```php
try {
    Telegram::send(123456789, '<b>–¢–µ–∫—Å—Ç</b>', [
        'parse_mode' => 'HTML' // ‚úÖ OK
    ]);
    
    Telegram::send(123456789, '*–¢–µ–∫—Å—Ç*', [
        'parse_mode' => 'Markdown' // ‚úÖ OK
    ]);
    
    Telegram::send(123456789, '–¢–µ–∫—Å—Ç', [
        'parse_mode' => 'Invalid' // ‚ùå –û—à–∏–±–∫–∞
    ]);
    
} catch (TelegramValidationException $e) {
    echo $e->getMessage();
}
```

## üö® –ò—Å–∫–ª—é—á–µ–Ω–∏—è

### TelegramValidationException

–í—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:

```php
try {
    Telegram::send(123456789, '');
} catch (TelegramValidationException $e) {
    // "Message text cannot be empty"
}

try {
    Telegram::send(0, '–¢–µ–∫—Å—Ç');
} catch (TelegramValidationException $e) {
    // "Chat ID cannot be 0"
}

try {
    $keyboard = Keyboard::inline()->callback('OK', str_repeat('X', 100));
} catch (TelegramValidationException $e) {
    // "Callback data is too long (100 bytes). Maximum: 64"
}
```

### TelegramException

–í—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ rate limits:

```php
use App\Telegram\RateLimiter;
use App\Telegram\Exceptions\TelegramException;

$limiter = new RateLimiter();

try {
    // –ü–æ–ø—ã—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ 30 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É
    for ($i = 0; $i < 50; $i++) {
        $limiter->checkApiLimit();
    }
} catch (TelegramException $e) {
    // "API rate limit exceeded. Max 30 requests per second."
}
```

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 1. –í—Å–µ–≥–¥–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è

```php
use App\Telegram\Exceptions\TelegramValidationException;

try {
    Telegram::send($chatId, $message);
} catch (TelegramValidationException $e) {
    Log::error('Telegram validation error: ' . $e->getMessage());
    // –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∏–ª–∏ –æ–±—Ä–µ–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
}
```

### 2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã

```php
// –í–º–µ—Å—Ç–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–ª–∏–Ω—ã –≤—Ä—É—á–Ω—É—é
if (mb_strlen($text) > 4096) {
    $text = mb_substr($text, 0, 4093) . '...';
}

// –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ
$text = Validator::truncateText($text, 4096);
```

### 3. –î–ª—è –º–∞—Å—Å–æ–≤—ã—Ö —Ä–∞—Å—Å—ã–ª–æ–∫ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ throttle

```php
$limiter = new RateLimiter();

foreach ($users as $user) {
    $limiter->throttle($user->telegram_id, $isGroup = false);
    
    try {
        Telegram::send($user->telegram_id, $message);
    } catch (\Exception $e) {
        Log::error("Failed to send to {$user->telegram_id}: " . $e->getMessage());
    }
}
```

### 4. –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```php
// –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤–≤–æ–¥–∏—Ç—å —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
$userInput = $request->input('message');

try {
    Validator::validateMessageText($userInput);
    Telegram::send($chatId, $userInput);
} catch (TelegramValidationException $e) {
    return response()->json([
        'error' => '–°–æ–æ–±—â–µ–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ–µ. –ú–∞–∫—Å–∏–º—É–º 4096 —Å–∏–º–≤–æ–ª–æ–≤.'
    ], 422);
}
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- [–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Telegram Bot API](https://core.telegram.org/bots/api)
- [FAQ –ø–æ –ª–∏–º–∏—Ç–∞–º](https://core.telegram.org/bots/faq#my-bot-is-hitting-limits-how-do-i-avoid-this)
- [–õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏](https://core.telegram.org/bots/api#making-requests)

