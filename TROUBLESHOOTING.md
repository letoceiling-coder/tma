# Решение проблем с зависанием команд

## Проблема: Команды зависают при выполнении

### Возможные причины:

1. **Интерактивный режим** - команды ожидают подтверждения
2. **Долгое выполнение** - превышение таймаутов
3. **Блокировки файлов** - процессы удерживают файлы
4. **Проблемы с окружением** - неправильные пути или права доступа

## Решения

### 1. Для npm команд

**Проблема:** `npm run build:admin` зависает

**Решения:**

#### Вариант A: Использовать готовые скрипты
```bash
# Windows
scripts\safe-build-admin.bat

# Linux/Mac
chmod +x scripts/safe-build-admin.sh
./scripts/safe-build-admin.sh
```

#### Вариант B: Добавить флаги в package.json
Обновить `package.json`:
```json
{
  "scripts": {
    "build:admin": "vite build --mode production",
    "build:admin:safe": "cross-env NODE_OPTIONS=--max-old-space-size=4096 vite build --mode production"
  }
}
```

#### Вариант C: Использовать PowerShell с таймаутом
```powershell
$job = Start-Job -ScriptBlock { Set-Location C:\OSPanel\domains\tma; npm run build:admin }
Wait-Job -Job $job -Timeout 300
Receive-Job -Job $job
```

### 2. Для PHP Artisan команд

**Проблема:** `php artisan` зависает

**Решения:**

#### Добавить флаги в команды:
- `--no-interaction` - отключить интерактивный режим
- `--force` - принудительное выполнение без подтверждения
- `--quiet` - минимальный вывод

#### Пример исправления команд:
```php
// В командах использовать
$this->call('migrate', ['--force' => true, '--no-interaction' => true]);
```

### 3. Для Git команд

**Проблема:** `git` зависает

**Решения:**

#### Настроить Git для неинтерактивного режима:
```bash
git config --global core.askPass ""
git config --global credential.helper manager
```

#### Использовать флаги:
- `--no-verify` - пропустить хуки
- `--quiet` - минимальный вывод
- `--no-edit` - не открывать редактор для коммита

### 4. Диагностика проблем

Запустить скрипт диагностики:
```bash
php scripts/check-commands.php
```

Это покажет:
- Версии установленных инструментов
- Наличие блокировок
- Права доступа
- Запущенные процессы

## Рекомендации для автономной работы

### 1. Создать обёртки для команд

Создать файлы:
- `scripts/build-all-safe.bat` / `.sh` - безопасная сборка
- `scripts/deploy-safe.bat` / `.sh` - безопасный деплой
- `scripts/seed-safe.bat` / `.sh` - безопасный seeder

### 2. Использовать неинтерактивные флаги везде

Добавить в все команды:
- `--no-interaction`
- `--force` (где применимо)
- `--quiet` (для уменьшения вывода)

### 3. Установить разумные таймауты

- npm команды: 5-10 минут
- php artisan: 2-5 минут
- git: 1-2 минуты

### 4. Проверять состояние перед выполнением

Перед выполнением команды проверять:
- Наличие блокировок файлов
- Запущенные процессы
- Состояние репозитория

## Быстрые исправления

### Если команда зависла:

1. **Прервать выполнение** (Ctrl+C)
2. **Проверить процессы:**
   ```bash
   # Windows
   tasklist | findstr node
   tasklist | findstr php
   
   # Linux/Mac
   ps aux | grep node
   ps aux | grep php
   ```
3. **Завершить зависшие процессы** при необходимости
4. **Очистить кеши:**
   ```bash
   npm cache clean --force
   php artisan cache:clear
   ```
5. **Повторить с таймаутом**

## Альтернативный подход

Если команды часто зависают, можно:

1. **Выполнять команды вручную** - AI предоставляет инструкции
2. **Использовать готовые скрипты** - созданные заранее
3. **Разбить на этапы** - выполнять по частям с проверками

