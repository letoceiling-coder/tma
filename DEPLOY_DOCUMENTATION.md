# –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥—ã Deploy

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
1. [–û–±–∑–æ—Ä](#–æ–±–∑–æ—Ä)
2. [–õ–æ–∫–∞–ª—å–Ω–∞—è —á–∞—Å—Ç—å (–∫–æ–º–∞–Ω–¥–∞ `php artisan deploy`)](#–ª–æ–∫–∞–ª—å–Ω–∞—è-—á–∞—Å—Ç—å)
3. [–°–µ—Ä–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç—å (API endpoint `/api/deploy`)](#—Å–µ—Ä–≤–µ—Ä–Ω–∞—è-—á–∞—Å—Ç—å)
4. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-–Ω–∞-—Å–µ—Ä–≤–µ—Ä–µ)
5. [–ü—Ä–æ—Ü–µ—Å—Å –¥–µ–ø–ª–æ—è –ø–æ—à–∞–≥–æ–≤–æ](#–ø—Ä–æ—Ü–µ—Å—Å-–¥–µ–ø–ª–æ—è-–ø–æ—à–∞–≥–æ–≤–æ)
6. [–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫](#—É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ-–Ω–µ–ø–æ–ª–∞–¥–æ–∫)

---

## –û–±–∑–æ—Ä

–ö–æ–º–∞–Ω–¥–∞ `php artisan deploy` –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –¥–µ–ø–ª–æ—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä. –û–Ω–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–¥–∞—á–∏:

1. **–õ–æ–∫–∞–ª—å–Ω–æ:**
   - –°–æ–±–∏—Ä–∞–µ—Ç —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ (Vue –∞–¥–º–∏–Ω–∫–∞ –∏ React –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ)
   - –ö–æ–º–º–∏—Ç–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ git
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

2. **–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:**
   - –ü–æ–ª—É—á–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
   - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ composer
   - –í—ã–ø–æ–ª–Ω—è–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
   - –û—á–∏—â–∞–µ—Ç –∫–µ—à–∏
   - –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

---

## –õ–æ–∫–∞–ª—å–Ω–∞—è —á–∞—Å—Ç—å

### –ö–æ–º–∞–Ω–¥–∞: `php artisan deploy`

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `app/Console/Commands/Deploy.php`

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–º–∞–Ω–¥—ã:

```bash
php artisan deploy [–æ–ø—Ü–∏–∏]
```

**–î–æ—Å—Ç—É–ø–Ω—ã–µ –æ–ø—Ü–∏–∏:**
- `--message="—Ç–µ–∫—Å—Ç"` - –ö–∞—Å—Ç–æ–º–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –∫–æ–º–º–∏—Ç–∞
- `--skip-build` - –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Å–±–æ—Ä–∫—É —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
- `--dry-run` - –ü–æ–∫–∞–∑–∞—Ç—å —á—Ç–æ –±—É–¥–µ—Ç —Å–¥–µ–ª–∞–Ω–æ –±–µ–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- `--insecure` - –û—Ç–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
- `--with-seed` - –í—ã–ø–æ–ª–Ω–∏—Ç—å seeders –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è)

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –∫–æ–º–∞–Ω–¥–∞ –ª–æ–∫–∞–ª—å–Ω–æ:

#### –®–∞–≥ 1: –°–±–æ—Ä–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
```bash
npm run build:all
```
- –°–æ–±–∏—Ä–∞–µ—Ç Vue –∞–¥–º–∏–Ω–∫—É –≤ `public/build/`
- –°–æ–±–∏—Ä–∞–µ—Ç React –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ `public/frontend/`
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ —Å–æ–±—Ä–∞–Ω–Ω—ã—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π

#### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ git
```bash
git status --porcelain
```
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–µ—Ç –æ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–∞—Ö (>10MB)
- –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ, –µ—Å–ª–∏ –Ω–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π

#### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ git remote
```bash
git remote -v
```
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ remote `origin`
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç remote, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å URL —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

#### –®–∞–≥ 4: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ git
```bash
git add -f public/build
git add -f public/frontend
git add .
```
- –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –¥–æ–±–∞–≤–ª—è–µ—Ç —Å–æ–±—Ä–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (–¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∏ –≤ .gitignore)
- –î–æ–±–∞–≤–ª—è–µ—Ç –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

#### –®–∞–≥ 5: –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–º–∏—Ç–∞
```bash
git commit -m "Deploy: YYYY-MM-DD HH:MM:SS"
```
- –°–æ–∑–¥–∞–µ—Ç –∫–æ–º–º–∏—Ç —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º –∏–ª–∏ –∫–∞—Å—Ç–æ–º–Ω—ã–º (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–æ `--message`)

#### –®–∞–≥ 6: –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
```bash
git push origin <–≤–µ—Ç–∫–∞>
```
- –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–µ–∫—É—â—É—é –≤–µ—Ç–∫—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —É–¥–∞–ª–µ–Ω–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç upstream, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ

#### –®–∞–≥ 7: –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä

**URL –∑–∞–ø—Ä–æ—Å–∞:** `{DEPLOY_SERVER_URL}/api/deploy`

**–ú–µ—Ç–æ–¥:** `POST`

**–ó–∞–≥–æ–ª–æ–≤–∫–∏:**
```
X-Deploy-Token: {DEPLOY_TOKEN}
Content-Type: application/json
Accept: application/json
User-Agent: WOW-Spin-Deploy/1.0
```

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ (JSON):**
```json
{
  "commit_hash": "abc123...",
  "repository": "https://github.com/letoceiling-coder/tma.git",
  "branch": "main",
  "deployed_by": "username",
  "timestamp": "2025-12-09 16:52:59",
  "run_seeders": false
}
```

**–í–∞–∂–Ω—ã–µ –ø–æ–ª—è:**
- `commit_hash` - —Ö–µ—à –∫–æ–º–º–∏—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –±—ã–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω
- `branch` - —Ç–µ–∫—É—â–∞—è –≤–µ—Ç–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è)
- `run_seeders` - —Ñ–ª–∞–≥ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è seeders –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–ª–æ–∫–∞–ª—å–Ω–æ):

–í —Ñ–∞–π–ª–µ `.env` –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã:

```env
DEPLOY_SERVER_URL=https://avito.siteaccess.ru
DEPLOY_TOKEN=123123123
```

---

## –°–µ—Ä–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç—å

### API Endpoint: `POST /api/deploy`

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `app/Http/Controllers/Api/DeployController.php`

**Middleware:** `deploy.token` (–ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ –¥–µ–ø–ª–æ—è)

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä:

#### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ –¥–µ–ø–ª–æ—è

**Middleware:** `app/Http/Middleware/VerifyDeployToken.php`

–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–∫–µ–Ω –∏–∑:
- –ó–∞–≥–æ–ª–æ–≤–∫–∞ `X-Deploy-Token`
- –ó–∞–≥–æ–ª–æ–≤–∫–∞ `X-Deploy-Secret` (–¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
- –ü–∞—Ä–∞–º–µ—Ç—Ä–∞ `token` –≤ —Ç–µ–ª–µ –∑–∞–ø—Ä–æ—Å–∞
- –ü–∞—Ä–∞–º–µ—Ç—Ä–∞ `secret` –≤ —Ç–µ–ª–µ –∑–∞–ø—Ä–æ—Å–∞

–û–∂–∏–¥–∞–µ–º—ã–π —Ç–æ–∫–µ–Ω –±–µ—Ä–µ—Ç—Å—è –∏–∑:
1. `config('app.deploy_token')`
2. `.env` —Ñ–∞–π–ª–∞ (`DEPLOY_TOKEN` –∏–ª–∏ `DEPLOY_SECRET`)
3. `env('DEPLOY_TOKEN')` –∏–ª–∏ `env('DEPLOY_SECRET')`

#### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ –≤–µ—Ç–∫–∏ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

–°–µ—Ä–≤–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç –≤–µ—Ç–∫—É –∏–∑ –∑–∞–ø—Ä–æ—Å–∞:
```php
$requestedBranch = $request->input('branch');
```

–ï—Å–ª–∏ –≤–µ—Ç–∫–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞, –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —Ç–µ–∫—É—â–∞—è –≤–µ—Ç–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞:
```php
git rev-parse --abbrev-ref HEAD
```

–ï—Å–ª–∏ –∏ —ç—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `main` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.

#### 3. Git Pull

**–ú–µ—Ç–æ–¥:** `handleGitPull($branch)`

–í—ã–ø–æ–ª–Ω—è–µ—Ç:
```bash
git fetch origin <–≤–µ—Ç–∫–∞>
git reset --hard origin/<–≤–µ—Ç–∫–∞>
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ stash –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `git reset --hard` –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- –õ–æ–≥–∏—Ä—É–µ—Ç commit hash –¥–æ –∏ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

#### 4. Composer Install

**–ú–µ—Ç–æ–¥:** `handleComposerInstall()`

**–ü–æ–∏—Å–∫ composer:**
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç `COMPOSER_PATH` –∏–∑ `.env`
2. –ò—â–µ—Ç —á–µ—Ä–µ–∑ `which composer` (—Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ PATH)
3. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø—É—Ç–∏:
   - `/home/d/dsc23ytp/.local/bin/composer`
   - `/usr/local/bin/composer`
   - `/usr/bin/composer`
4. –ü—Ä–æ–±—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `composer` –∏–∑ PATH

**–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ:**
```bash
php8.2 <–ø—É—Ç—å_–∫_composer> install --no-dev --optimize-autoloader --no-interaction --no-scripts
```

–ò–ª–∏ –µ—Å–ª–∏ –ø—É—Ç—å –Ω–µ –Ω–∞–π–¥–µ–Ω:
```bash
composer install --no-dev --optimize-autoloader --no-interaction --no-scripts
```

#### 5. –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–µ–π

**–ú–µ—Ç–æ–¥:** `clearPackageDiscoveryCache()`

```bash
php8.2 artisan package:discover --ansi
```

#### 6. –ú–∏–≥—Ä–∞—Ü–∏–∏

**–ú–µ—Ç–æ–¥:** `runMigrations()`

```bash
php8.2 artisan migrate --force
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `--force` –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ production
- –õ–æ–≥–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–æ–≤—ã—Ö –º–∏–≥—Ä–∞—Ü–∏—è—Ö

#### 7. Seeders (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–ú–µ—Ç–æ–¥:** `runSeeders()`

–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤ –∑–∞–ø—Ä–æ—Å–µ —É–∫–∞–∑–∞–Ω–æ `run_seeders: true`

```bash
php8.2 artisan db:seed --force
```

–ò–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π seeder:
```bash
php8.2 artisan db:seed --class=WheelSectorSeeder --force
```

#### 8. –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–µ–π

**–ú–µ—Ç–æ–¥:** `clearAllCaches()`

–í—ã–ø–æ–ª–Ω—è–µ—Ç:
```bash
php8.2 artisan config:clear
php8.2 artisan cache:clear
php8.2 artisan route:clear
php8.2 artisan view:clear
```

#### 9. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

**–ú–µ—Ç–æ–¥:** `optimizeApplication()`

–í—ã–ø–æ–ª–Ω—è–µ—Ç:
```bash
php8.2 artisan config:cache
php8.2 artisan route:cache
php8.2 artisan view:cache
```

#### 10. –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

**–ú–µ—Ç–æ–¥:** `cleanDevelopmentFiles()`

–£–¥–∞–ª—è–µ—Ç —Ñ–∞–π–ª—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:
- `.phpstorm.meta.php`
- `_ide_helper.php`
- `_ide_helper_models.php`
- `composer.lock` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:

**–£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç (HTTP 200):**
```json
{
  "success": true,
  "message": "–î–µ–ø–ª–æ–π —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω",
  "data": {
    "php_version": "8.2.28",
    "php_path": "php8.2",
    "branch": "main",
    "old_commit_hash": "abc123...",
    "new_commit_hash": "def456...",
    "commit_changed": true,
    "git_pull": "success",
    "composer_install": "success",
    "migrations": {
      "status": "success",
      "message": "–ù–æ–≤—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ"
    },
    "seeders": {
      "status": "skipped",
      "message": "Seeders –ø—Ä–æ–ø—É—â–µ–Ω—ã (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ --with-seed –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è)"
    },
    "cache_cleared": true,
    "optimized": true,
    "deployed_at": "2025-12-09 16:53:18",
    "duration_seconds": 5.05
  }
}
```

**–û—à–∏–±–∫–∞ (HTTP 500):**
```json
{
  "success": false,
  "message": "–û—à–∏–±–∫–∞ –¥–µ–ø–ª–æ—è: <–æ–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏>",
  "data": {
    "error": "<–¥–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏>",
    "branch": "main",
    "deployed_at": "2025-12-09 16:53:18",
    "duration_seconds": 2.5
  }
}
```

---

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Git

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–π –≤–µ—Ç–∫–∏:
```bash
cd ~/avito.siteaccess.ru/public_html
git branch
```

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≤–µ—Ç–∫–∏:
–ï—Å–ª–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `master`, –∞ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ `main`:
```bash
git fetch origin
git branch --set-upstream-to=origin/main master
git reset --hard origin/main
```

–ò–ª–∏ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ `main`:
```bash
git fetch origin
git checkout -b main origin/main
```

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ remote:
```bash
git remote -v
# –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å:
git remote set-url origin https://github.com/letoceiling-coder/tma.git
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Composer

#### –í–∞—Ä–∏–∞–Ω—Ç 1: –õ–æ–∫–∞–ª—å–Ω–∞—è –∫–æ–ø–∏—è –≤ –ø—Ä–æ–µ–∫—Ç–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
cd ~/avito.siteaccess.ru/public_html
mkdir -p bin
cp /home/d/dsc23ytp/.local/bin/composer bin/composer
chmod 755 bin/composer
```

#### –í–∞—Ä–∏–∞–Ω—Ç 2: –£–∫–∞–∑–∞—Ç—å –ø—É—Ç—å –≤ .env

–î–æ–±–∞–≤–∏—Ç—å –≤ `.env`:
```env
COMPOSER_PATH=/home/d/dsc23ytp/.local/bin/composer
```

–ò–ª–∏ –µ—Å–ª–∏ composer –≤ –ø—Ä–æ–µ–∫—Ç–µ:
```env
COMPOSER_PATH=/home/d/dsc23ytp/avito.siteaccess.ru/public_html/bin/composer
```

#### –í–∞—Ä–∏–∞–Ω—Ç 3: –ì–ª–æ–±–∞–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ (—Ç—Ä–µ–±—É–µ—Ç root)

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ composer –≥–ª–æ–±–∞–ª—å–Ω–æ (—Ç—Ä–µ–±—É–µ—Ç sudo)
php8.2 -r "copy('https://getcomposer.org/installer', 'composer-setup.php');"
php8.2 composer-setup.php --install-dir=/usr/local/bin --filename=composer
php8.2 -r "unlink('composer-setup.php');"
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PHP

–î–æ–±–∞–≤–∏—Ç—å –≤ `.env` (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ):
```env
PHP_PATH=php8.2
```

–ò–ª–∏ –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥—Ä—É–≥–æ–π –ø—É—Ç—å:
```env
PHP_PATH=/usr/local/php/cgi/8.2/bin/php
```

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–æ–∫–µ–Ω–∞ –¥–µ–ø–ª–æ—è

–í —Ñ–∞–π–ª–µ `.env` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
```env
DEPLOY_TOKEN=123123123
DEPLOY_SECRET=123123123  # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
```

**–í–∞–∂–Ω–æ:** –¢–æ–∫–µ–Ω –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å —Ç–æ–∫–µ–Ω–æ–º –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º `.env`!

### 5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞

#### Apache: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ .htaccess

–ï—Å–ª–∏ DocumentRoot —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ `public_html` –≤–º–µ—Å—Ç–æ `public_html/public`, —Å–æ–∑–¥–∞—Ç—å `.htaccess` –≤ –∫–æ—Ä–Ω–µ `public_html`:

```apache
<IfModule mod_rewrite.c>
    RewriteEngine On
    
    # –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é public/
    RewriteCond %{REQUEST_URI} !^/public/
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^(.*)$ /public/$1 [L]
    
    # –ï—Å–ª–∏ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç—Å—è –∫–æ—Ä–µ–Ω—å, –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –≤ public/
    RewriteCond %{REQUEST_URI} ^/$
    RewriteRule ^(.*)$ /public/ [L]
</IfModule>
```

#### Nginx: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```nginx
location / {
    try_files $uri $uri/ /public/index.php?$query_string;
}
```

### 6. –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

–£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ –Ω–∞:
- –ß—Ç–µ–Ω–∏–µ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞
- –ó–∞–ø–∏—Å—å –≤ `storage/` –∏ `bootstrap/cache/`
- –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ PHP —Å–∫—Ä–∏–ø—Ç–æ–≤

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞
chmod -R 755 ~/avito.siteaccess.ru/public_html
chmod -R 775 ~/avito.siteaccess.ru/public_html/storage
chmod -R 775 ~/avito.siteaccess.ru/public_html/bootstrap/cache
```

### 7. –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–µ–π –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

```bash
cd ~/avito.siteaccess.ru/public_html
php8.2 artisan config:clear
php8.2 artisan cache:clear
php8.2 artisan route:clear
php8.2 artisan view:clear
```

---

## –ü—Ä–æ—Ü–µ—Å—Å –¥–µ–ø–ª–æ—è –ø–æ—à–∞–≥–æ–≤–æ

### –õ–æ–∫–∞–ª—å–Ω–æ:

1. **–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–ø—É—Å–∫–∞–µ—Ç:**
   ```bash
   php artisan deploy --insecure
   ```

2. **–ö–æ–º–∞–Ω–¥–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç:**
   - –°–±–æ—Ä–∫—É —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ (`npm run build:all`)
   - –ö–æ–º–º–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ git
   - Push –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π (–≤–µ—Ç–∫–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
   - POST –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –∫–æ–º–º–∏—Ç–µ –∏ –≤–µ—Ç–∫–µ

### –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:

1. **API –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å:**
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–∫–µ–Ω –¥–µ–ø–ª–æ—è
   - –ò–∑–≤–ª–µ–∫–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–µ—Ç–∫–µ –∏–∑ –∑–∞–ø—Ä–æ—Å–∞

2. **–í—ã–ø–æ–ª–Ω—è–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:**
   - `git fetch origin <–≤–µ—Ç–∫–∞>`
   - `git reset --hard origin/<–≤–µ—Ç–∫–∞>`
   - `composer install`
   - `php artisan migrate`
   - –û—á–∏—Å—Ç–∫–∞ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫–µ—à–µ–π

3. **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
   - –£—Å–ø–µ—Ö –∏–ª–∏ –æ—à–∏–±–∫–∞
   - –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–∞–∂–¥–æ–º —à–∞–≥–µ

### –í–∏–∑—É–∞–ª—å–Ω–∞—è —Å—Ö–µ–º–∞:

```
–õ–æ–∫–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞                    –°–µ—Ä–≤–µ—Ä
     |                                  |
     | 1. npm run build:all             |
     | 2. git commit                    |
     | 3. git push origin main          |
     |                                  |
     | 4. POST /api/deploy              |
     |    {                              |
     |      branch: "main",              |
     |      commit_hash: "abc123"        |
     |    }                              |
     |--------------------------------->|
     |                                  | 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞
     |                                  | 6. git pull origin main
     |                                  | 7. composer install
     |                                  | 8. php artisan migrate
     |                                  | 9. –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–µ–π
     |                                  |
     |<---------------------------------|
     | HTTP 200: –£—Å–ø–µ—Ö                  |
     |                                  |
```

---

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ü—Ä–æ–±–ª–µ–º–∞: "–ù–µ–≤–µ—Ä–Ω—ã–π —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á" (HTTP 403)

**–ü—Ä–∏—á–∏–Ω–∞:** –¢–æ–∫–µ–Ω –¥–µ–ø–ª–æ—è –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç –∏–ª–∏ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω.

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `DEPLOY_TOKEN` –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º `.env`
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `DEPLOY_TOKEN` –≤ —Å–µ—Ä–≤–µ—Ä–Ω–æ–º `.env`
3. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ç–æ–∫–µ–Ω—ã —Å–æ–≤–ø–∞–¥–∞—é—Ç
4. –û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
   ```bash
   php8.2 artisan config:clear
   ```

### –ü—Ä–æ–±–ª–µ–º–∞: "DEPLOY_TOKEN –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ" (HTTP 500)

**–ü—Ä–∏—á–∏–Ω–∞:** –¢–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

**–†–µ—à–µ–Ω–∏–µ:**
1. –î–æ–±–∞–≤–∏—Ç—å `DEPLOY_TOKEN` –≤ `.env` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
2. –û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à:
   ```bash
   php8.2 artisan config:clear
   php8.2 artisan cache:clear
   ```

### –ü—Ä–æ–±–ª–µ–º–∞: "fatal: couldn't find remote ref main"

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥—Ä—É–≥–∞—è –≤–µ—Ç–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `master`).

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
git fetch origin
git branch --set-upstream-to=origin/main master
git pull
```

–ò–ª–∏ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ `main`:
```bash
git fetch origin
git checkout -b main origin/main
```

### –ü—Ä–æ–±–ª–µ–º–∞: "Could not open input file: composer"

**–ü—Ä–∏—á–∏–Ω–∞:** Composer –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.

**–†–µ—à–µ–Ω–∏–µ:**
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å composer –ª–æ–∫–∞–ª—å–Ω–æ –≤ –ø—Ä–æ–µ–∫—Ç–µ:
   ```bash
   mkdir -p bin
   cp /home/d/dsc23ytp/.local/bin/composer bin/composer
   chmod 755 bin/composer
   ```

2. –û–±–Ω–æ–≤–∏—Ç—å `COMPOSER_PATH` –≤ `.env`:
   ```env
   COMPOSER_PATH=/home/d/dsc23ytp/avito.siteaccess.ru/public_html/bin/composer
   ```

3. –û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à:
   ```bash
   php8.2 artisan config:clear
   ```

### –ü—Ä–æ–±–ª–µ–º–∞: "Permission denied" –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ composer

**–ü—Ä–∏—á–∏–Ω–∞:** –§–∞–π–ª composer –∏–º–µ–µ—Ç ACL –∏–ª–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞.

**–†–µ—à–µ–Ω–∏–µ:**
1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `php8.2` –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è composer (—É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ –∫–æ–¥–µ)
2. –ò–ª–∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å composer –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞ (—Å–º. –≤—ã—à–µ)
3. –ò–ª–∏ —É–±—Ä–∞—Ç—å ACL (—Ç—Ä–µ–±—É–µ—Ç root):
   ```bash
   setfacl -b /home/d/dsc23ytp/.local/bin/composer
   ```

### –ü—Ä–æ–±–ª–µ–º–∞: "404 Not Found" –¥–ª—è `/api/deploy`

**–ü—Ä–∏—á–∏–Ω–∞:** –ú–∞—Ä—à—Ä—É—Ç—ã –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞.

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ DocumentRoot —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ `public_html/public`
2. –ò–ª–∏ —Å–æ–∑–¥–∞—Ç—å `.htaccess` –≤ –∫–æ—Ä–Ω–µ `public_html` (—Å–º. —Ä–∞–∑–¥–µ–ª "–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞")
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç—ã:
   ```bash
   php8.2 artisan route:list | grep deploy
   ```
4. –û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à –º–∞—Ä—à—Ä—É—Ç–æ–≤:
   ```bash
   php8.2 artisan route:clear
   php8.2 artisan route:cache
   ```

### –ü—Ä–æ–±–ª–µ–º–∞: –î–µ–ø–ª–æ–π —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –∫–æ–¥ –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω–∞:** –ö–µ—à –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–ª–∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –Ω–µ –æ—á–∏—â–µ–Ω.

**–†–µ—à–µ–Ω–∏–µ:**
```bash
php8.2 artisan config:clear
php8.2 artisan cache:clear
php8.2 artisan route:clear
php8.2 artisan view:clear
```

---

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∏–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω –¥–µ–ø–ª–æ—è:**
   ```env
   DEPLOY_TOKEN=–¥–ª–∏–Ω–Ω—ã–π_—Å–ª—É—á–∞–π–Ω—ã–π_—Ç–æ–∫–µ–Ω_–º–∏–Ω–∏–º—É–º_32_—Å–∏–º–≤–æ–ª–∞
   ```

2. **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ `/api/deploy`:**
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∞–π—Ä–≤–æ–ª –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è IP –∞–¥—Ä–µ—Å–æ–≤
   - –ò–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –¥–æ—Å—Ç—É–ø–∞ —Å –Ω–µ—Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö IP

3. **–ù–µ –∫–æ–º–º–∏—Ç—å—Ç–µ `.env` —Ñ–∞–π–ª:**
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `.env` –≤ `.gitignore`
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–∞–∑–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏–π

4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - –í—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –¥–µ–ø–ª–æ—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
   - –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏ —Ä–µ–≥—É–ª—è—Ä–Ω–æ: `storage/logs/laravel.log`

---

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ë–∞–∑–æ–≤—ã–π –¥–µ–ø–ª–æ–π:
```bash
php artisan deploy
```

### –î–µ–ø–ª–æ–π —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º:
```bash
php artisan deploy --message="–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–≥–∞ —Å –ø–æ–¥–ø–∏—Å–∫–∞–º–∏"
```

### –î–µ–ø–ª–æ–π –±–µ–∑ —Å–±–æ—Ä–∫–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞:
```bash
php artisan deploy --skip-build
```

### –î–µ–ø–ª–æ–π —Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º seeders:
```bash
php artisan deploy --with-seed
```

### –î–µ–ø–ª–æ–π —Å –æ—Ç–∫–ª—é—á–µ–Ω–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–æ–π SSL:
```bash
php artisan deploy --insecure
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä —á—Ç–æ –±—É–¥–µ—Ç —Å–¥–µ–ª–∞–Ω–æ (–±–µ–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è):
```bash
php artisan deploy --dry-run
```

---

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –õ–æ–∫–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏:
–õ–æ–≥–∏ –∫–æ–º–∞–Ω–¥—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª–∏.

### –°–µ—Ä–≤–µ—Ä–Ω—ã–µ –ª–æ–≥–∏:
–í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ `storage/logs/laravel.log` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.

**–ü—Ä–∏–º–µ—Ä –ª–æ–≥–æ–≤:**
```
[2025-12-09 16:53:12] local.INFO: üöÄ –ù–∞—á–∞–ª–æ –¥–µ–ø–ª–æ—è
[2025-12-09 16:53:12] local.INFO: üåø –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–µ—Ç–∫–∞ –¥–ª—è –¥–µ–ø–ª–æ—è: main
[2025-12-09 16:53:12] local.INFO: üì• –í—ã–ø–æ–ª–Ω—è–µ–º git fetch origin main...
[2025-12-09 16:53:13] local.INFO: ‚úÖ Git fetch –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ
[2025-12-09 16:53:13] local.INFO: üîÑ –í—ã–ø–æ–ª–Ω—è–µ–º git reset --hard origin/main...
[2025-12-09 16:53:13] local.INFO: ‚úÖ –ö–æ–¥ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω
[2025-12-09 16:53:13] local.INFO: Composer –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ .env: /home/d/dsc23ytp/avito.siteaccess.ru/public_html/bin/composer
[2025-12-09 16:53:15] local.INFO: ‚úÖ –î–µ–ø–ª–æ–π —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω
```

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤:

```
app/
‚îú‚îÄ‚îÄ Console/
‚îÇ   ‚îî‚îÄ‚îÄ Commands/
‚îÇ       ‚îî‚îÄ‚îÄ Deploy.php              # –õ–æ–∫–∞–ª—å–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ –¥–µ–ø–ª–æ—è
‚îú‚îÄ‚îÄ Http/
‚îÇ   ‚îú‚îÄ‚îÄ Controllers/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Api/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ DeployController.php # –°–µ—Ä–≤–µ—Ä–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä
‚îÇ   ‚îî‚îÄ‚îÄ Middleware/
‚îÇ       ‚îî‚îÄ‚îÄ VerifyDeployToken.php   # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ –¥–µ–ø–ª–æ—è
routes/
‚îî‚îÄ‚îÄ api.php                          # –ú–∞—Ä—à—Ä—É—Ç—ã API
```

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

- `laravel/framework` - –¥–ª—è Process facade
- `guzzlehttp/guzzle` - –¥–ª—è HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ (—É–∂–µ –≤ Laravel)

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:

- PHP 8.2+
- Git
- Composer
- Node.js –∏ npm (–¥–ª—è —Å–±–æ—Ä–∫–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞)
- –î–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–µ—Ä—É –ø–æ HTTPS
- –ù–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

---

## –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ: `storage/logs/laravel.log`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –ª–æ–∫–∞–ª—å–Ω–æ (–≤—ã–≤–æ–¥—è—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å)
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-12-09


