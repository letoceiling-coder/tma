# Стратегия выполнения команд для AI

## Проблема: Частые зависания команд

Команды `npm run build:admin`, `php artisan`, `git` часто зависают при выполнении через инструменты.

## Решение: Гибридный подход

### 1. Критерии выбора стратегии

#### ✅ Выполнять напрямую (если):
- Команда выполняется < 10 секунд
- Не требует интерактивного ввода
- Не имеет долгого вывода
- Имеет четкий результат

Примеры:
- `php artisan route:list`
- `git status`
- `npm --version`
- `ls`, `cat`, `read_file`

#### ❌ Давать инструкции (если):
- Команда выполняется > 10 секунд
- Может зависнуть (npm build, git push)
- Требует подтверждения
- Имеет долгий вывод

Примеры:
- `npm run build:admin` (1-3 минуты)
- `npm run build:react` (1-2 минуты)
- `php artisan migrate` (может быть интерактивным)
- `git push` (может запросить креды)

### 2. Стратегия работы

#### Для команд сборки:
```
❌ НЕ выполнять: npm run build:admin
✅ Вместо этого: "Для сборки админ-панели выполните: npm run build:admin"
```

#### Для PHP Artisan:
```
❌ Если команда может зависнуть - дать инструкцию
✅ Если быстрая (< 10 сек) - выполнить с флагами:
   php artisan route:list --json
   php artisan config:cache --quiet
```

#### Для Git:
```
❌ НЕ выполнять: git push (может запросить креды)
✅ Вместо этого: "Выполните: git push origin main"
```

### 3. Обязательные флаги

#### PHP Artisan:
- `--no-interaction` - отключить интерактивность
- `--force` - принудительное выполнение
- `--quiet` - минимум вывода

#### Git:
- `--no-verify` - пропустить хуки
- `--quiet` - минимум вывода
- `--no-edit` - не открывать редактор

#### NPM:
- Не использовать флаги, но проверять наличие node_modules

### 4. Чек-лист перед выполнением команды

- [ ] Команда выполняется < 10 секунд?
- [ ] Не требует интерактивного ввода?
- [ ] Не может зависнуть?
- [ ] Имеет все необходимые флаги?
- [ ] Можно проверить результат?

Если хотя бы один пункт "нет" → дать инструкцию пользователю

### 5. Альтернативный подход

Вместо выполнения долгих команд:
1. Создать скрипты-обёртки с таймаутами
2. Документировать команды
3. Предоставлять инструкции пользователю

## Готовые решения

### Скрипты для безопасного выполнения:

1. **scripts/check-commands.php** - диагностика окружения
2. **scripts/safe-build-admin.bat/sh** - безопасная сборка
3. **scripts/build-with-timeout.bat** - сборка с таймаутом

### Использование:

```bash
# Диагностика
php scripts/check-commands.php

# Безопасная сборка
scripts\safe-build-admin.bat  # Windows
./scripts/safe-build-admin.sh  # Linux/Mac
```

## Рекомендация

**Для долгих команд всегда давать инструкции пользователю**, а не выполнять их напрямую. Это гарантирует, что команды будут выполнены правильно без зависаний.

