# ะัะพะผะฟั-ะธะฝััััะบัะธั: ะะพะผะฐะฝะดะฐ Deploy

## ะะฑัะตะต ะพะฟะธัะฐะฝะธะต

ะะพะผะฐะฝะดะฐ `php artisan deploy` - ััะพ ะฐะฒัะพะผะฐัะธะทะธัะพะฒะฐะฝะฝะฐั ัะธััะตะผะฐ ะดะตะฟะปะพั, ะบะพัะพัะฐั ะฒัะฟะพะปะฝัะตั ะฟะพะปะฝัะน ัะธะบะป ัะฐะทะฒะตัััะฒะฐะฝะธั ะฟัะธะปะพะถะตะฝะธั: ะพั ัะฑะพัะบะธ ััะพะฝัะตะฝะดะฐ ะดะพ ะพะฑะฝะพะฒะปะตะฝะธั ะบะพะดะฐ ะฝะฐ ัะตัะฒะตัะต ัะตัะตะท API ะทะฐะฟัะพั.

---

## ะงะฐััั 1: ะะพะบะฐะปัะฝะพะต ะฒัะฟะพะปะฝะตะฝะธะต ะบะพะผะฐะฝะดั

### ะะพะผะฐะฝะดะฐ ะดะปั ะทะฐะฟััะบะฐ

```bash
php artisan deploy [ะพะฟัะธะธ]
```

### ะะฐัะฟะพะปะพะถะตะฝะธะต ัะฐะนะปะฐ

**ะคะฐะนะป:** `app/Console/Commands/Deploy.php`

### ะงัะพ ะฟัะพะธััะพะดะธั ะฟัะธ ะฒัะฟะพะปะฝะตะฝะธะธ ะบะพะผะฐะฝะดั

#### ะจะฐะณ 1: ะกะฑะพัะบะฐ ััะพะฝัะตะฝะดะฐ

**ะะตัะพะด:** `buildFrontend()`

**ะัะฟะพะปะฝัะตะผะฐั ะบะพะผะฐะฝะดะฐ:**
```bash
npm run build:all
```

**ะงัะพ ะดะตะปะฐะตั:**
- ะกะพะฑะธัะฐะตั Vue ะฐะดะผะธะฝ-ะฟะฐะฝะตะปั ะฒ ะดะธัะตะบัะพัะธั `public/build/`
- ะกะพะฑะธัะฐะตั React ะฟัะธะปะพะถะตะฝะธะต ะฒ ะดะธัะตะบัะพัะธั `public/frontend/`
- ะัะพะฒะตััะตั ะฝะฐะปะธัะธะต ัะพะฑัะฐะฝะฝัั ะดะธัะตะบัะพัะธะน ะฟะพัะปะต ัะฑะพัะบะธ
- ะัะฑัะฐััะฒะฐะตั ะธัะบะปััะตะฝะธะต, ะตัะปะธ ัะฑะพัะบะฐ ะฝะต ัะดะฐะปะฐัั ะธะปะธ ะดะธัะตะบัะพัะธะธ ะฝะต ะฝะฐะนะดะตะฝั

**ะะฟัะธะธ:**
- `--skip-build` - ะฟัะพะฟัััะธัั ััะพั ัะฐะณ

#### ะจะฐะณ 2: ะัะพะฒะตัะบะฐ ััะฐัััะฐ Git

**ะะตัะพะด:** `checkGitStatus()`

**ะัะฟะพะปะฝัะตะผะฐั ะบะพะผะฐะฝะดะฐ:**
```bash
git status --porcelain
```

**ะงัะพ ะดะตะปะฐะตั:**
- ะัะพะฒะตััะตั ะฝะฐะปะธัะธะต ะธะทะผะตะฝะตะฝะธะน ะฒ ัะตะฟะพะทะธัะพัะธะธ
- ะัะฒะพะดะธั ัะฟะธัะพะบ ะธะทะผะตะฝะตะฝะฝัั ัะฐะนะปะพะฒ
- ะัะพะฒะตััะตั ะฝะฐะปะธัะธะต ะฑะพะปััะธั ัะฐะนะปะพะฒ (>10MB) ะธ ะฟัะตะดัะฟัะตะถะดะฐะตั ะพ ะฝะธั
- ะะฐะฟัะฐัะธะฒะฐะตั ะฟะพะดัะฒะตัะถะดะตะฝะธะต, ะตัะปะธ ะฝะตั ะธะทะผะตะฝะตะฝะธะน (ะฒ ะธะฝัะตัะฐะบัะธะฒะฝะพะผ ัะตะถะธะผะต)

**ะะตะทัะปััะฐั:**
- ะะพะทะฒัะฐัะฐะตั `true`, ะตัะปะธ ะตััั ะธะทะผะตะฝะตะฝะธั
- ะะพะทะฒัะฐัะฐะตั `false`, ะตัะปะธ ะธะทะผะตะฝะตะฝะธะน ะฝะตั

#### ะจะฐะณ 3: ะัะพะฒะตัะบะฐ Git Remote

**ะะตัะพะด:** `ensureGitRemote()`

**ะัะฟะพะปะฝัะตะผัะต ะบะพะผะฐะฝะดั:**
```bash
git remote -v
git remote add origin <URL>  # ะตัะปะธ remote ะฝะต ะฝะฐัััะพะตะฝ
git remote set-url origin <URL>  # ะตัะปะธ URL ะฝะตะฟัะฐะฒะธะปัะฝัะน
```

**ะงัะพ ะดะตะปะฐะตั:**
- ะัะพะฒะตััะตั ะฝะฐะปะธัะธะต remote ัะตะฟะพะทะธัะพัะธั `origin`
- ะัะปะธ remote ะพััััััะฒัะตั, ะดะพะฑะฐะฒะปัะตั ะตะณะพ ั URL: `https://github.com/letoceiling-coder/tma.git`
- ะัะปะธ URL ะฝะตะฟัะฐะฒะธะปัะฝัะน, ะพะฑะฝะพะฒะปัะตั ะตะณะพ
- ะฃะฑะตะถะดะฐะตััั, ััะพ remote ะฝะฐัััะพะตะฝ ะฟัะฐะฒะธะปัะฝะพ ะฟะตัะตะด ะพัะฟัะฐะฒะบะพะน

#### ะจะฐะณ 4: ะะพะฑะฐะฒะปะตะฝะธะต ะธะทะผะตะฝะตะฝะธะน ะฒ Git

**ะะตัะพะด:** `addChangesToGit()`

**ะัะฟะพะปะฝัะตะผัะต ะบะพะผะฐะฝะดั:**
```bash
git add -f public/build
git add -f public/frontend
git add .
```

**ะงัะพ ะดะตะปะฐะตั:**
- ะัะธะฝัะดะธัะตะปัะฝะพ ะดะพะฑะฐะฒะปัะตั ัะพะฑัะฐะฝะฝัะต ะดะธัะตะบัะพัะธะธ (`public/build` ะธ `public/frontend`) ะดะฐะถะต ะตัะปะธ ะพะฝะธ ะฒ `.gitignore`
- ะะพะฑะฐะฒะปัะตั ะฒัะต ะพััะฐะปัะฝัะต ะธะทะผะตะฝะตะฝะธั ะฒ staging area
- ะัะฑัะฐััะฒะฐะตั ะธัะบะปััะตะฝะธะต ะฟัะธ ะพัะธะฑะบะต

#### ะจะฐะณ 5: ะกะพะทะดะฐะฝะธะต ะบะพะผะผะธัะฐ

**ะะตัะพะด:** `createCommit()`

**ะัะฟะพะปะฝัะตะผะฐั ะบะพะผะฐะฝะดะฐ:**
```bash
git commit -m "<ัะพะพะฑัะตะฝะธะต>"
```

**ะกะพะพะฑัะตะฝะธะต ะบะพะผะผะธัะฐ:**
- ะะพ ัะผะพะปัะฐะฝะธั: `"Deploy: YYYY-MM-DD HH:MM:SS"` (ัะตะบััะฐั ะดะฐัะฐ ะธ ะฒัะตะผั)
- ะะฐััะพะผะฝะพะต: ะผะพะถะฝะพ ัะบะฐะทะฐัั ัะตัะตะท ะพะฟัะธั `--message="ัะตะบัั"`

**ะงัะพ ะดะตะปะฐะตั:**
- ะกะพะทะดะฐะตั ะบะพะผะผะธั ัะพ ะฒัะตะผะธ ะธะทะผะตะฝะตะฝะธัะผะธ
- ะัะปะธ ะธะทะผะตะฝะตะฝะธะน ะฝะตั, ะฒัะฒะพะดะธั ะฟัะตะดัะฟัะตะถะดะตะฝะธะต ะธ ะฟัะพะดะพะปะถะฐะตั

#### ะจะฐะณ 6: ะัะฟัะฐะฒะบะฐ ะฒ ัะตะฟะพะทะธัะพัะธะน

**ะะตัะพะด:** `pushToRepository()`

**ะัะฟะพะปะฝัะตะผะฐั ะบะพะผะฐะฝะดะฐ:**
```bash
git push origin <ะฒะตัะบะฐ>
# ะธะปะธ ั force:
git push --force origin <ะฒะตัะบะฐ>
```

**ะงัะพ ะดะตะปะฐะตั:**
- ะะฒัะพะผะฐัะธัะตัะบะธ ะพะฟัะตะดะตะปัะตั ัะตะบัััั ะฒะตัะบั ัะตัะตะท `git rev-parse --abbrev-ref HEAD`
- ะัะฟัะฐะฒะปัะตั ะธะทะผะตะฝะตะฝะธั ะฒ ัะดะฐะปะตะฝะฝัะน ัะตะฟะพะทะธัะพัะธะน
- ะัะปะธ upstream ะฝะต ะฝะฐัััะพะตะฝ, ัััะฐะฝะฐะฒะปะธะฒะฐะตั ะตะณะพ ะฐะฒัะพะผะฐัะธัะตัะบะธ
- ะัะธ ะพัะธะฑะบะต `non-fast-forward` ะฟัะตะดะปะฐะณะฐะตั ะธัะฟะพะปัะทะพะฒะฐัั `--force`
- ะขะฐะนะผะฐัั: 5 ะผะธะฝัั (300 ัะตะบัะฝะด)

**ะะฟัะธะธ:**
- `--force` - ะฟัะธะฝัะดะธัะตะปัะฝะฐั ะพัะฟัะฐะฒะบะฐ (ะฟะตัะตะทะฐะฟะธััะฒะฐะตั ัะดะฐะปะตะฝะฝัั ะฒะตัะบั)

#### ะจะฐะณ 7: ะัะฟัะฐะฒะบะฐ POST ะทะฐะฟัะพัะฐ ะฝะฐ ัะตัะฒะตั

**ะะตัะพะด:** `sendDeployRequest()`

**URL ะทะฐะฟัะพัะฐ:**
```
{DEPLOY_SERVER_URL}/api/deploy
```

**ะะตัะพะด:** `POST`

**ะะฐะณะพะปะพะฒะบะธ:**
```
X-Deploy-Token: {DEPLOY_TOKEN}
Content-Type: application/json
Accept: application/json
User-Agent: WOW-Spin-Deploy/1.0
```

**ะขะตะปะพ ะทะฐะฟัะพัะฐ (JSON):**
```json
{
  "commit_hash": "abc123def456...",
  "repository": "https://github.com/letoceiling-coder/tma.git",
  "branch": "main",
  "deployed_by": "username",
  "timestamp": "2025-01-20 12:00:00",
  "run_seeders": false
}
```

**ะะฐัะฐะผะตััั ะทะฐะฟัะพัะฐ:**
- `commit_hash` - ัะตั ะบะพะผะผะธัะฐ, ะบะพัะพััะน ะฑัะป ะพัะฟัะฐะฒะปะตะฝ (ะฟะพะปััะฐะตััั ัะตัะตะท `git rev-parse HEAD`)
- `repository` - URL git ัะตะฟะพะทะธัะพัะธั (ะบะพะฝััะฐะฝัะฐ ะฒ ะบะปะฐััะต)
- `branch` - ัะตะบััะฐั ะฒะตัะบะฐ ะปะพะบะฐะปัะฝะพะณะพ ัะตะฟะพะทะธัะพัะธั (ะพะฟัะตะดะตะปัะตััั ะฐะฒัะพะผะฐัะธัะตัะบะธ)
- `deployed_by` - ะธะผั ะฟะพะปัะทะพะฒะฐัะตะปั ัะธััะตะผั (ัะตัะตะท `get_current_user()`)
- `timestamp` - ัะตะบััะฐั ะดะฐัะฐ ะธ ะฒัะตะผั ะฒ ัะพัะผะฐัะต `Y-m-d H:i:s`
- `run_seeders` - ัะปะฐะณ ะดะปั ะฒัะฟะพะปะฝะตะฝะธั seeders ะฝะฐ ัะตัะฒะตัะต (ะธะท ะพะฟัะธะธ `--with-seed`)

**ะะฐัััะพะนะบะธ HTTP ะบะปะธะตะฝัะฐ:**
- ะขะฐะนะผะฐัั: 5 ะผะธะฝัั (300 ัะตะบัะฝะด)
- ะะพะดะดะตัะถะบะฐ ัะตะดะธัะตะบัะพะฒ: ะดะพ 5 ัะตะดะธัะตะบัะพะฒ
- SSL: ะฟัะพะฒะตัะบะฐ ะพัะบะปััะตะฝะฐ ะฟัะธ ะพะฟัะธะธ `--insecure` ะธะปะธ ะฒ ะปะพะบะฐะปัะฝะพะผ ะพะบััะถะตะฝะธะธ
- TLS ะฒะตััะธั: TLSv1.2

**ะะฑัะฐะฑะพัะบะฐ ะพัะฒะตัะฐ:**
- ะัะธ ััะฟะตัะต (HTTP 200): ะฒัะฒะพะดะธั ะดะตัะฐะปัะฝัั ะธะฝัะพัะผะฐัะธั ะพ ะดะตะฟะปะพะต
- ะัะธ ะพัะธะฑะบะต: ะฒัะฒะพะดะธั ะดะตัะฐะปัะฝะพะต ะพะฟะธัะฐะฝะธะต ะฟัะพะฑะปะตะผั ั ัะตะบะพะผะตะฝะดะฐัะธัะผะธ

**ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั (ะปะพะบะฐะปัะฝะพ):**
```env
DEPLOY_SERVER_URL=https://example.com
DEPLOY_TOKEN=your_secret_token_here
```

---

## ะงะฐััั 2: ะะพะปััะตะฝะธะต ะทะฐะฟัะพัะฐ ะฝะฐ ัะตัะฒะตัะต

### API Endpoint

**URL:** `POST /api/deploy`

**ะะฐัะฟะพะปะพะถะตะฝะธะต ะผะฐัััััะฐ:** `routes/api.php` (ัััะพะบะฐ 202)

**ะะพะฝััะพะปะปะตั:** `App\Http\Controllers\Api\DeployController`

**ะะตัะพะด:** `deploy(Request $request)`

### Middleware: ะัะพะฒะตัะบะฐ ัะพะบะตะฝะฐ

**ะคะฐะนะป:** `app/Http/Middleware/VerifyDeployToken.php`

**ะงัะพ ะดะตะปะฐะตั:**
1. ะะทะฒะปะตะบะฐะตั ัะพะบะตะฝ ะธะท ะทะฐะฟัะพัะฐ ะฒ ัะปะตะดัััะตะผ ะฟะพััะดะบะต ะฟัะธะพัะธัะตัะฐ:
   - ะะฐะณะพะปะพะฒะพะบ `Authorization: Bearer <token>`
   - ะะฐะณะพะปะพะฒะพะบ `X-Deploy-Token`
   - ะะฐะณะพะปะพะฒะพะบ `X-Deploy-Secret` (ะดะปั ะพะฑัะฐัะฝะพะน ัะพะฒะผะตััะธะผะพััะธ)
   - ะะฐัะฐะผะตัั `token` ะฒ ัะตะปะต ะทะฐะฟัะพัะฐ
   - ะะฐัะฐะผะตัั `secret` ะฒ ัะตะปะต ะทะฐะฟัะพัะฐ

2. ะะพะปััะฐะตั ะพะถะธะดะฐะตะผัะน ัะพะบะตะฝ ะธะท:
   - `config('app.deploy_token')`
   - `.env` ัะฐะนะปะฐ (`DEPLOY_TOKEN` ะธะปะธ `DEPLOY_SECRET`)
   - `env('DEPLOY_TOKEN')` ะธะปะธ `env('DEPLOY_SECRET')`

3. ะกัะฐะฒะฝะธะฒะฐะตั ัะพะบะตะฝั:
   - ะัะปะธ ัะพะบะตะฝั ะฝะต ัะพะฒะฟะฐะดะฐัั โ ะฒะพะทะฒัะฐัะฐะตั HTTP 403 ั ัะพะพะฑัะตะฝะธะตะผ "ะะตะฒะตัะฝัะน ัะตะบัะตัะฝัะน ะบะปัั"
   - ะัะปะธ ัะพะบะตะฝ ะฝะต ะฝะฐัััะพะตะฝ ะฝะฐ ัะตัะฒะตัะต โ ะฒะพะทะฒัะฐัะฐะตั HTTP 500 ั ัะพะพะฑัะตะฝะธะตะผ ะพะฑ ะพัะธะฑะบะต
   - ะัะปะธ ัะพะบะตะฝั ัะพะฒะฟะฐะดะฐัั โ ะฟัะพะฟััะบะฐะตั ะทะฐะฟัะพั ะดะฐะปััะต

4. ะะพะณะธััะตั ะฟะพะฟััะบะธ ะฟัะพะฒะตัะบะธ ัะพะบะตะฝะฐ (IP, ะฟััั, ัะตะทัะปััะฐั)

### ะะฑัะฐะฑะพัะบะฐ ะทะฐะฟัะพัะฐ ะฒ ะบะพะฝััะพะปะปะตัะต

**ะะตัะพะด:** `DeployController::deploy(Request $request)`

**ะะฐัะฐะปะพ ะฒัะฟะพะปะฝะตะฝะธั:**
- ะะฐัะตะบะฐะตั ะฒัะตะผั ะฝะฐัะฐะปะฐ ะฒัะฟะพะปะฝะตะฝะธั
- ะะพะณะธััะตั ะฝะฐัะฐะปะพ ะดะตะฟะปะพั ั IP ะฐะดัะตัะพะผ ะธ ะฒัะตะผะตะฝะตะผ

**ะะทะฒะปะตัะตะฝะธะต ะดะฐะฝะฝัั ะธะท ะทะฐะฟัะพัะฐ:**
```php
$requestedBranch = $request->input('branch');  // ะะตัะบะฐ ะดะปั ะพะฑะฝะพะฒะปะตะฝะธั
$runSeeders = $request->input('run_seeders', false);  // ะัะฟะพะปะฝััั ะปะธ seeders
```

**ะะฟัะตะดะตะปะตะฝะธะต ะฒะตัะบะธ:**
- ะัะปะธ ะฒะตัะบะฐ ัะบะฐะทะฐะฝะฐ ะฒ ะทะฐะฟัะพัะต โ ะธัะฟะพะปัะทัะตััั ะพะฝะฐ
- ะัะปะธ ะฝะต ัะบะฐะทะฐะฝะฐ โ ะพะฟัะตะดะตะปัะตััั ัะตะบััะฐั ะฒะตัะบะฐ ัะตัะฒะตัะฐ ัะตัะตะท `git rev-parse --abbrev-ref HEAD`
- ะัะปะธ ะฝะต ัะดะฐะปะพัั ะพะฟัะตะดะตะปะธัั โ ะธัะฟะพะปัะทัะตััั `main` ะฟะพ ัะผะพะปัะฐะฝะธั

---

## ะงะฐััั 3: ะัะฟะพะปะฝะตะฝะธะต ะฝะฐ ัะตัะฒะตัะต

### ะะพัะปะตะดะพะฒะฐัะตะปัะฝะพััั ะฒัะฟะพะปะฝะตะฝะธั

#### 0. ะัะธััะบะฐ ัะฐะนะปะพะฒ ัะฐะทัะฐะฑะพัะบะธ (ะฒ ะฝะฐัะฐะปะต)

**ะะตัะพะด:** `cleanDevelopmentFiles()`

**ะงัะพ ัะดะฐะปัะตั:**
- `public/hot` - ัะฐะนะป ะดะปั hot reload ะฒ ัะฐะทัะฐะฑะพัะบะต

**ะะฐัะตะผ:** ะัะธััะบะฐ ะฒัะตะผะตะฝะฝัั ัะฐะนะปะพะฒ ะฟะตัะตะด ะดะตะฟะปะพะตะผ

#### 1. ะะฟัะตะดะตะปะตะฝะธะต PHP ะฟััะธ ะธ ะฒะตััะธะธ

**ะะตัะพะดั:** `getPhpPath()`, `getPhpVersion()`

**ะะพะธัะบ PHP:**
1. ะัะพะฒะตััะตั `PHP_PATH` ะธะท `.env`
2. ะัะพะฑัะตั ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฝะฐะนัะธ: `php8.2`, `php8.3`, `php8.1`, `php`
3. Fallback ะฝะฐ `php`

**ะะพะปััะตะฝะธะต ะฒะตััะธะธ:**
- ะัะฟะพะปะฝัะตั `php --version` ะธ ะฟะฐััะธั ะฒะตััะธั ะธะท ะฒัะฒะพะดะฐ

#### 2. Git Pull (ะพะฑะฝะพะฒะปะตะฝะธะต ะบะพะดะฐ)

**ะะตัะพะด:** `handleGitPull($branch)`

**ะัะฟะพะปะฝัะตะผัะต ะบะพะผะฐะฝะดั:**
```bash
# ะะฐัััะพะนะบะฐ ะฑะตะทะพะฟะฐัะฝะพะน ะดะธัะตะบัะพัะธะธ (ัะตัะฐะตั ะฟัะพะฑะปะตะผั dubious ownership)
git config --global --add safe.directory <ะฟััั_ะบ_ะฟัะพะตะบัั>

# ะัะพะฒะตัะบะฐ ะปะพะบะฐะปัะฝัั ะธะทะผะตะฝะตะฝะธะน
git status --porcelain

# ะัะปะธ ะตััั ะปะพะบะฐะปัะฝัะต ะธะทะผะตะฝะตะฝะธั - ัะพััะฐะฝัะตะผ ะฒ stash
git stash push -m "Auto-stash before deploy <ะดะฐัะฐ>"

# ะะพะปััะตะฝะธะต ะธะทะผะตะฝะตะฝะธะน ะธะท ัะตะฟะพะทะธัะพัะธั
git fetch origin <ะฒะตัะบะฐ>

# ะัะธะฝัะดะธัะตะปัะฝะพะต ะพะฑะฝะพะฒะปะตะฝะธะต ะปะพะบะฐะปัะฝะพะน ะฒะตัะบะธ
git reset --hard origin/<ะฒะตัะบะฐ>
```

**ะงัะพ ะดะตะปะฐะตั:**
- ะกะพััะฐะฝัะตั ะปะพะบะฐะปัะฝัะต ะธะทะผะตะฝะตะฝะธั ะฒ stash ะฟะตัะตะด ะพะฑะฝะพะฒะปะตะฝะธะตะผ
- ะะพะปััะฐะตั ะฟะพัะปะตะดะฝะธะต ะธะทะผะตะฝะตะฝะธั ะธะท ัะดะฐะปะตะฝะฝะพะณะพ ัะตะฟะพะทะธัะพัะธั
- ะัะธะฝัะดะธัะตะปัะฝะพ ะพะฑะฝะพะฒะปัะตั ะปะพะบะฐะปัะฝัั ะฒะตัะบั ะดะพ ัะพััะพัะฝะธั ัะดะฐะปะตะฝะฝะพะน
- ะะพะณะธััะตั commit hash ะดะพ ะธ ะฟะพัะปะต ะพะฑะฝะพะฒะปะตะฝะธั
- ะะพะทะฒัะฐัะฐะตั ะธะฝัะพัะผะฐัะธั ะพ ัะตะทัะปััะฐัะต (ััะฟะตั/ะพัะธะฑะบะฐ)

**ะัะพะฑะตะฝะฝะพััะธ:**
- ะัะฟะพะปัะทัะตั `git reset --hard` ะดะปั ะณะฐัะฐะฝัะธัะพะฒะฐะฝะฝะพะณะพ ะพะฑะฝะพะฒะปะตะฝะธั
- ะะตัะฐะตั ะฟัะพะฑะปะตะผั "dubious ownership" ัะตัะตะท ะฝะฐัััะพะนะบั safe.directory
- ะัะปะธ `reset --hard` ะฝะต ัะฐะฑะพัะฐะตั, ะฟัะพะฑัะตั ะพะฑััะฝัะน `git pull`

#### 3. Composer Install (ัััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน)

**ะะตัะพะด:** `handleComposerInstall()`

**ะะพะธัะบ Composer:**
1. ะัะพะฒะตััะตั `COMPOSER_PATH` ะธะท `.env`
2. ะัะตั ะปะพะบะฐะปัะฝัะน composer ะฒ `bin/composer` ะฟัะพะตะบัะฐ
3. ะัะตั ัะตัะตะท `which composer`
4. ะัะพะฒะตััะตั ััะฐะฝะดะฐััะฝัะต ะฟััะธ:
   - `/usr/local/bin/composer`
   - `/usr/bin/composer`
   - `/opt/composer/composer`
5. ะัะพะฑัะตั ะธัะฟะพะปัะทะพะฒะฐัั `composer` ะธะท PATH

**ะัะฟะพะปะฝัะตะผะฐั ะบะพะผะฐะฝะดะฐ:**
```bash
php8.2 <ะฟััั_ะบ_composer> install --no-dev --optimize-autoloader --no-interaction --no-scripts
```

**ะะปะธ ะตัะปะธ ะฟััั ะฝะต ะฝะฐะนะดะตะฝ:**
```bash
composer install --no-dev --optimize-autoloader --no-interaction --no-scripts
```

**ะะฐัะฐะผะตััั:**
- `--no-dev` - ะฝะต ัััะฐะฝะฐะฒะปะธะฒะฐัั dev-ะทะฐะฒะธัะธะผะพััะธ
- `--optimize-autoloader` - ะพะฟัะธะผะธะทะธัะพะฒะฐัั ะฐะฒัะพะทะฐะณััะทัะธะบ
- `--no-interaction` - ะฝะต ะทะฐะฟัะฐัะธะฒะฐัั ะฟะพะดัะฒะตัะถะดะตะฝะธั
- `--no-scripts` - ะฝะต ะฒัะฟะพะปะฝััั ัะบัะธะฟัั ะธะท composer.json

**ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั:**
- `HOME` - ะดะพะผะฐัะฝัั ะดะธัะตะบัะพัะธั ะฟะพะปัะทะพะฒะฐัะตะปั
- `COMPOSER_HOME` - ะดะธัะตะบัะพัะธั ะดะปั composer ะบะพะฝัะธะณััะฐัะธะธ
- `COMPOSER_DISABLE_XDEBUG_WARN` - ะพัะบะปััะธัั ะฟัะตะดัะฟัะตะถะดะตะฝะธั xdebug

**ะขะฐะนะผะฐัั:** 10 ะผะธะฝัั (600 ัะตะบัะฝะด)

#### 4. ะัะธััะบะฐ ะบะตัะฐ package discovery

**ะะตัะพะด:** `clearPackageDiscoveryCache()`

**ะงัะพ ะดะตะปะฐะตั:**
- ะฃะดะฐะปัะตั `bootstrap/cache/packages.php`
- ะฃะดะฐะปัะตั `bootstrap/cache/services.php`
- ะัะฟะพะปะฝัะตั `php artisan config:clear`

**ะะฐัะตะผ:** ะัะธััะบะฐ ะบะตัะฐ ะฟะพัะปะต ัััะฐะฝะพะฒะบะธ ะฝะพะฒัั ะฟะฐะบะตัะพะฒ

#### 5. ะะธะณัะฐัะธะธ ะฑะฐะทั ะดะฐะฝะฝัั

**ะะตัะพะด:** `runMigrations()`

**ะัะฟะพะปะฝัะตะผะฐั ะบะพะผะฐะฝะดะฐ:**
```bash
php8.2 artisan migrate --force
```

**ะงัะพ ะดะตะปะฐะตั:**
- ะัะธะผะตะฝัะตั ะฒัะต ะฝะพะฒัะต ะผะธะณัะฐัะธะธ ะบ ะฑะฐะทะต ะดะฐะฝะฝัั
- ะัะฟะพะปัะทัะตั `--force` ะดะปั ะฒัะฟะพะปะฝะตะฝะธั ะฒ production (ะฑะตะท ะฟะพะดัะฒะตัะถะดะตะฝะธั)
- ะะฐััะธั ะฒัะฒะพะด ะธ ะฟะพะดััะธััะฒะฐะตั ะบะพะปะธัะตััะฒะพ ะฒัะฟะพะปะฝะตะฝะฝัั ะผะธะณัะฐัะธะน
- ะะพะทะฒัะฐัะฐะตั ะธะฝัะพัะผะฐัะธั ะพ ัะตะทัะปััะฐัะต

**ะะตะทัะปััะฐั:**
```php
[
    'status' => 'success',
    'migrations_run' => 3,
    'message' => 'ะัะฟะพะปะฝะตะฝะพ ะผะธะณัะฐัะธะน: 3',
    'output' => '...'
]
```

#### 6. Seeders (ะพะฟัะธะพะฝะฐะปัะฝะพ)

**ะะตัะพะด:** `runSeeders($class, $all)`

**ะัะฟะพะปะฝัะตััั ัะพะปัะบะพ ะตัะปะธ:** `run_seeders === true` ะฒ ะทะฐะฟัะพัะต

**ะัะฟะพะปะฝัะตะผัะต ะบะพะผะฐะฝะดั:**

ะัะปะธ `$all === true`:
```bash
php8.2 artisan db:seed --force
```

ะัะปะธ ัะบะฐะทะฐะฝ ะบะพะฝะบัะตัะฝัะน seeder:
```bash
php8.2 artisan db:seed --class=RoleSeeder --force
```

ะัะปะธ ะฝะต ัะบะฐะทะฐะฝะพ (ะฟะพ ัะผะพะปัะฐะฝะธั):
```bash
php8.2 artisan db:seed --class=RoleSeeder --force
php8.2 artisan db:seed --class=WheelSectorSeeder --force
php8.2 artisan db:seed --class=ChannelSeeder --force
```

**ะงัะพ ะดะตะปะฐะตั:**
- ะัะฟะพะปะฝัะตั ัะบะฐะทะฐะฝะฝัะต seeders ะฟะพัะปะตะดะพะฒะฐัะตะปัะฝะพ
- ะะพะณะธััะตั ัะตะทัะปััะฐั ะบะฐะถะดะพะณะพ seeder
- ะะพะทะฒัะฐัะฐะตั ะพะฑััั ััะฐัะธััะธะบั (ััะฟะตัะฝะพ/ะพัะธะฑะบะธ)

**ะขะฐะนะผะฐัั:** 5 ะผะธะฝัั ะฝะฐ ะบะฐะถะดัะน seeder, 10 ะผะธะฝัั ะดะปั ะฒัะตั

#### 7. ะัะธััะบะฐ ะฒัะตะผะตะฝะฝัั ัะฐะนะปะพะฒ ัะฐะทัะฐะฑะพัะบะธ (ะฟะพะฒัะพัะฝะพ)

**ะะตัะพะด:** `cleanDevelopmentFiles()`

**ะงัะพ ัะดะฐะปัะตั:**
- `public/hot`

#### 8. ะัะธััะบะฐ ะฒัะตั ะบะตัะตะน

**ะะตัะพะด:** `clearAllCaches()`

**ะัะฟะพะปะฝัะตะผัะต ะบะพะผะฐะฝะดั:**
```bash
php8.2 artisan config:clear
php8.2 artisan cache:clear
php8.2 artisan route:clear
php8.2 artisan view:clear
php8.2 artisan optimize:clear
```

**ะงัะพ ะดะตะปะฐะตั:**
- ะัะธัะฐะตั ะฒัะต ะบะตัะธ Laravel
- ะัะฟะพะปะฝัะตั ะบะพะผะฐะฝะดั ะฟะพัะปะตะดะพะฒะฐัะตะปัะฝะพ
- ะะพะณะธััะตั ัะตะทัะปััะฐั ะบะฐะถะดะพะน ะบะพะผะฐะฝะดั

#### 9. ะะฟัะธะผะธะทะฐัะธั ะฟัะธะปะพะถะตะฝะธั

**ะะตัะพะด:** `optimizeApplication()`

**ะัะฟะพะปะฝัะตะผัะต ะบะพะผะฐะฝะดั:**
```bash
php8.2 artisan config:cache
php8.2 artisan route:cache
php8.2 artisan view:cache
```

**ะงัะพ ะดะตะปะฐะตั:**
- ะะตัะธััะตั ะบะพะฝัะธะณััะฐัะธั ะดะปั ะฑััััะพะณะพ ะดะพัััะฟะฐ
- ะะตัะธััะตั ะผะฐัััััั ะดะปั ะพะฟัะธะผะธะทะฐัะธะธ ัะพััะธะฝะณะฐ
- ะะตัะธััะตั ัะฐะฑะปะพะฝั ะดะปั ััะบะพัะตะฝะธั ัะตะฝะดะตัะธะฝะณะฐ

#### 10. ะคะธะฝะฐะปัะฝะฐั ะพัะธััะบะฐ ัะฐะนะปะพะฒ ัะฐะทัะฐะฑะพัะบะธ

**ะะตัะพะด:** `cleanDevelopmentFiles()`

**ะงัะพ ัะดะฐะปัะตั:**
- `public/hot`

#### 11. ะะพะปััะตะฝะธะต commit hash

**ะะตัะพะด:** `getCurrentCommitHash()`

**ะัะฟะพะปะฝัะตะผะฐั ะบะพะผะฐะฝะดะฐ:**
```bash
git -c safe.directory=<ะฟััั> rev-parse HEAD
```

**ะงัะพ ะดะตะปะฐะตั:**
- ะะพะปััะฐะตั ัะตั ัะตะบััะตะณะพ ะบะพะผะผะธัะฐ ะฟะพัะปะต ะพะฑะฝะพะฒะปะตะฝะธั
- ะัะฟะพะปัะทัะตััั ะดะปั ััะฐะฒะฝะตะฝะธั ั ะฟัะตะดัะดััะธะผ commit hash

---

## ะงะฐััั 4: ะคะพัะผะธัะพะฒะฐะฝะธะต ะพัะฒะตัะฐ

### ะฃัะฟะตัะฝัะน ะพัะฒะตั (HTTP 200)

**ะคะพัะผะฐั:**
```json
{
  "success": true,
  "message": "ะะตะฟะปะพะน ััะฟะตัะฝะพ ะทะฐะฒะตััะตะฝ",
  "data": {
    "php_version": "8.2.28",
    "php_path": "php8.2",
    "branch": "main",
    "old_commit_hash": "abc123...",
    "new_commit_hash": "def456...",
    "commit_changed": true,
    "git_pull": "success",
    "composer_install": "success",
    "migrations": {
      "status": "success",
      "message": "ะัะฟะพะปะฝะตะฝะพ ะผะธะณัะฐัะธะน: 3",
      "migrations_run": 3
    },
    "seeders": {
      "status": "skipped",
      "message": "Seeders ะฟัะพะฟััะตะฝั (ะธัะฟะพะปัะทัะนัะต --with-seed ะดะปั ะฒัะฟะพะปะฝะตะฝะธั)"
    },
    "cache_cleared": true,
    "optimized": true,
    "deployed_at": "2025-01-20 12:00:00",
    "duration_seconds": 5.05
  }
}
```

**ะะพะปั ะพัะฒะตัะฐ:**
- `success` - ััะฐััั ะฒัะฟะพะปะฝะตะฝะธั (true/false)
- `message` - ัะตะบััะพะฒะพะต ัะพะพะฑัะตะฝะธะต ะพ ัะตะทัะปััะฐัะต
- `data` - ะดะตัะฐะปัะฝะฐั ะธะฝัะพัะผะฐัะธั ะพ ะฒัะฟะพะปะฝะตะฝะธะธ:
  - `php_version` - ะฒะตััะธั PHP
  - `php_path` - ะฟััั ะบ PHP
  - `branch` - ะฒะตัะบะฐ, ะบะพัะพัะฐั ะฑัะปะฐ ะพะฑะฝะพะฒะปะตะฝะฐ
  - `old_commit_hash` - commit hash ะดะพ ะพะฑะฝะพะฒะปะตะฝะธั
  - `new_commit_hash` - commit hash ะฟะพัะปะต ะพะฑะฝะพะฒะปะตะฝะธั
  - `commit_changed` - ะธะทะผะตะฝะธะปัั ะปะธ commit
  - `git_pull` - ััะฐััั git pull
  - `composer_install` - ััะฐััั composer install
  - `migrations` - ะธะฝัะพัะผะฐัะธั ะพ ะผะธะณัะฐัะธัั
  - `seeders` - ะธะฝัะพัะผะฐัะธั ะพ seeders
  - `cache_cleared` - ะพัะธัะตะฝั ะปะธ ะบะตัะธ
  - `optimized` - ะฒัะฟะพะปะฝะตะฝะฐ ะปะธ ะพะฟัะธะผะธะทะฐัะธั
  - `deployed_at` - ะฒัะตะผั ะทะฐะฒะตััะตะฝะธั ะดะตะฟะปะพั
  - `duration_seconds` - ะดะปะธัะตะปัะฝะพััั ะฒัะฟะพะปะฝะตะฝะธั ะฒ ัะตะบัะฝะดะฐั

### ะัะธะฑะบะฐ (HTTP 500)

**ะคะพัะผะฐั:**
```json
{
  "success": false,
  "message": "ะัะธะฑะบะฐ ะดะตะฟะปะพั: <ะพะฟะธัะฐะฝะธะต ะพัะธะฑะบะธ>",
  "data": {
    "error": "<ะดะตัะฐะปะธ ะพัะธะฑะบะธ>",
    "trace": "<stack trace>",  // ัะพะปัะบะพ ะตัะปะธ APP_DEBUG=true
    "branch": "main",
    "deployed_at": "2025-01-20 12:00:00",
    "duration_seconds": 2.5
  }
}
```

**ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ:**
- ะัะต ะพัะธะฑะบะธ ะปะพะณะธัััััั ะฒ `storage/logs/laravel.log`
- ะัะธ ะพัะธะฑะบะต ะฝะฐ ะปัะฑะพะผ ััะฐะฟะต ะฒัะฟะพะปะฝะตะฝะธะต ะฟัะตะบัะฐัะฐะตััั
- ะะพะทะฒัะฐัะฐะตััั ะดะตัะฐะปัะฝะฐั ะธะฝัะพัะผะฐัะธั ะพะฑ ะพัะธะฑะบะต

---

## ะงะฐััั 5: ะขัะตะฑะพะฒะฐะฝะธั ะดะปั ัะตะฐะปะธะทะฐัะธะธ

### ะะพะบะฐะปัะฝะฐั ะผะฐัะธะฝะฐ (ัะฐะทัะฐะฑะพัะบะฐ)

**ะขัะตะฑะพะฒะฐะฝะธั:**
1. **PHP 8.1+** - ะดะปั ะฒัะฟะพะปะฝะตะฝะธั Laravel ะบะพะผะฐะฝะด
2. **Git** - ะดะปั ัะฐะฑะพัั ั ัะตะฟะพะทะธัะพัะธะตะผ
3. **Node.js ะธ npm** - ะดะปั ัะฑะพัะบะธ ััะพะฝัะตะฝะดะฐ
4. **Composer** - ะดะปั ัะฟัะฐะฒะปะตะฝะธั ะทะฐะฒะธัะธะผะพัััะผะธ PHP
5. **ะะพัััะฟ ะบ ะธะฝัะตัะฝะตัั** - ะดะปั ะพัะฟัะฐะฒะบะธ ะทะฐะฟัะพัะพะฒ ะฝะฐ ัะตัะฒะตั

**ะะฐัััะพะนะบะฐ:**
1. ะกะพะทะดะฐัั ัะฐะนะป `.env` ั ะฟะตัะตะผะตะฝะฝัะผะธ:
   ```env
   DEPLOY_SERVER_URL=https://example.com
   DEPLOY_TOKEN=your_secret_token_here
   ```

2. ะะฐัััะพะธัั git remote:
   ```bash
   git remote add origin https://github.com/letoceiling-coder/tma.git
   ```

3. ะฃะฑะตะดะธัััั, ััะพ ะตััั ะดะพัััะฟ ะบ ัะตะฟะพะทะธัะพัะธั (SSH ะบะปััะธ ะธะปะธ ัะพะบะตะฝ)

### ะกะตัะฒะตั (production)

**ะขัะตะฑะพะฒะฐะฝะธั:**
1. **PHP 8.2+** - ะดะปั ะฒัะฟะพะปะฝะตะฝะธั Laravel ะบะพะผะฐะฝะด
2. **Git** - ะดะปั ะฟะพะปััะตะฝะธั ะบะพะดะฐ ะธะท ัะตะฟะพะทะธัะพัะธั
3. **Composer** - ะดะปั ัััะฐะฝะพะฒะบะธ ะทะฐะฒะธัะธะผะพััะตะน
4. **ะะตะฑ-ัะตัะฒะตั** (Apache/Nginx) - ะดะปั ะพะฑัะฐะฑะพัะบะธ HTTP ะทะฐะฟัะพัะพะฒ
5. **ะะฐะทะฐ ะดะฐะฝะฝัั** (MySQL/PostgreSQL) - ะดะปั ััะฐะฝะตะฝะธั ะดะฐะฝะฝัั
6. **SSL ัะตััะธัะธะบะฐั** (ัะตะบะพะผะตะฝะดัะตััั) - ะดะปั ะฑะตะทะพะฟะฐัะฝะพะณะพ ัะพะตะดะธะฝะตะฝะธั

**ะะฐัััะพะนะบะฐ:**
1. ะกะพะทะดะฐัั ัะฐะนะป `.env` ั ะฟะตัะตะผะตะฝะฝัะผะธ:
   ```env
   DEPLOY_TOKEN=your_secret_token_here  # ะะพะปะถะตะฝ ัะพะฒะฟะฐะดะฐัั ั ะปะพะบะฐะปัะฝัะผ
   PHP_PATH=php8.2  # ะะฟัะธะพะฝะฐะปัะฝะพ
   COMPOSER_PATH=/path/to/composer  # ะะฟัะธะพะฝะฐะปัะฝะพ
   ```

2. ะะฐัััะพะธัั git ัะตะฟะพะทะธัะพัะธะน ะฝะฐ ัะตัะฒะตัะต:
   ```bash
   cd /path/to/project
   git init
   git remote add origin https://github.com/letoceiling-coder/tma.git
   git fetch origin
   git checkout -b main origin/main
   ```

3. ะฃััะฐะฝะพะฒะธัั composer (ะตัะปะธ ะฝะต ัััะฐะฝะพะฒะปะตะฝ):
   ```bash
   # ะะพะบะฐะปัะฝะพ ะฒ ะฟัะพะตะบัะต (ัะตะบะพะผะตะฝะดัะตััั)
   mkdir -p bin
   cp /path/to/composer bin/composer
   chmod 755 bin/composer
   ```

4. ะะฐัััะพะธัั ะฟัะฐะฒะฐ ะดะพัััะฟะฐ:
   ```bash
   chmod -R 755 /path/to/project
   chmod -R 775 /path/to/project/storage
   chmod -R 775 /path/to/project/bootstrap/cache
   ```

5. ะะฐัััะพะธัั ะฒะตะฑ-ัะตัะฒะตั:
   - DocumentRoot ะดะพะปะถะตะฝ ัะบะฐะทัะฒะฐัั ะฝะฐ `public/` ะดะธัะตะบัะพัะธั
   - ะะปะธ ะฝะฐัััะพะธัั ัะตะดะธัะตะบั ัะตัะตะท `.htaccess` (Apache) ะธะปะธ ะบะพะฝัะธะณััะฐัะธั (Nginx)

6. ะัะธััะธัั ะบะตัะธ ะฟะพัะปะต ะฝะฐัััะพะนะบะธ:
   ```bash
   php8.2 artisan config:clear
   php8.2 artisan cache:clear
   php8.2 artisan route:clear
   php8.2 artisan view:clear
   ```

### ะะตะทะพะฟะฐัะฝะพััั

**ะะตะบะพะผะตะฝะดะฐัะธะธ:**
1. **ะัะฟะพะปัะทะพะฒะฐัั ัะธะปัะฝัะน ัะพะบะตะฝ:**
   - ะะธะฝะธะผัะผ 32 ัะธะผะฒะพะปะฐ
   - ะกะปััะฐะนะฝัะต ัะธะผะฒะพะปั (ะฑัะบะฒั, ัะธััั, ัะฟะตััะธะผะฒะพะปั)
   - ะะฐะทะฝัะต ัะพะบะตะฝั ะดะปั ัะฐะทะฝัั ะพะบััะถะตะฝะธะน

2. **ะะณัะฐะฝะธัะธัั ะดะพัััะฟ ะบ endpoint:**
   - ะะฐัััะพะธัั ัะฐะนัะฒะพะป ะดะปั ะพะณัะฐะฝะธัะตะฝะธั IP ะฐะดัะตัะพะฒ
   - ะะปะธ ะฝะฐัััะพะธัั ะฒะตะฑ-ัะตัะฒะตั ะดะปั ะฑะปะพะบะธัะพะฒะบะธ ะฝะตัะฐะทัะตัะตะฝะฝัั IP

3. **ะะต ะบะพะผะผะธัะธัั `.env`:**
   - ะฃะฑะตะดะธัััั, ััะพ `.env` ะฒ `.gitignore`
   - ะัะฟะพะปัะทะพะฒะฐัั ัะฐะทะฝัะต ัะพะบะตะฝั ะดะปั ัะฐะทะฝัั ะพะบััะถะตะฝะธะน

4. **ะะพะณะธัะพะฒะฐะฝะธะต:**
   - ะัะต ะฟะพะฟััะบะธ ะดะตะฟะปะพั ะปะพะณะธัััััั
   - ะะตะณัะปััะฝะพ ะฟัะพะฒะตัััั ะปะพะณะธ: `storage/logs/laravel.log`

---

## ะงะฐััั 6: ะกัะตะผะฐ ัะฐะฑะพัั

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    ะะะะะะฌะะะฏ ะะะจะะะ                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                            โ
                            โ 1. php artisan deploy
                            โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  ะจะฐะณ 1: npm run build:all            โ
        โ  - ะกะฑะพัะบะฐ Vue ะฐะดะผะธะฝะบะธ                 โ
        โ  - ะกะฑะพัะบะฐ React ะฟัะธะปะพะถะตะฝะธั            โ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                            โ
                            โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  ะจะฐะณ 2: git status                    โ
        โ  - ะัะพะฒะตัะบะฐ ะธะทะผะตะฝะตะฝะธะน                 โ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                            โ
                            โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  ะจะฐะณ 3: git remote check              โ
        โ  - ะัะพะฒะตัะบะฐ/ะฝะฐัััะพะนะบะฐ remote          โ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                            โ
                            โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  ะจะฐะณ 4: git add .                     โ
        โ  - ะะพะฑะฐะฒะปะตะฝะธะต ะธะทะผะตะฝะตะฝะธะน                โ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                            โ
                            โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  ะจะฐะณ 5: git commit                    โ
        โ  - ะกะพะทะดะฐะฝะธะต ะบะพะผะผะธัะฐ                    โ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                            โ
                            โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  ะจะฐะณ 6: git push origin <ะฒะตัะบะฐ>       โ
        โ  - ะัะฟัะฐะฒะบะฐ ะฒ ัะตะฟะพะทะธัะพัะธะน              โ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                            โ
                            โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  ะจะฐะณ 7: POST /api/deploy              โ
        โ  Headers:                              โ
        โ    X-Deploy-Token: <ัะพะบะตะฝ>             โ
        โ  Body:                                 โ
        โ    {                                   โ
        โ      branch: "main",                   โ
        โ      commit_hash: "abc123",            โ
        โ      run_seeders: false                โ
        โ    }                                   โ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                            โ
                            โ HTTP POST
                            โ
                            โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                         ะกะะะะะ                                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                            โ
                            โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  Middleware: VerifyDeployToken        โ
        โ  - ะัะพะฒะตัะบะฐ ัะพะบะตะฝะฐ ะธะท ะทะฐะณะพะปะพะฒะบะฐ        โ
        โ  - ะกัะฐะฒะฝะตะฝะธะต ั DEPLOY_TOKEN            โ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                            โ
                            โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  DeployController::deploy()            โ
        โ  - ะะทะฒะปะตัะตะฝะธะต ะดะฐะฝะฝัั ะธะท ะทะฐะฟัะพัะฐ        โ
        โ  - ะะฟัะตะดะตะปะตะฝะธะต ะฒะตัะบะธ                   โ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                            โ
                            โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  1. git fetch origin <ะฒะตัะบะฐ>           โ
        โ  2. git reset --hard origin/<ะฒะตัะบะฐ>    โ
        โ  - ะะฑะฝะพะฒะปะตะฝะธะต ะบะพะดะฐ ะธะท ัะตะฟะพะทะธัะพัะธั      โ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                            โ
                            โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  3. composer install                   โ
        โ  - ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน              โ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                            โ
                            โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  4. php artisan migrate --force         โ
        โ  - ะัะธะผะตะฝะตะฝะธะต ะผะธะณัะฐัะธะน                 โ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                            โ
                            โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  5. php artisan db:seed (ะพะฟัะธะพะฝะฐะปัะฝะพ)  โ
        โ  - ะัะฟะพะปะฝะตะฝะธะต seeders                  โ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                            โ
                            โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  6. ะัะธััะบะฐ ะบะตัะตะน                     โ
        โ  - config:clear                        โ
        โ  - cache:clear                        โ
        โ  - route:clear                        โ
        โ  - view:clear                         โ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                            โ
                            โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  7. ะะฟัะธะผะธะทะฐัะธั                        โ
        โ  - config:cache                        โ
        โ  - route:cache                        โ
        โ  - view:cache                         โ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                            โ
                            โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  ะคะพัะผะธัะพะฒะฐะฝะธะต ะพัะฒะตัะฐ                   โ
        โ  {                                     โ
        โ    success: true,                      โ
        โ    data: { ... }                       โ
        โ  }                                     โ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                            โ
                            โ HTTP 200
                            โ
                            โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    ะะะะะะฌะะะฏ ะะะจะะะ                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                            โ
                            โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  ะัะฒะพะด ัะตะทัะปััะฐัะฐ ะฒ ะบะพะฝัะพะปั           โ
        โ  โ ะะตะฟะปะพะน ััะฟะตัะฝะพ ะทะฐะฒะตััะตะฝ!           โ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ะงะฐััั 7: ะัะธะผะตัั ะธัะฟะพะปัะทะพะฒะฐะฝะธั

### ะะฐะทะพะฒัะน ะดะตะฟะปะพะน
```bash
php artisan deploy
```

### ะะตะฟะปะพะน ั ะบะฐััะพะผะฝัะผ ัะพะพะฑัะตะฝะธะตะผ
```bash
php artisan deploy --message="ะัะฟัะฐะฒะปะตะฝะธะต ะฑะฐะณะฐ ั ะฟะพะดะฟะธัะบะฐะผะธ"
```

### ะะตะฟะปะพะน ะฑะตะท ัะฑะพัะบะธ ััะพะฝัะตะฝะดะฐ
```bash
php artisan deploy --skip-build
```

### ะะตะฟะปะพะน ั ะฒัะฟะพะปะฝะตะฝะธะตะผ seeders
```bash
php artisan deploy --with-seed
```

### ะะตะฟะปะพะน ั ะพัะบะปััะตะฝะฝะพะน ะฟัะพะฒะตัะบะพะน SSL
```bash
php artisan deploy --insecure
```

### ะัะพัะผะพัั ััะพ ะฑัะดะตั ัะดะตะปะฐะฝะพ (ะฑะตะท ะฒัะฟะพะปะฝะตะฝะธั)
```bash
php artisan deploy --dry-run
```

### ะัะธะฝัะดะธัะตะปัะฝะฐั ะพัะฟัะฐะฒะบะฐ (force push)
```bash
php artisan deploy --force
```

---

## ะงะฐััั 8: ะะพะณะธัะพะฒะฐะฝะธะต

### ะะพะบะฐะปัะฝัะต ะปะพะณะธ
- ะัะฒะพะดัััั ะฒ ะบะพะฝัะพะปั ะฟัะธ ะฒัะฟะพะปะฝะตะฝะธะธ ะบะพะผะฐะฝะดั
- ะะพะบะฐะทัะฒะฐัั ะฟัะพะณัะตัั ะบะฐะถะดะพะณะพ ัะฐะณะฐ
- ะัะฒะพะดัั ะพัะธะฑะบะธ ั ะดะตัะฐะปัะฝะพะน ะธะฝัะพัะผะฐัะธะตะน

### ะกะตัะฒะตัะฝัะต ะปะพะณะธ
- ะัะต ะดะตะนััะฒะธั ะปะพะณะธัััััั ะฒ `storage/logs/laravel.log`
- ะะบะปััะฐัั:
  - ะะฐัะฐะปะพ ะดะตะฟะปะพั (IP, ะฒัะตะผั)
  - ะัะฟะพะปัะทัะตะผัั ะฒะตัะบั
  - ะะตะทัะปััะฐัั git ะพะฟะตัะฐัะธะน
  - ะะตะทัะปััะฐัั composer install
  - ะะตะทัะปััะฐัั ะผะธะณัะฐัะธะน
  - ะะตะทัะปััะฐัั seeders
  - ะัะธะฑะบะธ (ะตัะปะธ ะตััั)

**ะัะธะผะตั ะปะพะณะพะฒ:**
```
[2025-01-20 12:00:00] local.INFO: ๐ ะะฐัะฐะปะพ ะดะตะฟะปะพั {"ip":"192.168.1.1"}
[2025-01-20 12:00:00] local.INFO: ๐ฟ ะัะฟะพะปัะทัะตััั ะฒะตัะบะฐ ะดะปั ะดะตะฟะปะพั: main
[2025-01-20 12:00:01] local.INFO: ๐ฅ ะัะฟะพะปะฝัะตะผ git fetch origin main...
[2025-01-20 12:00:02] local.INFO: โ Git fetch ะฒัะฟะพะปะฝะตะฝ ััะฟะตัะฝะพ
[2025-01-20 12:00:02] local.INFO: ๐ ะัะฟะพะปะฝัะตะผ git reset --hard origin/main...
[2025-01-20 12:00:03] local.INFO: โ ะะพะด ััะฟะตัะฝะพ ะพะฑะฝะพะฒะปะตะฝ
[2025-01-20 12:00:05] local.INFO: โ ะะตะฟะปะพะน ััะฟะตัะฝะพ ะทะฐะฒะตััะตะฝ
```

---

## ะะฐะบะปััะตะฝะธะต

ะะพะผะฐะฝะดะฐ `php artisan deploy` - ััะพ ะฟะพะปะฝะพัััั ะฐะฒัะพะผะฐัะธะทะธัะพะฒะฐะฝะฝะฐั ัะธััะตะผะฐ ะดะตะฟะปะพั, ะบะพัะพัะฐั:
1. ะกะพะฑะธัะฐะตั ััะพะฝัะตะฝะด ะปะพะบะฐะปัะฝะพ
2. ะะพะผะผะธัะธั ะธ ะพัะฟัะฐะฒะปัะตั ะธะทะผะตะฝะตะฝะธั ะฒ git
3. ะัะฟัะฐะฒะปัะตั ะทะฐะฟัะพั ะฝะฐ ัะตัะฒะตั ัะตัะตะท API
4. ะกะตัะฒะตั ะฐะฒัะพะผะฐัะธัะตัะบะธ ะพะฑะฝะพะฒะปัะตั ะบะพะด, ัััะฐะฝะฐะฒะปะธะฒะฐะตั ะทะฐะฒะธัะธะผะพััะธ, ะฟัะธะผะตะฝัะตั ะผะธะณัะฐัะธะธ ะธ ะพะฟัะธะผะธะทะธััะตั ะฟัะธะปะพะถะตะฝะธะต
5. ะะพะทะฒัะฐัะฐะตั ะดะตัะฐะปัะฝัะน ะพััะตั ะพ ะฒัะฟะพะปะฝะตะฝะธะธ

ะัั ัะธััะตะผะฐ ัะฐะฑะพัะฐะตั ัะตัะตะท HTTP API, ััะพ ะฟะพะทะฒะพะปัะตั ะดะตะฟะปะพะธัั ั ะปัะฑะพะน ะผะฐัะธะฝั, ะธะผะตััะตะน ะดะพัััะฟ ะบ ัะตัะฒะตัั ะธ ะธะฝัะตัะฝะตัั.


