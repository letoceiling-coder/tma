import{_ as A,c as n,a as e,b as u,p as N,e as V,t as w,d as b,A as F,F as I,q as P,w as j,f as L,r as d,m as z,k as W,h as q,o as i,B as G,v as h,C as R}from"./admin-fFV2fNlM.js";import{a as H,c as C}from"./api-DccBIR6h.js";import{S as f}from"./sweetalert2.esm.all-C0u8rGqG.js";import J from"./Media-C80yMYbF.js";const K={name:"Wheel",components:{Media:J},setup(){const g=d(!1),t=d(!1),v=d(!1),o=d(null),p=d([]),x=d(!1),m=d(!1),l=d(null),a=d(null),k=z(()=>p.value.reduce((s,r)=>s+(parseFloat(r.probability_percent)||0),0)),M=z(()=>Math.abs(k.value-100)<.01),_=async()=>{g.value=!0,o.value=null;try{const s=await H("/wow/wheel");if(!s.ok)throw new Error("ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ ÑÐµÐºÑ‚Ð¾Ñ€Ð¾Ð²");const r=await s.json();p.value=(r.data||[]).map(y=>({...y,probability_percent:parseFloat(y.probability_percent)||0,prize_value:y.prize_value||0})),r.settings&&(x.value=r.settings.always_empty_mode||!1)}catch(s){o.value=s.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ ÑÐµÐºÑ‚Ð¾Ñ€Ð¾Ð²"}finally{g.value=!1}},U=async()=>{if(!M.value){await f.fire({title:"ÐžÑˆÐ¸Ð±ÐºÐ°",text:"Ð¡ÑƒÐ¼Ð¼Ð° Ð²ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚ÐµÐ¹ Ð´Ð¾Ð»Ð¶Ð½Ð° Ð±Ñ‹Ñ‚ÑŒ Ñ€Ð°Ð²Ð½Ð° 100%",icon:"error",confirmButtonText:"ÐžÐš"});return}t.value=!0,o.value=null;try{const s=p.value.map(c=>({id:c.id,prize_type:c.prize_type,prize_value:c.prize_value||0,icon_url:c.icon_url||null,probability_percent:parseFloat(c.probability_percent)||0,is_active:c.is_active!==!1})),r=await C("/wow/wheel/bulk-update",{sectors:s});if(!r.ok){const c=await r.json();throw new Error(c.message||"ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ ÑÐµÐºÑ‚Ð¾Ñ€Ð¾Ð²")}const y=await r.json();await f.fire({title:"Ð¡ÐµÐºÑ‚Ð¾Ñ€Ñ‹ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ñ‹",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),await _()}catch(s){o.value=s.message||"ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ ÑÐµÐºÑ‚Ð¾Ñ€Ð¾Ð²",await f.fire({title:"ÐžÑˆÐ¸Ð±ÐºÐ°",text:s.message||"ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ ÑÐµÐºÑ‚Ð¾Ñ€Ð¾Ð²",icon:"error",confirmButtonText:"ÐžÐš"})}finally{t.value=!1}},E=s=>{s.target.style.display="none"},B=s=>{l.value=s,a.value=null,m.value=!0},S=()=>{m.value=!1,l.value=null,a.value=null},T=s=>{if(l.value&&s){const r=s.url||(s.metadata?.path?"/"+s.metadata.path:"");l.value.icon_url=r||"",a.value=s,setTimeout(()=>{S()},300)}},D=async()=>{v.value=!0;try{const s=await C("/wow/wheel/settings",{always_empty_mode:x.value});if(!s.ok){const r=await s.json();throw new Error(r.message||"ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐº")}await f.fire({title:"ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ñ‹",icon:"success",timer:1500,showConfirmButton:!1,toast:!0,position:"top-end"})}catch(s){await f.fire({title:"ÐžÑˆÐ¸Ð±ÐºÐ°",text:s.message||"ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐº",icon:"error",confirmButtonText:"ÐžÐš"}),await _()}finally{v.value=!1}};return W(()=>{_()}),{loading:g,saving:t,savingSettings:v,error:o,sectors:p,alwaysEmptyMode:x,totalProbability:k,probabilityValid:M,saveAllSectors:U,saveSettings:D,handleImageError:E,showMediaModal:m,currentSector:l,selectedMediaFile:a,openMediaSelector:B,closeMediaModal:S,handleMediaFileSelected:T}}},O={class:"wheel-page space-y-6"},Q={class:"flex items-center justify-between"},X={class:"flex items-center gap-4"},Y={key:0,class:"ml-2"},Z=["disabled"],$={key:0,class:"bg-card rounded-lg border border-border p-6"},ee={class:"flex items-center justify-between"},te={class:"relative inline-flex items-center cursor-pointer"},oe={key:1,class:"flex items-center justify-center py-12"},le={key:2,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},se={class:"text-destructive"},ae={key:3,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},re={class:"flex items-center justify-between"},ne={class:"text-lg font-semibold"},ie={class:"flex items-center gap-2 cursor-pointer"},de=["onUpdate:modelValue"],ce=["onUpdate:modelValue"],ue={key:0},be=["onUpdate:modelValue"],pe=["onUpdate:modelValue"],me={class:"mt-1 h-2 bg-muted rounded-full overflow-hidden"},fe={class:"flex gap-2"},ge=["onUpdate:modelValue"],ve=["onClick"],xe={key:0,class:"mt-2"},ye=["src","alt"],we={class:"flex items-center justify-between p-4 border-b border-border"},_e={class:"flex-1 overflow-hidden"};function he(g,t,v,o,p,x){const m=q("Media");return i(),n("div",O,[e("div",Q,[t[7]||(t[7]=e("div",null,[e("h1",{class:"text-3xl font-semibold text-foreground"},"Ð ÐµÐ´Ð°ÐºÑ‚Ð¾Ñ€ Ñ€ÑƒÐ»ÐµÑ‚ÐºÐ¸"),e("p",{class:"text-muted-foreground mt-1"},"ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° ÑÐµÐºÑ‚Ð¾Ñ€Ð¾Ð² Ñ€ÑƒÐ»ÐµÑ‚ÐºÐ¸ Ð¸ Ð²ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚ÐµÐ¹ Ð²Ñ‹Ð¿Ð°Ð´ÐµÐ½Ð¸Ñ")],-1)),e("div",X,[e("div",{class:N(["px-4 py-2 rounded-lg text-sm font-medium",o.probabilityValid?"bg-green-500/10 text-green-600":"bg-red-500/10 text-red-600"])},[V(" Ð’ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚ÑŒ: "+w(o.totalProbability.toFixed(2))+"% ",1),o.probabilityValid?u("",!0):(i(),n("span",Y,"(Ð´Ð¾Ð»Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ 100%)"))],2),e("button",{onClick:t[0]||(t[0]=(...l)=>o.saveAllSectors&&o.saveAllSectors(...l)),disabled:!o.probabilityValid||o.saving,class:"h-11 px-6 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-2xl shadow-lg shadow-accent/10 inline-flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"},[e("span",null,w(o.saving?"Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ...":"Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ Ð²ÑÐµ"),1)],8,Z)])]),o.loading?u("",!0):(i(),n("div",$,[t[10]||(t[10]=e("h2",{class:"text-xl font-semibold mb-4"},"ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ñ€ÑƒÐ»ÐµÑ‚ÐºÐ¸",-1)),e("div",ee,[t[9]||(t[9]=e("div",null,[e("h3",{class:"text-base font-medium mb-1"},'Ð ÐµÐ¶Ð¸Ð¼ "Ð’ÑÐµÐ³Ð´Ð° Ð¿ÑƒÑÑ‚Ð¾"'),e("p",{class:"text-sm text-muted-foreground"}," ÐŸÑ€Ð¸ Ð²ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ð¸ ÐºÐ¾Ð»ÐµÑÐ¾ Ð²ÑÐµÐ³Ð´Ð° Ð±ÑƒÐ´ÐµÑ‚ Ð¾ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°Ñ‚ÑŒÑÑ Ð½Ð° Ð¿ÑƒÑÑ‚Ð¾Ð¼ ÑÐµÐºÑ‚Ð¾Ñ€Ðµ ")],-1)),e("label",te,[b(e("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>o.alwaysEmptyMode=l),onChange:t[2]||(t[2]=(...l)=>o.saveSettings&&o.saveSettings(...l)),type:"checkbox",class:"sr-only peer"},null,544),[[F,o.alwaysEmptyMode]]),t[8]||(t[8]=e("div",{class:"w-11 h-6 bg-muted peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-accent/20 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-border after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-accent"},null,-1))])])])),o.loading?(i(),n("div",oe,[...t[11]||(t[11]=[e("p",{class:"text-muted-foreground"},"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° ÑÐµÐºÑ‚Ð¾Ñ€Ð¾Ð²...",-1)])])):u("",!0),o.error?(i(),n("div",le,[e("p",se,w(o.error),1)])):u("",!0),o.loading?u("",!0):(i(),n("div",ae,[(i(!0),n(I,null,P(o.sectors,l=>(i(),n("div",{key:l.id,class:"bg-card rounded-lg border border-border p-6 space-y-4"},[e("div",re,[e("h3",ne,"Ð¡ÐµÐºÑ‚Ð¾Ñ€ #"+w(l.sector_number),1),e("label",ie,[b(e("input",{"onUpdate:modelValue":a=>l.is_active=a,type:"checkbox",class:"w-4 h-4"},null,8,de),[[F,l.is_active]]),t[12]||(t[12]=e("span",{class:"text-sm"},"ÐÐºÑ‚Ð¸Ð²ÐµÐ½",-1))])]),e("div",null,[t[14]||(t[14]=e("label",{class:"text-sm font-medium mb-1 block"},"Ð¢Ð¸Ð¿ Ð¿Ñ€Ð¸Ð·Ð°",-1)),b(e("select",{"onUpdate:modelValue":a=>l.prize_type=a,class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},[...t[13]||(t[13]=[e("option",{value:"empty"},"ÐŸÑƒÑÑ‚Ð¾",-1),e("option",{value:"money"},"Ð”ÐµÐ½ÑŒÐ³Ð¸",-1),e("option",{value:"ticket"},"Ð‘Ð¸Ð»ÐµÑ‚",-1),e("option",{value:"secret_box"},"Ð¡ÐµÐºÑ€ÐµÑ‚Ð½Ñ‹Ð¹ Ð±Ð¾ÐºÑ",-1)])],8,ce),[[G,l.prize_type]])]),l.prize_type==="money"?(i(),n("div",ue,[t[15]||(t[15]=e("label",{class:"text-sm font-medium mb-1 block"},"Ð¡ÑƒÐ¼Ð¼Ð° (â‚½)",-1)),b(e("input",{"onUpdate:modelValue":a=>l.prize_value=a,type:"number",min:"0",placeholder:"300",class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,8,be),[[h,l.prize_value,void 0,{number:!0}]])])):u("",!0),e("div",null,[t[16]||(t[16]=e("label",{class:"text-sm font-medium mb-1 block"},[V(" Ð’ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚ÑŒ (%) "),e("span",{class:"text-xs text-muted-foreground"},"(0-100)")],-1)),b(e("input",{"onUpdate:modelValue":a=>l.probability_percent=a,type:"number",min:"0",max:"100",step:"0.01",placeholder:"0.00",class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,8,pe),[[h,l.probability_percent,void 0,{number:!0}]]),e("div",me,[e("div",{class:"h-full bg-accent transition-all",style:R({width:`${l.probability_percent}%`})},null,4)])]),e("div",null,[t[17]||(t[17]=e("label",{class:"text-sm font-medium mb-1 block"},"URL Ð¸ÐºÐ¾Ð½ÐºÐ¸",-1)),e("div",fe,[b(e("input",{"onUpdate:modelValue":a=>l.icon_url=a,type:"text",placeholder:"https://...",class:"flex-1 h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,8,ge),[[h,l.icon_url]]),e("button",{onClick:a=>o.openMediaSelector(l),type:"button",class:"h-10 px-4 bg-accent/10 text-accent border border-accent/40 hover:bg-accent/20 rounded-lg inline-flex items-center justify-center gap-2 transition-colors",title:"Ð’Ñ‹Ð±Ñ€Ð°Ñ‚ÑŒ Ð¸Ð· Ð¼ÐµÐ´Ð¸Ð°Ñ‚ÐµÐºÐ¸"}," ðŸ“ ",8,ve)]),l.icon_url?(i(),n("div",xe,[e("img",{src:l.icon_url,alt:`Ð¡ÐµÐºÑ‚Ð¾Ñ€ ${l.sector_number}`,class:"w-16 h-16 object-contain rounded",onError:t[3]||(t[3]=(...a)=>o.handleImageError&&o.handleImageError(...a))},null,40,ye)])):u("",!0)])]))),128))])),o.showMediaModal?(i(),n("div",{key:4,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm",onClick:t[6]||(t[6]=j((...l)=>o.closeMediaModal&&o.closeMediaModal(...l),["self"]))},[e("div",{class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-6xl h-[90vh] flex flex-col",onClick:t[5]||(t[5]=j(()=>{},["stop"]))},[e("div",we,[t[18]||(t[18]=e("h3",{class:"text-lg font-semibold"},"Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¸ÐºÐ¾Ð½ÐºÑƒ",-1)),e("button",{onClick:t[4]||(t[4]=(...l)=>o.closeMediaModal&&o.closeMediaModal(...l)),class:"w-8 h-8 flex items-center justify-center rounded-lg hover:bg-muted transition-colors"}," âœ• ")]),e("div",_e,[L(m,{selectionMode:!0,countFile:1,selectedFiles:o.selectedMediaFile?[o.selectedMediaFile]:[],onFileSelected:o.handleMediaFileSelected},null,8,["selectedFiles","onFileSelected"])])])])):u("",!0)])}const Fe=A(K,[["render",he]]);export{Fe as default};
