import{_ as I,c as r,a as t,b as g,d as h,A as H,v as S,t as i,F as T,q as P,w as V,r as c,k as G,i as J,j as A,h as K,o as n,p as B,f as O,e as Q}from"./admin-CVJgAGJK.js";import{S as M}from"./sweetalert2.esm.all-C0u8rGqG.js";import{S as W}from"./StatusBadge-SoJ7b3PT.js";const X={name:"Support",components:{StatusBadge:W},setup(){const x=J(),a=c(!1),f=c(null),e=c([]),y=c(null),_=c(!1),p=c(!1),o=c({search:"",status:""}),u=c(1),j=c(20),k=c(null),m=c({theme:"",message:"",attachments:[]}),F=()=>({Authorization:`Bearer ${localStorage.getItem("token")}`,Accept:"application/json"}),b=async(s=1)=>{a.value=!0,f.value=null;try{const l=new URLSearchParams;l.append("page",s),l.append("per_page",j.value),o.value.status&&l.append("status",o.value.status);const d=await A.get(`/api/v1/support/tickets?${l.toString()}`,{headers:F()});d.data.success&&(e.value=d.data.data.data||[],y.value={current_page:d.data.data.current_page,last_page:d.data.data.last_page,from:d.data.data.from,to:d.data.data.to,total:d.data.data.total})}catch(l){f.value=l.response?.data?.message||"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ç–∏–∫–µ—Ç–æ–≤",console.error("Error fetching tickets:",l)}finally{a.value=!1}},D=()=>{u.value=1,b(1)},U=()=>{k.value&&clearTimeout(k.value),k.value=setTimeout(()=>{u.value=1,b(1)},500)},z=s=>{u.value=s,b(s)},q=(s,l)=>{const d=[];let v=Math.max(1,s-Math.floor(2.5)),w=Math.min(l,v+5-1);w-v<4&&(v=Math.max(1,w-5+1));for(let C=v;C<=w;C++)d.push(C);return d},E=s=>s?new Date(s).toLocaleString("ru-RU"):"",L=s=>{const l=Array.from(s.target.files);m.value.attachments=l},N=s=>{m.value.attachments.splice(s,1)},R=async()=>{p.value=!0;try{const s=new FormData;s.append("theme",m.value.theme),s.append("message",m.value.message),m.value.attachments.forEach(d=>{s.append("attachments[]",d)});const l=await A.post("/api/v1/support/ticket",s,{headers:{...F(),"Content-Type":"multipart/form-data"}});l.data.success?(M.fire("–£—Å–ø–µ—Ö","–¢–∏–∫–µ—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω","success"),_.value=!1,m.value={theme:"",message:"",attachments:[]},b()):M.fire("–û—à–∏–±–∫–∞",l.data.message||"–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å —Ç–∏–∫–µ—Ç","error")}catch(s){M.fire("–û—à–∏–±–∫–∞",s.response?.data?.message||"–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å —Ç–∏–∫–µ—Ç","error")}finally{p.value=!1}};return G(()=>{b()}),{router:x,loading:a,error:f,tickets:e,pagination:y,showCreateModal:_,creating:p,filters:o,newTicket:m,fetchTickets:b,handleFilterChange:D,handleSearch:U,handlePageChange:z,getPageNumbers:q,formatDate:E,handleFileSelect:L,removeAttachment:N,createTicket:R}}},Y={class:"support-page space-y-6"},Z={class:"flex items-center justify-between"},$={class:"bg-card rounded-lg border border-border p-4"},ee={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},te={class:"md:col-span-2"},ae={class:"relative"},oe={key:0,class:"flex items-center justify-center py-12"},se={key:1,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},re={class:"text-destructive"},ne={key:2,class:"space-y-3"},le=["onClick"],de={class:"flex items-start justify-between gap-4"},ie={class:"flex-1 min-w-0"},ce={class:"flex items-center gap-2 mb-2"},ge={class:"font-semibold text-foreground"},ue={class:"text-sm text-muted-foreground mb-2"},me={key:0},be={class:"flex items-center gap-4 text-xs text-muted-foreground"},pe={key:0},fe={key:3,class:"bg-card rounded-lg border border-border p-12 text-center"},ve={key:4,class:"flex flex-col sm:flex-row items-center justify-between pt-6 border-t border-border gap-4"},he={class:"text-sm text-muted-foreground"},xe={class:"flex gap-2 items-center"},ye=["disabled"],_e={class:"flex gap-1"},ke=["onClick"],we=["disabled"],Ce={class:"bg-card rounded-lg border border-border p-6 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"},Se={class:"space-y-4"},Te={key:0,class:"mt-2 space-y-1"},Pe=["onClick"],Me={class:"flex gap-3 mt-6"},je=["disabled"];function Fe(x,a,f,e,y,_){const p=K("StatusBadge");return n(),r("div",Y,[t("div",Z,[a[13]||(a[13]=t("div",null,[t("h1",{class:"text-3xl font-semibold text-foreground"},"–ü–æ–¥–¥–µ—Ä–∂–∫–∞"),t("p",{class:"text-muted-foreground mt-1"},"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∏–∫–µ—Ç–∞–º–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏")],-1)),t("button",{onClick:a[0]||(a[0]=o=>e.showCreateModal=!0),class:"px-4 py-2 bg-accent text-accent-foreground rounded-lg hover:bg-accent/90 transition-colors"}," + –°–æ–∑–¥–∞—Ç—å —Ç–∏–∫–µ—Ç ")]),t("div",$,[t("div",ee,[t("div",null,[h(t("select",{"onUpdate:modelValue":a[1]||(a[1]=o=>e.filters.status=o),onChange:a[2]||(a[2]=(...o)=>e.handleFilterChange&&e.handleFilterChange(...o)),class:"w-full h-10 px-3 border border-border rounded bg-background text-sm"},[...a[14]||(a[14]=[t("option",{value:""},"–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã",-1),t("option",{value:"open"},"–û—Ç–∫—Ä—ã—Ç",-1),t("option",{value:"in_progress"},"–í —Ä–∞–±–æ—Ç–µ",-1),t("option",{value:"closed"},"–ó–∞–∫—Ä—ã—Ç",-1)])],544),[[H,e.filters.status]])]),t("div",te,[t("div",ae,[a[15]||(a[15]=t("span",{class:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"},"üîç",-1)),h(t("input",{type:"text","onUpdate:modelValue":a[3]||(a[3]=o=>e.filters.search=o),onInput:a[4]||(a[4]=(...o)=>e.handleSearch&&e.handleSearch(...o)),placeholder:"–ü–æ–∏—Å–∫ –ø–æ —Ç–µ–º–µ...",class:"w-full h-10 pl-9 pr-3 border border-border rounded bg-background text-sm"},null,544),[[S,e.filters.search]])])])])]),e.loading?(n(),r("div",oe,[...a[16]||(a[16]=[t("p",{class:"text-muted-foreground"},"–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤...",-1)])])):g("",!0),e.error?(n(),r("div",se,[t("p",re,i(e.error),1)])):g("",!0),!e.loading&&e.tickets.length>0?(n(),r("div",ne,[(n(!0),r(T,null,P(e.tickets,o=>(n(),r("div",{key:o.id,onClick:u=>x.$router.push({name:"admin.support.ticket",params:{id:o.id}}),class:B(["bg-card rounded-lg border p-4 cursor-pointer transition-colors hover:border-accent","border-border"])},[t("div",de,[t("div",ie,[t("div",ce,[t("h3",ge,i(o.subject||o.theme),1),O(p,{status:o.status},null,8,["status"])]),t("p",ue,[Q(i(o.messages?.[0]?.body||o.messages?.[0]?.message||"–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π")+" ",1),o.messages?.[0]?.body||o.messages?.[0]?.message?(n(),r("span",me,i((o.messages[0].body||o.messages[0].message).length>100?"...":""),1)):g("",!0)]),t("div",be,[t("span",null,"–°–æ–∑–¥–∞–Ω: "+i(e.formatDate(o.created_at)),1),o.messages?.length?(n(),r("span",pe," –°–æ–æ–±—â–µ–Ω–∏–π: "+i(o.messages.length),1)):g("",!0)])])])],8,le))),128))])):g("",!0),!e.loading&&e.tickets.length===0?(n(),r("div",fe,[...a[17]||(a[17]=[t("p",{class:"text-muted-foreground"},"–¢–∏–∫–µ—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã",-1)])])):g("",!0),e.pagination&&e.pagination.last_page>1?(n(),r("div",ve,[t("div",he,[t("span",null," –ü–æ–∫–∞–∑–∞–Ω–æ "+i(e.pagination.from)+"-"+i(e.pagination.to)+" –∏–∑ "+i(e.pagination.total),1)]),t("div",xe,[t("button",{onClick:a[5]||(a[5]=o=>e.handlePageChange(e.pagination.current_page-1)),disabled:e.pagination.current_page===1,class:"px-3 py-2 rounded-md border border-border bg-background hover:bg-accent/10 disabled:opacity-50 disabled:cursor-not-allowed text-sm transition-colors"}," ‚Üê –ù–∞–∑–∞–¥ ",8,ye),t("div",_e,[(n(!0),r(T,null,P(e.getPageNumbers(e.pagination.current_page,e.pagination.last_page),o=>(n(),r("button",{key:o,onClick:u=>e.handlePageChange(o),class:B(["px-3 py-2 rounded-md border text-sm transition-colors min-w-[40px]",o===e.pagination.current_page?"bg-accent text-accent-foreground border-accent font-semibold":"border-border bg-background hover:bg-accent/10"])},i(o),11,ke))),128))]),t("button",{onClick:a[6]||(a[6]=o=>e.handlePageChange(e.pagination.current_page+1)),disabled:e.pagination.current_page===e.pagination.last_page,class:"px-3 py-2 rounded-md border border-border bg-background hover:bg-accent/10 disabled:opacity-50 disabled:cursor-not-allowed text-sm transition-colors"}," –í–ø–µ—Ä–µ–¥ ‚Üí ",8,we)])])):g("",!0),e.showCreateModal?(n(),r("div",{key:5,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:a[12]||(a[12]=V(o=>e.showCreateModal=!1,["self"]))},[t("div",Ce,[a[21]||(a[21]=t("h2",{class:"text-2xl font-semibold mb-4"},"–°–æ–∑–¥–∞—Ç—å —Ç–∏–∫–µ—Ç",-1)),t("form",{onSubmit:a[11]||(a[11]=V((...o)=>e.createTicket&&e.createTicket(...o),["prevent"]))},[t("div",Se,[t("div",null,[a[18]||(a[18]=t("label",{class:"block text-sm font-medium mb-2"},"–¢–µ–º–∞",-1)),h(t("input",{"onUpdate:modelValue":a[7]||(a[7]=o=>e.newTicket.theme=o),type:"text",required:"",class:"w-full h-10 px-3 border border-border rounded bg-background",placeholder:"–í–≤–µ–¥–∏—Ç–µ —Ç–µ–º—É —Ç–∏–∫–µ—Ç–∞"},null,512),[[S,e.newTicket.theme]])]),t("div",null,[a[19]||(a[19]=t("label",{class:"block text-sm font-medium mb-2"},"–°–æ–æ–±—â–µ–Ω–∏–µ",-1)),h(t("textarea",{"onUpdate:modelValue":a[8]||(a[8]=o=>e.newTicket.message=o),required:"",rows:"5",class:"w-full px-3 py-2 border border-border rounded bg-background resize-none",placeholder:"–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ"},null,512),[[S,e.newTicket.message]])]),t("div",null,[a[20]||(a[20]=t("label",{class:"block text-sm font-medium mb-2"},"–í–ª–æ–∂–µ–Ω–∏—è",-1)),t("input",{type:"file",onChange:a[9]||(a[9]=(...o)=>e.handleFileSelect&&e.handleFileSelect(...o)),multiple:"",accept:"image/*,.pdf,.doc,.docx,.txt",class:"w-full h-10 px-3 border border-border rounded bg-background"},null,32),e.newTicket.attachments.length>0?(n(),r("div",Te,[(n(!0),r(T,null,P(e.newTicket.attachments,(o,u)=>(n(),r("div",{key:u,class:"text-sm text-muted-foreground flex items-center justify-between"},[t("span",null,i(o.name),1),t("button",{type:"button",onClick:j=>e.removeAttachment(u),class:"text-destructive hover:text-destructive/80"}," ‚úï ",8,Pe)]))),128))])):g("",!0)])]),t("div",Me,[t("button",{type:"submit",disabled:e.creating,class:"px-4 py-2 bg-accent text-accent-foreground rounded-lg hover:bg-accent/90 disabled:opacity-50 transition-colors"},i(e.creating?"–°–æ–∑–¥–∞–Ω–∏–µ...":"–°–æ–∑–¥–∞—Ç—å"),9,je),t("button",{type:"button",onClick:a[10]||(a[10]=o=>e.showCreateModal=!1),class:"px-4 py-2 border border-border rounded-lg hover:bg-accent/10 transition-colors"}," –û—Ç–º–µ–Ω–∞ ")])],32)])])):g("",!0)])}const Ue=I(X,[["render",Fe]]);export{Ue as default};
