import{_ as U,c as s,a as e,b as c,p as B,e as M,t as x,F as E,q as T,w as V,f as A,r as u,m as F,k as D,h as N,o as r,d as f,A as I,B as P,v as y,C as L}from"./admin-D73EZYWO.js";import{a as W,c as q}from"./api-DccBIR6h.js";import{S as h}from"./sweetalert2.esm.all-C0u8rGqG.js";import G from"./Media-BKx4vCBV.js";const R={name:"Wheel",components:{Media:G},setup(){const v=u(!1),t=u(!1),b=u(null),o=u([]),g=u(!1),p=u(null),m=u(null),l=F(()=>o.value.reduce((a,i)=>a+(parseFloat(i.probability_percent)||0),0)),n=F(()=>Math.abs(l.value-100)<.01),w=async()=>{v.value=!0,b.value=null;try{const a=await W("/wow/wheel");if(!a.ok)throw new Error("ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ ÑÐµÐºÑ‚Ð¾Ñ€Ð¾Ð²");const i=await a.json();o.value=(i.data||[]).map(_=>({..._,probability_percent:parseFloat(_.probability_percent)||0,prize_value:_.prize_value||0}))}catch(a){b.value=a.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ ÑÐµÐºÑ‚Ð¾Ñ€Ð¾Ð²"}finally{v.value=!1}},S=async()=>{if(!n.value){await h.fire({title:"ÐžÑˆÐ¸Ð±ÐºÐ°",text:"Ð¡ÑƒÐ¼Ð¼Ð° Ð²ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚ÐµÐ¹ Ð´Ð¾Ð»Ð¶Ð½Ð° Ð±Ñ‹Ñ‚ÑŒ Ñ€Ð°Ð²Ð½Ð° 100%",icon:"error",confirmButtonText:"ÐžÐš"});return}t.value=!0,b.value=null;try{const a=o.value.map(d=>({id:d.id,prize_type:d.prize_type,prize_value:d.prize_value||0,icon_url:d.icon_url||null,probability_percent:parseFloat(d.probability_percent)||0,is_active:d.is_active!==!1})),i=await q("/wow/wheel/bulk-update",{sectors:a});if(!i.ok){const d=await i.json();throw new Error(d.message||"ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ ÑÐµÐºÑ‚Ð¾Ñ€Ð¾Ð²")}const _=await i.json();await h.fire({title:"Ð¡ÐµÐºÑ‚Ð¾Ñ€Ñ‹ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ñ‹",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),await w()}catch(a){b.value=a.message||"ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ ÑÐµÐºÑ‚Ð¾Ñ€Ð¾Ð²",await h.fire({title:"ÐžÑˆÐ¸Ð±ÐºÐ°",text:a.message||"ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ ÑÐµÐºÑ‚Ð¾Ñ€Ð¾Ð²",icon:"error",confirmButtonText:"ÐžÐš"})}finally{t.value=!1}},z=a=>{a.target.style.display="none"},j=a=>{p.value=a,m.value=null,g.value=!0},k=()=>{g.value=!1,p.value=null,m.value=null},C=a=>{if(p.value&&a){const i=a.url||(a.metadata?.path?"/"+a.metadata.path:"");p.value.icon_url=i||"",m.value=a,setTimeout(()=>{k()},300)}};return D(()=>{w()}),{loading:v,saving:t,error:b,sectors:o,totalProbability:l,probabilityValid:n,saveAllSectors:S,handleImageError:z,showMediaModal:g,currentSector:p,selectedMediaFile:m,openMediaSelector:j,closeMediaModal:k,handleMediaFileSelected:C}}},H={class:"wheel-page space-y-6"},J={class:"flex items-center justify-between"},K={class:"flex items-center gap-4"},O={key:0,class:"ml-2"},Q=["disabled"],X={key:0,class:"flex items-center justify-center py-12"},Y={key:1,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},Z={class:"text-destructive"},$={key:2,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},ee={class:"flex items-center justify-between"},te={class:"text-lg font-semibold"},oe={class:"flex items-center gap-2 cursor-pointer"},le=["onUpdate:modelValue"],ae=["onUpdate:modelValue"],ne={key:0},se=["onUpdate:modelValue"],re=["onUpdate:modelValue"],ie={class:"mt-1 h-2 bg-muted rounded-full overflow-hidden"},de={class:"flex gap-2"},ce=["onUpdate:modelValue"],ue=["onClick"],be={key:0,class:"mt-2"},pe=["src","alt"],me={class:"flex items-center justify-between p-4 border-b border-border"},fe={class:"flex-1 overflow-hidden"};function ve(v,t,b,o,g,p){const m=N("Media");return r(),s("div",H,[e("div",J,[t[5]||(t[5]=e("div",null,[e("h1",{class:"text-3xl font-semibold text-foreground"},"Ð ÐµÐ´Ð°ÐºÑ‚Ð¾Ñ€ Ñ€ÑƒÐ»ÐµÑ‚ÐºÐ¸"),e("p",{class:"text-muted-foreground mt-1"},"ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° ÑÐµÐºÑ‚Ð¾Ñ€Ð¾Ð² Ñ€ÑƒÐ»ÐµÑ‚ÐºÐ¸ Ð¸ Ð²ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚ÐµÐ¹ Ð²Ñ‹Ð¿Ð°Ð´ÐµÐ½Ð¸Ñ")],-1)),e("div",K,[e("div",{class:B(["px-4 py-2 rounded-lg text-sm font-medium",o.probabilityValid?"bg-green-500/10 text-green-600":"bg-red-500/10 text-red-600"])},[M(" Ð’ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚ÑŒ: "+x(o.totalProbability.toFixed(2))+"% ",1),o.probabilityValid?c("",!0):(r(),s("span",O,"(Ð´Ð¾Ð»Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ 100%)"))],2),e("button",{onClick:t[0]||(t[0]=(...l)=>o.saveAllSectors&&o.saveAllSectors(...l)),disabled:!o.probabilityValid||o.saving,class:"h-11 px-6 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-2xl shadow-lg shadow-accent/10 inline-flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"},[e("span",null,x(o.saving?"Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ...":"Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ Ð²ÑÐµ"),1)],8,Q)])]),o.loading?(r(),s("div",X,[...t[6]||(t[6]=[e("p",{class:"text-muted-foreground"},"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° ÑÐµÐºÑ‚Ð¾Ñ€Ð¾Ð²...",-1)])])):c("",!0),o.error?(r(),s("div",Y,[e("p",Z,x(o.error),1)])):c("",!0),o.loading?c("",!0):(r(),s("div",$,[(r(!0),s(E,null,T(o.sectors,l=>(r(),s("div",{key:l.id,class:"bg-card rounded-lg border border-border p-6 space-y-4"},[e("div",ee,[e("h3",te,"Ð¡ÐµÐºÑ‚Ð¾Ñ€ #"+x(l.sector_number),1),e("label",oe,[f(e("input",{"onUpdate:modelValue":n=>l.is_active=n,type:"checkbox",class:"w-4 h-4"},null,8,le),[[I,l.is_active]]),t[7]||(t[7]=e("span",{class:"text-sm"},"ÐÐºÑ‚Ð¸Ð²ÐµÐ½",-1))])]),e("div",null,[t[9]||(t[9]=e("label",{class:"text-sm font-medium mb-1 block"},"Ð¢Ð¸Ð¿ Ð¿Ñ€Ð¸Ð·Ð°",-1)),f(e("select",{"onUpdate:modelValue":n=>l.prize_type=n,class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},[...t[8]||(t[8]=[e("option",{value:"empty"},"ÐŸÑƒÑÑ‚Ð¾",-1),e("option",{value:"money"},"Ð”ÐµÐ½ÑŒÐ³Ð¸",-1),e("option",{value:"ticket"},"Ð‘Ð¸Ð»ÐµÑ‚",-1),e("option",{value:"secret_box"},"Ð¡ÐµÐºÑ€ÐµÑ‚Ð½Ñ‹Ð¹ Ð±Ð¾ÐºÑ",-1)])],8,ae),[[P,l.prize_type]])]),l.prize_type==="money"?(r(),s("div",ne,[t[10]||(t[10]=e("label",{class:"text-sm font-medium mb-1 block"},"Ð¡ÑƒÐ¼Ð¼Ð° (â‚½)",-1)),f(e("input",{"onUpdate:modelValue":n=>l.prize_value=n,type:"number",min:"0",placeholder:"300",class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,8,se),[[y,l.prize_value,void 0,{number:!0}]])])):c("",!0),e("div",null,[t[11]||(t[11]=e("label",{class:"text-sm font-medium mb-1 block"},[M(" Ð’ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚ÑŒ (%) "),e("span",{class:"text-xs text-muted-foreground"},"(0-100)")],-1)),f(e("input",{"onUpdate:modelValue":n=>l.probability_percent=n,type:"number",min:"0",max:"100",step:"0.01",placeholder:"0.00",class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,8,re),[[y,l.probability_percent,void 0,{number:!0}]]),e("div",ie,[e("div",{class:"h-full bg-accent transition-all",style:L({width:`${l.probability_percent}%`})},null,4)])]),e("div",null,[t[12]||(t[12]=e("label",{class:"text-sm font-medium mb-1 block"},"URL Ð¸ÐºÐ¾Ð½ÐºÐ¸",-1)),e("div",de,[f(e("input",{"onUpdate:modelValue":n=>l.icon_url=n,type:"text",placeholder:"https://...",class:"flex-1 h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,8,ce),[[y,l.icon_url]]),e("button",{onClick:n=>o.openMediaSelector(l),type:"button",class:"h-10 px-4 bg-accent/10 text-accent border border-accent/40 hover:bg-accent/20 rounded-lg inline-flex items-center justify-center gap-2 transition-colors",title:"Ð’Ñ‹Ð±Ñ€Ð°Ñ‚ÑŒ Ð¸Ð· Ð¼ÐµÐ´Ð¸Ð°Ñ‚ÐµÐºÐ¸"}," ðŸ“ ",8,ue)]),l.icon_url?(r(),s("div",be,[e("img",{src:l.icon_url,alt:`Ð¡ÐµÐºÑ‚Ð¾Ñ€ ${l.sector_number}`,class:"w-16 h-16 object-contain rounded",onError:t[1]||(t[1]=(...n)=>o.handleImageError&&o.handleImageError(...n))},null,40,pe)])):c("",!0)])]))),128))])),o.showMediaModal?(r(),s("div",{key:3,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm",onClick:t[4]||(t[4]=V((...l)=>o.closeMediaModal&&o.closeMediaModal(...l),["self"]))},[e("div",{class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-6xl h-[90vh] flex flex-col",onClick:t[3]||(t[3]=V(()=>{},["stop"]))},[e("div",me,[t[13]||(t[13]=e("h3",{class:"text-lg font-semibold"},"Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¸ÐºÐ¾Ð½ÐºÑƒ",-1)),e("button",{onClick:t[2]||(t[2]=(...l)=>o.closeMediaModal&&o.closeMediaModal(...l)),class:"w-8 h-8 flex items-center justify-center rounded-lg hover:bg-muted transition-colors"}," âœ• ")]),e("div",fe,[A(m,{selectionMode:!0,countFile:1,selectedFiles:o.selectedMediaFile?[o.selectedMediaFile]:[],onFileSelected:o.handleMediaFileSelected},null,8,["selectedFiles","onFileSelected"])])])])):c("",!0)])}const he=U(R,[["render",ve]]);export{he as default};
