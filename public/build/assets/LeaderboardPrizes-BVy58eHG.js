import{_ as w,c as a,a as e,b as p,t as g,d as f,A as y,F as k,q as h,r as l,k as z,o as n,v,B as P}from"./admin-x7jx-BAr.js";import{a as V,c as x}from"./api-DccBIR6h.js";import{S as _}from"./sweetalert2.esm.all-C0u8rGqG.js";const M={name:"LeaderboardPrizes",setup(){const u=l(!1),o=l(!1),c=l(null),t=l([]),m=l(1),b=async()=>{u.value=!0,c.value=null;try{const s=await V("/wow/leaderboard-prizes");if(!s.ok)throw new Error("Ошибка загрузки призов");const i=await s.json();t.value=i.data||[],m.value=i.leaderboard_period_months||1}catch(s){c.value=s.message||"Ошибка загрузки призов"}finally{u.value=!1}},r=async()=>{o.value=!0;try{const s=await x("/wow/leaderboard-prizes/bulk-update",{prizes:t.value.map(d=>({id:d.id,prize_amount:d.prize_amount,prize_description:d.prize_description,is_active:d.is_active}))});if(!s.ok){const d=await s.json();throw new Error(d.message||"Ошибка сохранения призов")}const i=await x("/wow/leaderboard-prizes/update-period",{leaderboard_period_months:m.value});if(!i.ok){const d=await i.json();throw new Error(d.message||"Ошибка сохранения периода")}await _.fire({title:"Успешно!",text:"Настройки сохранены",icon:"success",confirmButtonText:"OK"}),b()}catch(s){await _.fire({title:"Ошибка",text:s.message||"Не удалось сохранить настройки",icon:"error",confirmButtonText:"OK"})}finally{o.value=!1}};return z(()=>{b()}),{loading:u,saving:o,error:c,prizes:t,leaderboardPeriodMonths:m,fetchPrizes:b,savePrizes:r}}},U={class:"leaderboard-prizes-page space-y-6"},B={class:"flex items-center justify-between"},j=["disabled"],D={key:0,class:"flex items-center justify-center py-12"},E={key:1,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},S={class:"text-destructive"},C={key:2,class:"bg-card rounded-lg border border-border p-6"},L={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},T={key:3,class:"space-y-4"},F={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},K={class:"flex items-center h-10 px-4 border border-border rounded-lg bg-muted/30"},N={class:"text-lg font-bold"},O=["onUpdate:modelValue"],R=["onUpdate:modelValue"],q={class:"mt-4 flex items-center"},A=["onUpdate:modelValue","id"],G=["for"];function H(u,o,c,t,m,b){return n(),a("div",U,[e("div",B,[o[2]||(o[2]=e("div",null,[e("h1",{class:"text-3xl font-semibold text-foreground"},"Призы лидерборда"),e("p",{class:"text-muted-foreground mt-1"},"Настройка призов за места в рейтинге")],-1)),e("button",{onClick:o[0]||(o[0]=(...r)=>t.savePrizes&&t.savePrizes(...r)),disabled:t.saving,class:"px-6 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors disabled:opacity-50"},g(t.saving?"Сохранение...":"Сохранить"),9,j)]),t.loading?(n(),a("div",D,[...o[3]||(o[3]=[e("p",{class:"text-muted-foreground"},"Загрузка призов...",-1)])])):p("",!0),t.error?(n(),a("div",E,[e("p",S,g(t.error),1)])):p("",!0),t.loading?p("",!0):(n(),a("div",C,[o[7]||(o[7]=e("h2",{class:"text-xl font-semibold mb-4"},"Настройки лидерборда",-1)),e("div",L,[e("div",null,[o[5]||(o[5]=e("label",{class:"text-sm font-medium mb-2 block"},"Период отображения",-1)),f(e("select",{"onUpdate:modelValue":o[1]||(o[1]=r=>t.leaderboardPeriodMonths=r),class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},[...o[4]||(o[4]=[e("option",{value:1},"1 месяц",-1),e("option",{value:2},"2 месяца",-1),e("option",{value:3},"3 месяца",-1),e("option",{value:4},"4 месяца",-1),e("option",{value:5},"5 месяцев",-1),e("option",{value:6},"6 месяцев",-1),e("option",{value:12},"12 месяцев",-1)])],512),[[y,t.leaderboardPeriodMonths,void 0,{number:!0}]]),o[6]||(o[6]=e("p",{class:"text-xs text-muted-foreground mt-2"}," Выберите период, за который будут учитываться рефералы в лидерборде ",-1))])])])),!t.loading&&t.prizes.length>0?(n(),a("div",T,[(n(!0),a(k,null,h(t.prizes,r=>(n(),a("div",{key:r.id,class:"bg-card rounded-lg border border-border p-6"},[e("div",F,[e("div",null,[o[9]||(o[9]=e("label",{class:"text-sm font-medium mb-2 block"},"Место",-1)),e("div",K,[e("span",N,g(r.rank),1),o[8]||(o[8]=e("span",{class:"ml-2 text-sm text-muted-foreground"},"место",-1))])]),e("div",null,[o[10]||(o[10]=e("label",{class:"text-sm font-medium mb-2 block"},"Сумма приза (₽)",-1)),f(e("input",{"onUpdate:modelValue":s=>r.prize_amount=s,type:"number",min:"0",step:"100",class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,8,O),[[v,r.prize_amount,void 0,{number:!0}]])]),e("div",null,[o[11]||(o[11]=e("label",{class:"text-sm font-medium mb-2 block"},"Описание",-1)),f(e("input",{"onUpdate:modelValue":s=>r.prize_description=s,type:"text",placeholder:"Например: Золото",class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,8,R),[[v,r.prize_description]])])]),e("div",q,[f(e("input",{"onUpdate:modelValue":s=>r.is_active=s,type:"checkbox",id:`prize-active-${r.id}`,class:"w-4 h-4 border-border rounded focus:ring-2 focus:ring-accent"},null,8,A),[[P,r.is_active]]),e("label",{for:`prize-active-${r.id}`,class:"ml-2 text-sm text-muted-foreground"}," Активен ",8,G)])]))),128))])):p("",!0)])}const W=w(M,[["render",H]]);export{W as default};
