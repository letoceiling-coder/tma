import{_ as w,c as d,a as e,b as l,t as f,d as g,A as y,e as k,F as h,q as z,r as u,k as P,o as a,v,B as V}from"./admin-DQKAhqL4.js";import{a as M,c as x}from"./api-DccBIR6h.js";import{S as _}from"./sweetalert2.esm.all-C0u8rGqG.js";const U={name:"LeaderboardPrizes",setup(){const c=u(!1),o=u(!1),b=u(null),r=u([]),m=u(1),p=async()=>{c.value=!0,b.value=null;try{const s=await M("/wow/leaderboard-prizes");if(!s.ok)throw new Error("Ошибка загрузки призов");const n=await s.json();r.value=n.data||[],m.value=n.leaderboard_period_months||1}catch(s){b.value=s.message||"Ошибка загрузки призов"}finally{c.value=!1}},t=async()=>{o.value=!0;try{if(r.value.length>0){const n=await x("/wow/leaderboard-prizes/bulk-update",{prizes:r.value.map(i=>({id:i.id,prize_amount:i.prize_amount,prize_description:i.prize_description,is_active:i.is_active}))});if(!n.ok){const i=await n.json();throw new Error(i.message||"Ошибка сохранения призов")}}const s=await x("/wow/leaderboard-prizes/update-period",{leaderboard_period_months:m.value});if(!s.ok){const n=await s.json();throw new Error(n.message||"Ошибка сохранения периода")}await _.fire({title:"Успешно!",text:"Настройки сохранены",icon:"success",confirmButtonText:"OK"}),p()}catch(s){await _.fire({title:"Ошибка",text:s.message||"Не удалось сохранить настройки",icon:"error",confirmButtonText:"OK"})}finally{o.value=!1}};return P(()=>{p()}),{loading:c,saving:o,error:b,prizes:r,leaderboardPeriodMonths:m,fetchPrizes:p,savePrizes:t}}},B={class:"leaderboard-prizes-page space-y-6"},j={class:"flex items-center justify-between"},S=["disabled"],D={key:0,class:"flex items-center justify-center py-12"},E={key:1,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},L={class:"text-destructive"},T={key:2,class:"bg-card rounded-lg border border-border p-6"},C={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},N={key:3,class:"bg-card rounded-lg border border-border p-12 text-center"},F={key:4,class:"space-y-4"},K={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},O={class:"flex items-center h-10 px-4 border border-border rounded-lg bg-muted/30"},R={class:"text-lg font-bold"},q=["onUpdate:modelValue"],A=["onUpdate:modelValue"],G={class:"mt-4 flex items-center"},H=["onUpdate:modelValue","id"],I=["for"];function J(c,o,b,r,m,p){return a(),d("div",B,[e("div",j,[o[2]||(o[2]=e("div",null,[e("h1",{class:"text-3xl font-semibold text-foreground"},"Призы лидерборда"),e("p",{class:"text-muted-foreground mt-1"},"Настройка призов за места в рейтинге")],-1)),e("button",{onClick:o[0]||(o[0]=(...t)=>r.savePrizes&&r.savePrizes(...t)),disabled:r.saving,class:"px-6 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors disabled:opacity-50"},f(r.saving?"Сохранение...":"Сохранить"),9,S)]),r.loading?(a(),d("div",D,[...o[3]||(o[3]=[e("p",{class:"text-muted-foreground"},"Загрузка призов...",-1)])])):l("",!0),r.error?(a(),d("div",E,[e("p",L,f(r.error),1)])):l("",!0),r.loading?l("",!0):(a(),d("div",T,[o[7]||(o[7]=e("h2",{class:"text-xl font-semibold mb-4"},"Настройки лидерборда",-1)),e("div",C,[e("div",null,[o[5]||(o[5]=e("label",{class:"text-sm font-medium mb-2 block"},"Период отображения",-1)),g(e("select",{"onUpdate:modelValue":o[1]||(o[1]=t=>r.leaderboardPeriodMonths=t),class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},[...o[4]||(o[4]=[e("option",{value:1},"1 месяц",-1),e("option",{value:2},"2 месяца",-1),e("option",{value:3},"3 месяца",-1),e("option",{value:4},"4 месяца",-1),e("option",{value:5},"5 месяцев",-1),e("option",{value:6},"6 месяцев",-1),e("option",{value:12},"12 месяцев",-1)])],512),[[y,r.leaderboardPeriodMonths,void 0,{number:!0}]]),o[6]||(o[6]=e("p",{class:"text-xs text-muted-foreground mt-2"}," Выберите период, за который будут учитываться рефералы в лидерборде ",-1))])])])),!r.loading&&r.prizes.length===0?(a(),d("div",N,[...o[8]||(o[8]=[e("p",{class:"text-muted-foreground mb-4"},"Призы за места не настроены",-1),e("p",{class:"text-sm text-muted-foreground"},[k(" Выполните команду: "),e("code",{class:"bg-muted px-2 py-1 rounded"},"php artisan db:seed --class=LeaderboardPrizeSeeder")],-1)])])):l("",!0),!r.loading&&r.prizes.length>0?(a(),d("div",F,[(a(!0),d(h,null,z(r.prizes,t=>(a(),d("div",{key:t.id,class:"bg-card rounded-lg border border-border p-6"},[e("div",K,[e("div",null,[o[10]||(o[10]=e("label",{class:"text-sm font-medium mb-2 block"},"Место",-1)),e("div",O,[e("span",R,f(t.rank),1),o[9]||(o[9]=e("span",{class:"ml-2 text-sm text-muted-foreground"},"место",-1))])]),e("div",null,[o[11]||(o[11]=e("label",{class:"text-sm font-medium mb-2 block"},"Сумма приза (₽)",-1)),g(e("input",{"onUpdate:modelValue":s=>t.prize_amount=s,type:"number",min:"0",step:"100",class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,8,q),[[v,t.prize_amount,void 0,{number:!0}]])]),e("div",null,[o[12]||(o[12]=e("label",{class:"text-sm font-medium mb-2 block"},"Описание",-1)),g(e("input",{"onUpdate:modelValue":s=>t.prize_description=s,type:"text",placeholder:"Например: Золото",class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,8,A),[[v,t.prize_description]])])]),e("div",G,[g(e("input",{"onUpdate:modelValue":s=>t.is_active=s,type:"checkbox",id:`prize-active-${t.id}`,class:"w-4 h-4 border-border rounded focus:ring-2 focus:ring-accent"},null,8,H),[[V,t.is_active]]),e("label",{for:`prize-active-${t.id}`,class:"ml-2 text-sm text-muted-foreground"}," Активен ",8,I)])]))),128))])):l("",!0)])}const Y=w(U,[["render",J]]);export{Y as default};
