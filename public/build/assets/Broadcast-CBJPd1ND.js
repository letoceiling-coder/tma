import{_ as k,r as o,k as j,c as d,a as e,b as m,t as u,d as x,D as C,v as y,e as _,C as V,j as w,o as i}from"./admin-ClPi5g1x.js";const M={class:"broadcast-page space-y-6"},T={key:0,class:"flex items-center justify-center py-12"},B={key:1,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},S={class:"text-destructive"},U={key:2,class:"p-4 bg-green-500/10 border border-green-500/20 rounded-lg"},D={class:"text-green-600"},N={key:3,class:"space-y-6"},E={class:"bg-card rounded-lg border border-border p-6"},I={class:"flex items-center justify-between"},z={class:"relative inline-flex items-center cursor-pointer"},H={class:"bg-card rounded-lg border border-border p-6 space-y-4"},q={class:"text-xs text-muted-foreground mt-1"},A={class:"bg-muted px-1 rounded"},F={class:"bg-muted px-1 rounded"},G={class:"bg-card rounded-lg border border-border p-6"},J={class:"flex items-center justify-between"},K={class:"flex items-center gap-3"},L={class:"bg-card rounded-lg border border-border p-6"},O={class:"flex items-center justify-between"},P={class:"flex items-center gap-3"},Q={class:"flex justify-end"},R=["disabled"],W={__name:"Broadcast",setup(X){const c=o(!0),b=o(!1),a=o(null),l=o(null),f=o(!1),g=o(""),v=o(24),p=o("after_registration"),h=async()=>{c.value=!0,a.value=null,l.value=null;try{const s=await w.get("/api/v1/wow/wheel/settings");if(s.data.settings){const t=s.data.settings;f.value=t.broadcast_enabled??!1,g.value=t.broadcast_message_text??"",v.value=t.broadcast_interval_hours??24,p.value=t.broadcast_trigger??"after_registration"}}catch(s){a.value=s.response?.data?.message||"Ошибка загрузки настроек"}finally{c.value=!1}},n=async()=>{b.value=!0,a.value=null,l.value=null;try{(await w.put("/api/v1/wow/wheel/settings",{broadcast_enabled:f.value,broadcast_message_text:g.value,broadcast_interval_hours:v.value,broadcast_trigger:p.value})).data.success&&(l.value="Настройки успешно сохранены",setTimeout(()=>{l.value=null},3e3))}catch(s){a.value=s.response?.data?.message||"Ошибка сохранения настроек"}finally{b.value=!1}};return j(()=>{h()}),(s,t)=>(i(),d("div",M,[t[16]||(t[16]=e("div",{class:"flex items-center justify-between"},[e("div",null,[e("h1",{class:"text-3xl font-semibold text-foreground"},"Рассылки"),e("p",{class:"text-muted-foreground mt-1"},"Управление автоматическими рассылками от Telegram-бота")])],-1)),c.value?(i(),d("div",T,[...t[4]||(t[4]=[e("div",{class:"text-muted-foreground"},"Загрузка...",-1)])])):m("",!0),a.value?(i(),d("div",B,[e("p",S,u(a.value),1)])):m("",!0),l.value?(i(),d("div",U,[e("p",D,u(l.value),1)])):m("",!0),c.value?m("",!0):(i(),d("div",N,[e("div",E,[e("div",I,[t[6]||(t[6]=e("div",null,[e("h3",{class:"text-base font-medium mb-1"},"Включить рассылки"),e("p",{class:"text-sm text-muted-foreground"}," Включает или выключает систему автоматических рассылок ")],-1)),e("label",z,[x(e("input",{"onUpdate:modelValue":t[0]||(t[0]=r=>f.value=r),onChange:n,type:"checkbox",class:"sr-only peer"},null,544),[[C,f.value]]),t[5]||(t[5]=e("div",{class:"w-11 h-6 bg-muted peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-accent/20 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-border after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-accent"},null,-1))])])]),e("div",H,[e("div",null,[t[11]||(t[11]=e("label",{class:"text-sm font-medium mb-2 block"},"Текст рассылки",-1)),x(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=r=>g.value=r),onChange:n,rows:"6",placeholder:"Привет! У тебя есть новые возможности. Проверь приложение!",class:"w-full px-4 py-3 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent resize-none"},null,544),[[y,g.value]]),e("p",q,[t[7]||(t[7]=_(" Текст, который будет отправляться пользователям от имени бота. Поддерживается простой текст и emoji. ",-1)),t[8]||(t[8]=e("br",null,null,-1)),t[9]||(t[9]=_(" Доступные переменные: ",-1)),e("code",A,u(s.username),1),t[10]||(t[10]=_(", ",-1)),e("code",F,u(s.tickets_count),1)])])]),e("div",G,[e("div",J,[t[13]||(t[13]=e("div",{class:"flex-1"},[e("h3",{class:"text-base font-medium mb-1"},"Периодичность рассылки (в часах)"),e("p",{class:"text-sm text-muted-foreground"}," Интервал между отправками сообщений с момента регистрации или последнего события. Указывается в часах ")],-1)),e("div",K,[x(e("input",{"onUpdate:modelValue":t[2]||(t[2]=r=>v.value=r),onChange:n,type:"number",min:"1",max:"24",step:"1",class:"w-24 h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent text-center"},null,544),[[y,v.value,void 0,{number:!0}]]),t[12]||(t[12]=e("span",{class:"text-sm text-muted-foreground"},"часов",-1))])])]),e("div",L,[e("div",O,[t[15]||(t[15]=e("div",{class:"flex-1"},[e("h3",{class:"text-base font-medium mb-1"},"Триггер рассылки"),e("p",{class:"text-sm text-muted-foreground"}," Событие, после которого будет начинаться отсчёт до рассылки ")],-1)),e("div",P,[x(e("select",{"onUpdate:modelValue":t[3]||(t[3]=r=>p.value=r),onChange:n,class:"w-64 h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},[...t[14]||(t[14]=[e("option",{value:"after_registration"},"После регистрации",-1),e("option",{value:"after_last_spin"},"После последнего прокрута",-1)])],544),[[V,p.value]])])])]),e("div",Q,[e("button",{onClick:n,disabled:b.value,class:"h-11 px-6 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-2xl shadow-lg shadow-accent/10 inline-flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"},[e("span",null,u(b.value?"Сохранение...":"Сохранить настройки"),1)],8,R)])]))]))}},Z=k(W,[["__scopeId","data-v-0bff0768"]]);export{Z as default};
