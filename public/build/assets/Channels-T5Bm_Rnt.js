import{_ as B,c as n,a as e,b as x,t as d,F as M,q as j,w as E,d as g,v as y,B as D,r as u,k as U,o as l,p as V}from"./admin-DcB0oK0V.js";import{a as T,b as S,c as q,d as z}from"./api-DccBIR6h.js";import{S as b}from"./sweetalert2.esm.all-C0u8rGqG.js";const F={name:"Channels",setup(){const p=u(!1),t=u(!1),a=u(null),o=u([]),v=u(!1),c=u(!1),s=u({id:null,username:"",title:"",priority:0,is_active:!0}),f=async()=>{p.value=!0,a.value=null;try{const r=await T("/wow/channels");if(!r.ok)throw new Error("Ошибка загрузки каналов");const i=await r.json();o.value=i.data||[]}catch(r){a.value=r.message||"Ошибка загрузки каналов"}finally{p.value=!1}},w=r=>{s.value={id:r.id,username:r.username,title:r.title,priority:r.priority,is_active:r.is_active},c.value=!0},_=async r=>{if((await b.fire({title:"Удалить канал?",html:`Вы уверены, что хотите удалить канал <strong>"@${r.username}"</strong>?`,icon:"warning",showCancelButton:!0,confirmButtonText:"Да, удалить",cancelButtonText:"Отмена",confirmButtonColor:"#dc2626",cancelButtonColor:"#6b7280"})).isConfirmed)try{const m=await z(`/wow/channels/${r.id}`);if(!m.ok){const C=await m.json();throw new Error(C.message||"Ошибка удаления канала")}await b.fire({title:"Канал удален",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),await f()}catch(m){b.fire({title:"Ошибка",text:m.message||"Ошибка удаления канала",icon:"error",confirmButtonText:"ОК"})}},k=async()=>{t.value=!0,a.value=null;try{const r={username:s.value.username.replace("@",""),title:s.value.title,priority:s.value.priority||0,is_active:s.value.is_active};let i;if(c.value?i=await S(`/wow/channels/${s.value.id}`,r):i=await q("/wow/channels",r),!i.ok){const m=await i.json();throw new Error(m.message||"Ошибка сохранения канала")}await b.fire({title:c.value?"Канал обновлен":"Канал создан",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),h(),await f()}catch(r){a.value=r.message||"Ошибка сохранения канала",b.fire({title:"Ошибка",text:r.message||"Ошибка сохранения канала",icon:"error",confirmButtonText:"ОК"})}finally{t.value=!1}},h=()=>{v.value=!1,c.value=!1,s.value={id:null,username:"",title:"",priority:0,is_active:!0},a.value=null};return U(()=>{f()}),{loading:p,saving:t,error:a,channels:o,showCreateModal:v,showEditModal:c,form:s,editChannel:w,deleteChannel:_,saveChannel:k,closeModal:h}}},N={class:"channels-page space-y-6"},P={class:"flex items-center justify-between"},G={key:0,class:"flex items-center justify-center py-12"},L={key:1,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},A={class:"text-destructive"},H={key:2,class:"bg-card rounded-lg border border-border overflow-hidden"},I={class:"overflow-x-auto"},J={class:"w-full"},K={class:"divide-y divide-border"},O={class:"px-6 py-4 text-sm font-medium text-foreground"},Q={class:"px-6 py-4 text-sm text-foreground"},R={class:"px-6 py-4 text-sm text-foreground"},W={class:"px-6 py-4 text-sm"},X={class:"px-6 py-4 text-sm text-right"},Y={class:"flex items-center justify-end gap-2"},Z=["onClick"],$=["onClick"],ee={key:3,class:"bg-card rounded-lg border border-border p-12 text-center"},te={key:4,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm"},oe={class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-md p-6"},se={class:"text-lg font-semibold mb-4"},re={class:"flex items-center gap-2 cursor-pointer"},ne={class:"flex gap-2 pt-4"},le=["disabled"];function ae(p,t,a,o,v,c){return l(),n("div",N,[e("div",P,[t[8]||(t[8]=e("div",null,[e("h1",{class:"text-3xl font-semibold text-foreground"},"Каналы"),e("p",{class:"text-muted-foreground mt-1"},"Управление обязательными каналами для подписки")],-1)),e("button",{onClick:t[0]||(t[0]=s=>o.showCreateModal=!0),class:"h-11 px-6 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-2xl shadow-lg shadow-accent/10 inline-flex items-center justify-center gap-2"},[...t[7]||(t[7]=[e("span",null,"+",-1),e("span",null,"Добавить канал",-1)])])]),o.loading?(l(),n("div",G,[...t[9]||(t[9]=[e("p",{class:"text-muted-foreground"},"Загрузка каналов...",-1)])])):x("",!0),o.error?(l(),n("div",L,[e("p",A,d(o.error),1)])):x("",!0),!o.loading&&o.channels.length>0?(l(),n("div",H,[e("div",I,[e("table",J,[t[10]||(t[10]=e("thead",{class:"bg-muted/30 border-b border-border"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase"},"Username"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase"},"Название"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase"},"Приоритет"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase"},"Статус"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-muted-foreground uppercase"},"Действия")])],-1)),e("tbody",K,[(l(!0),n(M,null,j(o.channels,s=>(l(),n("tr",{key:s.id,class:"hover:bg-muted/10"},[e("td",O,"@"+d(s.username),1),e("td",Q,d(s.title),1),e("td",R,d(s.priority),1),e("td",W,[e("span",{class:V(["px-2 py-1 text-xs rounded-md",s.is_active?"bg-green-500/10 text-green-600":"bg-gray-500/10 text-gray-600"])},d(s.is_active?"Активен":"Неактивен"),3)]),e("td",X,[e("div",Y,[e("button",{onClick:f=>o.editChannel(s),class:"px-3 py-1 text-xs bg-blue-500 hover:bg-blue-600 text-white rounded transition-colors"}," Редактировать ",8,Z),e("button",{onClick:f=>o.deleteChannel(s),class:"px-3 py-1 text-xs bg-red-500 hover:bg-red-600 text-white rounded transition-colors"}," Удалить ",8,$)])])]))),128))])])])])):x("",!0),!o.loading&&o.channels.length===0?(l(),n("div",ee,[...t[11]||(t[11]=[e("p",{class:"text-muted-foreground"},"Каналы не найдены. Добавьте первый канал.",-1)])])):x("",!0),o.showCreateModal||o.showEditModal?(l(),n("div",te,[e("div",oe,[e("h3",se,d(o.showEditModal?"Редактировать канал":"Добавить канал"),1),e("form",{onSubmit:t[6]||(t[6]=E((...s)=>o.saveChannel&&o.saveChannel(...s),["prevent"])),class:"space-y-4"},[e("div",null,[t[12]||(t[12]=e("label",{class:"text-sm font-medium mb-1 block"},"Username (без @)",-1)),g(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>o.form.username=s),type:"text",placeholder:"channel_username",required:"",class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,512),[[y,o.form.username]])]),e("div",null,[t[13]||(t[13]=e("label",{class:"text-sm font-medium mb-1 block"},"Название канала",-1)),g(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>o.form.title=s),type:"text",placeholder:"Название канала",required:"",class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,512),[[y,o.form.title]])]),e("div",null,[t[14]||(t[14]=e("label",{class:"text-sm font-medium mb-1 block"},"Приоритет",-1)),g(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>o.form.priority=s),type:"number",min:"0",placeholder:"0",class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,512),[[y,o.form.priority,void 0,{number:!0}]]),t[15]||(t[15]=e("p",{class:"text-xs text-muted-foreground mt-1"},"Чем выше приоритет, тем выше канал в списке",-1))]),e("div",null,[e("label",re,[g(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>o.form.is_active=s),type:"checkbox",class:"w-4 h-4"},null,512),[[D,o.form.is_active]]),t[16]||(t[16]=e("span",{class:"text-sm"},"Активен",-1))])]),e("div",ne,[e("button",{type:"button",onClick:t[5]||(t[5]=(...s)=>o.closeModal&&o.closeModal(...s)),class:"flex-1 h-10 px-4 border border-border bg-background/50 hover:bg-accent/10 rounded-lg transition-colors"}," Отмена "),e("button",{type:"submit",disabled:o.saving,class:"flex-1 h-10 px-4 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-lg transition-colors disabled:opacity-50"},d(o.saving?"Сохранение...":"Сохранить"),9,le)])],32)])])):x("",!0)])}const ce=B(F,[["render",ae]]);export{ce as default};
