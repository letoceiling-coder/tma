import{_ as q,c as l,a as e,b as c,d as g,v as _,C as G,t as d,F as M,q as A,r as a,k as H,o as n,p as z}from"./admin-BXYcFqZw.js";import{a as S,c as P}from"./api-DccBIR6h.js";import{S as y}from"./sweetalert2.esm.all-C0u8rGqG.js";const J={name:"WowUsers",setup(){const k=a(!1),t=a(null),T=a([]),s=a(null),U=a(15),f=a({current_page:1,last_page:1,total:0,from:0,to:0}),o=a({search:"",date_from:"",date_to:""});let m=null;const x=async(r=1)=>{k.value=!0,t.value=null;try{const i={page:r,per_page:U.value};o.value.search&&(i.search=o.value.search),o.value.date_from&&(i.date_from=o.value.date_from),o.value.date_to&&(i.date_to=o.value.date_to);const u=await S("/wow/users",i);if(!u.ok)throw new Error("Ошибка загрузки пользователей");const b=await u.json();T.value=b.data||[],f.value={current_page:b.current_page||1,last_page:b.last_page||1,total:b.total||0,from:b.from||0,to:b.to||0}}catch(i){t.value=i.message||"Ошибка загрузки пользователей"}finally{k.value=!1}},B=()=>{m&&clearTimeout(m),m=setTimeout(()=>{x(1)},500)},V=r=>{x(r)},I=async r=>{try{const i=await S(`/wow/users/${r.id}`);if(!i.ok)throw new Error("Ошибка загрузки данных пользователя");const u=await i.json();s.value={...u.data,win_history:u.win_history||[]}}catch(i){console.error("Error loading user details:",i)}},E=r=>({money:"Деньги",ticket:"Билет",secret_box:"Секретный бокс",gift:"Подарок",sponsor_gift:"Подарок от спонсора",empty:"Пусто"})[r]||r,L=r=>({pending:"В ожидании",processing:"В обработке",shipped:"Отправлено",delivered:"Доставлено",cancelled:"Отменено"})[r]||r||"—",O=r=>r?new Date(r).toLocaleString("ru-RU"):"—",C=a(!1),h=a(null),w=a(1),R=a(!1),K=r=>{h.value=r,w.value=1,C.value=!0},W=async()=>{if(!(!h.value||w.value<1)){R.value=!0;try{const r=await P(`/wow/users/${h.value.id}/add-tickets`,{tickets:w.value});if(!r.ok){const u=await r.json();throw new Error(u.message||"Ошибка начисления билетов")}const i=await r.json();await y.fire({title:"Успешно!",text:i.message||"Билеты начислены",icon:"success",confirmButtonText:"OK"}),C.value=!1,x(f.value.current)}catch(r){await y.fire({title:"Ошибка",text:r.message||"Не удалось начислить билеты",icon:"error",confirmButtonText:"OK"})}finally{R.value=!1}}},j=a(!1),p=a(null),v=a(1),D=a(!1),F=r=>{p.value=r,v.value=1,j.value=!0},N=async()=>{if(!(!p.value||v.value<1)){if(v.value>(p.value.tickets_available||0)){await y.fire({title:"Ошибка",text:"Нельзя списать больше билетов, чем есть у пользователя",icon:"error",confirmButtonText:"OK"});return}D.value=!0;try{const r=await P(`/wow/users/${p.value.id}/remove-tickets`,{tickets:v.value});if(!r.ok){const u=await r.json();throw new Error(u.message||"Ошибка списания билетов")}const i=await r.json();await y.fire({title:"Успешно!",text:i.message||"Билеты списаны",icon:"success",confirmButtonText:"OK"}),j.value=!1,x(f.value.current)}catch(r){await y.fire({title:"Ошибка",text:r.message||"Не удалось списать билеты",icon:"error",confirmButtonText:"OK"})}finally{D.value=!1}}};return H(()=>{x()}),{loading:k,error:t,users:T,selectedUser:s,pagination:f,perPage:U,filters:o,fetchUsers:x,handleSearch:B,changePage:V,viewUser:I,showAddTicketsModal:C,addTicketsUser:h,ticketsToAdd:w,isAddingTickets:R,openAddTicketsModal:K,addTickets:W,showRemoveTicketsModal:j,removeTicketsUser:p,ticketsToRemove:v,isRemovingTickets:D,openRemoveTicketsModal:F,removeTickets:N,getPrizeTypeLabel:E,getDeliveryStatusLabel:L,formatDate:O}}},Q={class:"wow-users-page space-y-6"},X={class:"bg-card rounded-lg border border-border p-4 space-y-4"},Y={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},Z={key:0,class:"flex items-center justify-center py-12"},$={key:1,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},ee={class:"text-destructive"},te={key:2,class:"bg-card rounded-lg border border-border overflow-hidden"},se={class:"overflow-x-auto"},oe={class:"w-full"},re={class:"divide-y divide-border"},de={class:"px-6 py-4 text-sm text-foreground"},le={class:"px-6 py-4 text-sm text-foreground"},ne={class:"px-6 py-4 text-sm font-medium text-foreground"},ie={class:"px-6 py-4 text-sm text-foreground"},ae={class:"px-2 py-1 bg-blue-500/10 text-blue-600 rounded"},ce={class:"px-6 py-4 text-sm text-foreground"},ue={class:"px-6 py-4 text-sm text-foreground"},me={class:"px-6 py-4 text-sm text-foreground"},xe={class:"px-6 py-4 text-sm text-right"},be=["onClick"],ge=["onClick"],fe=["onClick"],pe={key:0,class:"px-6 py-4 border-t border-border flex items-center justify-between"},ve={class:"text-sm text-muted-foreground"},_e={class:"flex gap-2"},ye=["disabled"],ke=["disabled"],he={key:3,class:"bg-card rounded-lg border border-border p-12 text-center"},we={key:4,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4"},Te={class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-md"},Ue={class:"p-6 border-b border-border"},Ce={class:"flex items-center justify-between"},Re={class:"p-6 space-y-4"},je={key:0},De={class:"text-sm font-medium"},Me={class:"text-sm text-muted-foreground mt-1"},Ae={class:"flex items-center gap-3 pt-4"},ze=["disabled"],Se=["disabled"],Pe={key:5,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4"},Be={class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-md"},Ve={class:"p-6 border-b border-border"},Ie={class:"flex items-center justify-between"},Ee={class:"p-6 space-y-4"},Le={key:0},Oe={class:"text-sm font-medium"},Ke={class:"text-sm text-muted-foreground mt-1"},We=["max"],Fe={class:"text-xs text-muted-foreground mt-1"},Ne={class:"flex items-center gap-3 pt-4"},qe=["disabled"],Ge=["disabled"],He={key:6,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4"},Je={class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto"},Qe={class:"p-6 border-b border-border"},Xe={class:"flex items-center justify-between"},Ye={class:"text-lg font-semibold"},Ze={class:"p-6 space-y-6"},$e={class:"grid grid-cols-2 gap-4"},et={class:"text-sm font-medium"},tt={class:"text-sm font-medium"},st={class:"text-sm font-medium"},ot={class:"text-sm font-medium"},rt={class:"text-sm font-medium"},dt={class:"text-sm font-medium"},lt={key:0},nt={class:"overflow-x-auto"},it={class:"w-full text-sm"},at={class:"divide-y divide-border"},ct={class:"px-4 py-2"},ut={class:"px-4 py-2"},mt={class:"px-4 py-2"},xt={class:"px-4 py-2"},bt={class:"px-4 py-2"},gt={key:1,class:"text-muted-foreground"},ft={key:1,class:"text-center py-8 text-muted-foreground"};function pt(k,t,T,s,U,f){return n(),l("div",Q,[t[42]||(t[42]=e("div",{class:"flex items-center justify-between"},[e("div",null,[e("h1",{class:"text-3xl font-semibold text-foreground"},"Пользователи WOW"),e("p",{class:"text-muted-foreground mt-1"},"Управление пользователями рулетки")])],-1)),e("div",X,[e("div",Y,[e("div",null,[t[19]||(t[19]=e("label",{class:"text-sm font-medium mb-1 block"},"Поиск",-1)),g(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>s.filters.search=o),type:"text",placeholder:"Username, Telegram ID...",onInput:t[1]||(t[1]=(...o)=>s.handleSearch&&s.handleSearch(...o)),class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,544),[[_,s.filters.search]])]),e("div",null,[t[20]||(t[20]=e("label",{class:"text-sm font-medium mb-1 block"},"Дата от",-1)),g(e("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>s.filters.date_from=o),type:"date",onChange:t[3]||(t[3]=(...o)=>s.fetchUsers&&s.fetchUsers(...o)),class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,544),[[_,s.filters.date_from]])]),e("div",null,[t[21]||(t[21]=e("label",{class:"text-sm font-medium mb-1 block"},"Дата до",-1)),g(e("input",{"onUpdate:modelValue":t[4]||(t[4]=o=>s.filters.date_to=o),type:"date",onChange:t[5]||(t[5]=(...o)=>s.fetchUsers&&s.fetchUsers(...o)),class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,544),[[_,s.filters.date_to]])]),e("div",null,[t[23]||(t[23]=e("label",{class:"text-sm font-medium mb-1 block"},"На странице",-1)),g(e("select",{"onUpdate:modelValue":t[6]||(t[6]=o=>s.perPage=o),onChange:t[7]||(t[7]=(...o)=>s.fetchUsers&&s.fetchUsers(...o)),class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},[...t[22]||(t[22]=[e("option",{value:15},"15",-1),e("option",{value:25},"25",-1),e("option",{value:50},"50",-1),e("option",{value:100},"100",-1)])],544),[[G,s.perPage]])])])]),s.loading?(n(),l("div",Z,[...t[24]||(t[24]=[e("p",{class:"text-muted-foreground"},"Загрузка пользователей...",-1)])])):c("",!0),s.error?(n(),l("div",$,[e("p",ee,d(s.error),1)])):c("",!0),!s.loading&&s.users.length>0?(n(),l("div",te,[e("div",se,[e("table",oe,[t[25]||(t[25]=e("thead",{class:"bg-muted/30 border-b border-border"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase"},"ID"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase"},"Telegram ID"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase"},"Username"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase"},"Билеты"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase"},"Прокруты"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase"},"Выигрыши"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase"},"Приглашения"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-muted-foreground uppercase"},"Действия")])],-1)),e("tbody",re,[(n(!0),l(M,null,A(s.users,o=>(n(),l("tr",{key:o.id,class:"hover:bg-muted/10"},[e("td",de,d(o.id),1),e("td",le,d(o.telegram_id),1),e("td",ne,d(o.username||"—"),1),e("td",ie,[e("span",ae,d(o.tickets_available||0)+"/3 ",1)]),e("td",ce,d(o.spins_count||0),1),e("td",ue,d(o.total_wins||0),1),e("td",me,d(o.invites_count||0),1),e("td",xe,[e("button",{onClick:m=>s.openAddTicketsModal(o),class:"mr-2 px-3 py-1 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors",title:"Начислить билеты"}," + ",8,be),e("button",{onClick:m=>s.openRemoveTicketsModal(o),class:"mr-2 px-3 py-1 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors",title:"Списать билеты"}," − ",8,ge),e("button",{onClick:m=>s.viewUser(o),class:"px-3 py-1 text-xs bg-blue-500 hover:bg-blue-600 text-white rounded transition-colors"}," Подробнее ",8,fe)])]))),128))])])]),s.pagination.last_page>1?(n(),l("div",pe,[e("div",ve," Показано "+d(s.pagination.from)+" - "+d(s.pagination.to)+" из "+d(s.pagination.total),1),e("div",_e,[e("button",{onClick:t[8]||(t[8]=o=>s.changePage(s.pagination.current_page-1)),disabled:s.pagination.current_page===1,class:"px-4 py-2 text-sm border border-border rounded-lg hover:bg-muted/10 disabled:opacity-50 disabled:cursor-not-allowed"}," Назад ",8,ye),e("button",{onClick:t[9]||(t[9]=o=>s.changePage(s.pagination.current_page+1)),disabled:s.pagination.current_page===s.pagination.last_page,class:"px-4 py-2 text-sm border border-border rounded-lg hover:bg-muted/10 disabled:opacity-50 disabled:cursor-not-allowed"}," Вперед ",8,ke)])])):c("",!0)])):c("",!0),!s.loading&&s.users.length===0?(n(),l("div",he,[...t[26]||(t[26]=[e("p",{class:"text-muted-foreground"},"Пользователи не найдены",-1)])])):c("",!0),s.showAddTicketsModal?(n(),l("div",we,[e("div",Te,[e("div",Ue,[e("div",Ce,[t[27]||(t[27]=e("h3",{class:"text-lg font-semibold"},"Начислить билеты",-1)),e("button",{onClick:t[10]||(t[10]=o=>s.showAddTicketsModal=!1),class:"text-muted-foreground hover:text-foreground"}," ✕ ")])]),e("div",Re,[s.addTicketsUser?(n(),l("div",je,[t[28]||(t[28]=e("p",{class:"text-sm text-muted-foreground mb-2"},"Пользователь:",-1)),e("p",De,d(s.addTicketsUser.username||`Telegram ID: ${s.addTicketsUser.telegram_id}`),1),e("p",Me,"Текущее количество билетов: "+d(s.addTicketsUser.tickets_available||0),1)])):c("",!0),e("div",null,[t[29]||(t[29]=e("label",{class:"text-sm font-medium mb-1 block"},"Количество билетов",-1)),g(e("input",{"onUpdate:modelValue":t[11]||(t[11]=o=>s.ticketsToAdd=o),type:"number",min:"1",max:"100",class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,512),[[_,s.ticketsToAdd,void 0,{number:!0}]])]),e("div",Ae,[e("button",{onClick:t[12]||(t[12]=(...o)=>s.addTickets&&s.addTickets(...o)),disabled:s.isAddingTickets||s.ticketsToAdd<1,class:"flex-1 px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},d(s.isAddingTickets?"Начисление...":"Начислить"),9,ze),e("button",{onClick:t[13]||(t[13]=o=>s.showAddTicketsModal=!1),disabled:s.isAddingTickets,class:"flex-1 px-4 py-2 border border-border rounded-lg hover:bg-muted/10 transition-colors disabled:opacity-50"}," Отмена ",8,Se)])])])])):c("",!0),s.showRemoveTicketsModal?(n(),l("div",Pe,[e("div",Be,[e("div",Ve,[e("div",Ie,[t[30]||(t[30]=e("h3",{class:"text-lg font-semibold"},"Списать билеты",-1)),e("button",{onClick:t[14]||(t[14]=o=>s.showRemoveTicketsModal=!1),class:"text-muted-foreground hover:text-foreground"}," ✕ ")])]),e("div",Ee,[s.removeTicketsUser?(n(),l("div",Le,[t[31]||(t[31]=e("p",{class:"text-sm text-muted-foreground mb-2"},"Пользователь:",-1)),e("p",Oe,d(s.removeTicketsUser.username||`Telegram ID: ${s.removeTicketsUser.telegram_id}`),1),e("p",Ke,"Текущее количество билетов: "+d(s.removeTicketsUser.tickets_available||0),1)])):c("",!0),e("div",null,[t[32]||(t[32]=e("label",{class:"text-sm font-medium mb-1 block"},"Количество билетов для списания",-1)),g(e("input",{"onUpdate:modelValue":t[15]||(t[15]=o=>s.ticketsToRemove=o),type:"number",min:"1",max:s.removeTicketsUser?.tickets_available||0,class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,8,We),[[_,s.ticketsToRemove,void 0,{number:!0}]]),e("p",Fe," Можно списать не более "+d(s.removeTicketsUser?.tickets_available||0)+" билет(ов) ",1)]),e("div",Ne,[e("button",{onClick:t[16]||(t[16]=(...o)=>s.removeTickets&&s.removeTickets(...o)),disabled:s.isRemovingTickets||s.ticketsToRemove<1||s.ticketsToRemove>(s.removeTicketsUser?.tickets_available||0),class:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},d(s.isRemovingTickets?"Списание...":"Списать"),9,qe),e("button",{onClick:t[17]||(t[17]=o=>s.showRemoveTicketsModal=!1),disabled:s.isRemovingTickets,class:"flex-1 px-4 py-2 border border-border rounded-lg hover:bg-muted/10 transition-colors disabled:opacity-50"}," Отмена ",8,Ge)])])])])):c("",!0),s.selectedUser?(n(),l("div",He,[e("div",Je,[e("div",Qe,[e("div",Xe,[e("h3",Ye,"Пользователь #"+d(s.selectedUser.id),1),e("button",{onClick:t[18]||(t[18]=o=>s.selectedUser=null),class:"text-muted-foreground hover:text-foreground"}," ✕ ")])]),e("div",Ze,[e("div",$e,[e("div",null,[t[33]||(t[33]=e("p",{class:"text-sm text-muted-foreground"},"Telegram ID",-1)),e("p",et,d(s.selectedUser.telegram_id),1)]),e("div",null,[t[34]||(t[34]=e("p",{class:"text-sm text-muted-foreground"},"Username",-1)),e("p",tt,d(s.selectedUser.username||"—"),1)]),e("div",null,[t[35]||(t[35]=e("p",{class:"text-sm text-muted-foreground"},"Билеты",-1)),e("p",st,d(s.selectedUser.tickets_available||0)+"/3",1)]),e("div",null,[t[36]||(t[36]=e("p",{class:"text-sm text-muted-foreground"},"Звёзды",-1)),e("p",ot,d(s.selectedUser.stars_balance||0),1)]),e("div",null,[t[37]||(t[37]=e("p",{class:"text-sm text-muted-foreground"},"Всего прокрутов",-1)),e("p",rt,d(s.selectedUser.spins_count||0),1)]),e("div",null,[t[38]||(t[38]=e("p",{class:"text-sm text-muted-foreground"},"Выигрышей",-1)),e("p",dt,d(s.selectedUser.total_wins||0),1)])]),s.selectedUser.win_history&&s.selectedUser.win_history.length>0?(n(),l("div",lt,[t[40]||(t[40]=e("h4",{class:"text-base font-semibold mb-4"},"История выигрышей",-1)),e("div",nt,[e("table",it,[t[39]||(t[39]=e("thead",{class:"bg-muted/50"},[e("tr",null,[e("th",{class:"px-4 py-2 text-left text-xs font-medium text-muted-foreground uppercase"},"Время"),e("th",{class:"px-4 py-2 text-left text-xs font-medium text-muted-foreground uppercase"},"Тип приза"),e("th",{class:"px-4 py-2 text-left text-xs font-medium text-muted-foreground uppercase"},"Название приза"),e("th",{class:"px-4 py-2 text-left text-xs font-medium text-muted-foreground uppercase"},"Сектор"),e("th",{class:"px-4 py-2 text-left text-xs font-medium text-muted-foreground uppercase"},"Статус")])],-1)),e("tbody",at,[(n(!0),l(M,null,A(s.selectedUser.win_history,o=>(n(),l("tr",{key:o.id,class:"hover:bg-muted/10"},[e("td",ct,d(s.formatDate(o.spin_time)),1),e("td",ut,[e("span",{class:z(["px-2 py-1 rounded text-xs font-medium",{"bg-green-500/10 text-green-600":o.prize_type==="money","bg-blue-500/10 text-blue-600":o.prize_type==="ticket","bg-purple-500/10 text-purple-600":o.prize_type==="secret_box","bg-yellow-500/10 text-yellow-600":o.prize_type==="gift","bg-orange-500/10 text-orange-600":o.prize_type==="sponsor_gift"}])},d(s.getPrizeTypeLabel(o.prize_type)),3)]),e("td",mt,d(o.prize_name||"—"),1),e("td",xt,d(o.sector_number?"#"+o.sector_number:"—"),1),e("td",bt,[o.delivery_status?(n(),l("span",{key:0,class:z(["px-2 py-1 rounded text-xs",{"bg-yellow-500/10 text-yellow-600":o.delivery_status==="pending","bg-blue-500/10 text-blue-600":o.delivery_status==="processing","bg-purple-500/10 text-purple-600":o.delivery_status==="shipped","bg-green-500/10 text-green-600":o.delivery_status==="delivered","bg-red-500/10 text-red-600":o.delivery_status==="cancelled"}])},d(s.getDeliveryStatusLabel(o.delivery_status)),3)):(n(),l("span",gt,"—"))])]))),128))])])])])):(n(),l("div",ft,[...t[41]||(t[41]=[e("p",null,"История выигрышей пуста",-1)])]))])])])):c("",!0)])}const kt=q(J,[["render",pt]]);export{kt as default};
