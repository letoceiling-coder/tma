import{_ as R,c as a,a as e,b as u,p as H,e as j,t as k,d as m,B as C,v as g,F as I,q as P,w as F,f as L,r as i,m as z,k as W,h as q,o as d,A as G,C as J}from"./admin-DvEgJ2ml.js";import{a as K,c as E}from"./api-DccBIR6h.js";import{S as v}from"./sweetalert2.esm.all-C0u8rGqG.js";import O from"./Media-DuLip5QO.js";const Q={name:"Wheel",components:{Media:O},setup(){const x=i(!1),t=i(!1),y=i(!1),o=i(null),b=i([]),w=i(!1),f=i(3),s=i(""),n=i(!1),p=i(null),_=i(null),S=z(()=>b.value.reduce((l,r)=>l+(parseFloat(r.probability_percent)||0),0)),V=z(()=>Math.abs(S.value-100)<.01),M=async()=>{x.value=!0,o.value=null;try{const l=await K("/wow/wheel");if(!l.ok)throw new Error("ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ ÑÐµÐºÑ‚Ð¾Ñ€Ð¾Ð²");const r=await l.json();b.value=(r.data||[]).map(h=>({...h,probability_percent:parseFloat(h.probability_percent)||0,prize_value:h.prize_value||0})),r.settings&&(w.value=r.settings.always_empty_mode||!1,f.value=r.settings.ticket_restore_hours||3,s.value=r.settings.admin_username||"")}catch(l){o.value=l.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ ÑÐµÐºÑ‚Ð¾Ñ€Ð¾Ð²"}finally{x.value=!1}},B=async()=>{if(!V.value){await v.fire({title:"ÐžÑˆÐ¸Ð±ÐºÐ°",text:"Ð¡ÑƒÐ¼Ð¼Ð° Ð²ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚ÐµÐ¹ Ð´Ð¾Ð»Ð¶Ð½Ð° Ð±Ñ‹Ñ‚ÑŒ Ñ€Ð°Ð²Ð½Ð° 100%",icon:"error",confirmButtonText:"ÐžÐš"});return}t.value=!0,o.value=null;try{const l=b.value.map(c=>({id:c.id,prize_type:c.prize_type,prize_value:c.prize_value||0,icon_url:c.icon_url||null,probability_percent:parseFloat(c.probability_percent)||0,is_active:c.is_active!==!1})),r=await E("/wow/wheel/bulk-update",{sectors:l});if(!r.ok){const c=await r.json();throw new Error(c.message||"ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ ÑÐµÐºÑ‚Ð¾Ñ€Ð¾Ð²")}const h=await r.json();await v.fire({title:"Ð¡ÐµÐºÑ‚Ð¾Ñ€Ñ‹ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ñ‹",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),await M()}catch(l){o.value=l.message||"ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ ÑÐµÐºÑ‚Ð¾Ñ€Ð¾Ð²",await v.fire({title:"ÐžÑˆÐ¸Ð±ÐºÐ°",text:l.message||"ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ ÑÐµÐºÑ‚Ð¾Ñ€Ð¾Ð²",icon:"error",confirmButtonText:"ÐžÐš"})}finally{t.value=!1}},T=l=>{l.target.style.display="none"},D=l=>{p.value=l,_.value=null,n.value=!0},U=()=>{n.value=!1,p.value=null,_.value=null},A=l=>{if(p.value&&l){const r=l.url||(l.metadata?.path?"/"+l.metadata.path:"");p.value.icon_url=r||"",_.value=l,setTimeout(()=>{U()},300)}},N=async()=>{y.value=!0;try{const l=await E("/wow/wheel/settings",{always_empty_mode:w.value,ticket_restore_hours:f.value,admin_username:s.value});if(!l.ok){const r=await l.json();throw new Error(r.message||"ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐº")}await v.fire({title:"ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ñ‹",icon:"success",timer:1500,showConfirmButton:!1,toast:!0,position:"top-end"})}catch(l){await v.fire({title:"ÐžÑˆÐ¸Ð±ÐºÐ°",text:l.message||"ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐº",icon:"error",confirmButtonText:"ÐžÐš"}),await M()}finally{y.value=!1}};return W(()=>{M()}),{loading:x,saving:t,savingSettings:y,error:o,sectors:b,alwaysEmptyMode:w,ticketRestoreHours:f,adminUsername:s,totalProbability:S,probabilityValid:V,saveAllSectors:B,saveSettings:N,handleImageError:T,showMediaModal:n,currentSector:p,selectedMediaFile:_,openMediaSelector:D,closeMediaModal:U,handleMediaFileSelected:A}}},X={class:"wheel-page space-y-6"},Y={class:"flex items-center justify-between"},Z={class:"flex items-center gap-4"},$={key:0,class:"ml-2"},ee=["disabled"],te={key:0,class:"bg-card rounded-lg border border-border p-6 space-y-6"},oe={class:"flex items-center justify-between"},se={class:"relative inline-flex items-center cursor-pointer"},le={class:"flex items-center justify-between"},ne={class:"flex items-center gap-3"},re={class:"flex items-center justify-between"},ae={class:"flex items-center gap-3"},ie={key:1,class:"flex items-center justify-center py-12"},de={key:2,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},ce={class:"text-destructive"},ue={key:3,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},me={class:"flex items-center justify-between"},be={class:"text-lg font-semibold"},fe={class:"flex items-center gap-2 cursor-pointer"},pe=["onUpdate:modelValue"],ge=["onUpdate:modelValue"],ve={key:0},xe=["onUpdate:modelValue"],ye=["onUpdate:modelValue"],we={class:"mt-1 h-2 bg-muted rounded-full overflow-hidden"},_e={class:"flex gap-2"},he=["onUpdate:modelValue"],ke=["onClick"],Me={key:0,class:"mt-2"},Se=["src","alt"],Ve={class:"flex items-center justify-between p-4 border-b border-border"},Ue={class:"flex-1 overflow-hidden"};function je(x,t,y,o,b,w){const f=q("Media");return d(),a("div",X,[e("div",Y,[t[11]||(t[11]=e("div",null,[e("h1",{class:"text-3xl font-semibold text-foreground"},"Ð ÐµÐ´Ð°ÐºÑ‚Ð¾Ñ€ Ñ€ÑƒÐ»ÐµÑ‚ÐºÐ¸"),e("p",{class:"text-muted-foreground mt-1"},"ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° ÑÐµÐºÑ‚Ð¾Ñ€Ð¾Ð² Ñ€ÑƒÐ»ÐµÑ‚ÐºÐ¸ Ð¸ Ð²ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚ÐµÐ¹ Ð²Ñ‹Ð¿Ð°Ð´ÐµÐ½Ð¸Ñ")],-1)),e("div",Z,[e("div",{class:H(["px-4 py-2 rounded-lg text-sm font-medium",o.probabilityValid?"bg-green-500/10 text-green-600":"bg-red-500/10 text-red-600"])},[j(" Ð’ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚ÑŒ: "+k(o.totalProbability.toFixed(2))+"% ",1),o.probabilityValid?u("",!0):(d(),a("span",$,"(Ð´Ð¾Ð»Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ 100%)"))],2),e("button",{onClick:t[0]||(t[0]=(...s)=>o.saveAllSectors&&o.saveAllSectors(...s)),disabled:!o.probabilityValid||o.saving,class:"h-11 px-6 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-2xl shadow-lg shadow-accent/10 inline-flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"},[e("span",null,k(o.saving?"Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ...":"Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ Ð²ÑÐµ"),1)],8,ee)])]),o.loading?u("",!0):(d(),a("div",te,[t[17]||(t[17]=e("h2",{class:"text-xl font-semibold mb-4"},"ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ñ€ÑƒÐ»ÐµÑ‚ÐºÐ¸",-1)),e("div",oe,[t[13]||(t[13]=e("div",null,[e("h3",{class:"text-base font-medium mb-1"},'Ð ÐµÐ¶Ð¸Ð¼ "Ð’ÑÐµÐ³Ð´Ð° Ð¿ÑƒÑÑ‚Ð¾"'),e("p",{class:"text-sm text-muted-foreground"}," ÐŸÑ€Ð¸ Ð²ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ð¸ ÐºÐ¾Ð»ÐµÑÐ¾ Ð²ÑÐµÐ³Ð´Ð° Ð±ÑƒÐ´ÐµÑ‚ Ð¾ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°Ñ‚ÑŒÑÑ Ð½Ð° Ð¿ÑƒÑÑ‚Ð¾Ð¼ ÑÐµÐºÑ‚Ð¾Ñ€Ðµ ")],-1)),e("label",se,[m(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>o.alwaysEmptyMode=s),onChange:t[2]||(t[2]=(...s)=>o.saveSettings&&o.saveSettings(...s)),type:"checkbox",class:"sr-only peer"},null,544),[[C,o.alwaysEmptyMode]]),t[12]||(t[12]=e("div",{class:"w-11 h-6 bg-muted peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-accent/20 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-border after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-accent"},null,-1))])]),e("div",le,[t[15]||(t[15]=e("div",{class:"flex-1"},[e("h3",{class:"text-base font-medium mb-1"},"ÐŸÐµÑ€Ð¸Ð¾Ð´ Ð²Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ Ð±Ð¸Ð»ÐµÑ‚Ð°"),e("p",{class:"text-sm text-muted-foreground"}," Ð§ÐµÑ€ÐµÐ· ÑÐºÐ¾Ð»ÑŒÐºÐ¾ Ñ‡Ð°ÑÐ¾Ð² Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð¿Ð¾Ð»ÑƒÑ‡Ð°ÐµÑ‚ Ð½Ð¾Ð²Ñ‹Ð¹ Ð±Ð¸Ð»ÐµÑ‚ (Ð¾Ñ‚ 1 Ð´Ð¾ 24 Ñ‡Ð°ÑÐ¾Ð²) ")],-1)),e("div",ne,[m(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>o.ticketRestoreHours=s),onChange:t[4]||(t[4]=(...s)=>o.saveSettings&&o.saveSettings(...s)),type:"number",min:"1",max:"24",step:"1",class:"w-24 h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent text-center"},null,544),[[g,o.ticketRestoreHours,void 0,{number:!0}]]),t[14]||(t[14]=e("span",{class:"text-sm text-muted-foreground"},"Ñ‡Ð°ÑÐ¾Ð²",-1))])]),e("div",re,[t[16]||(t[16]=e("div",{class:"flex-1"},[e("h3",{class:"text-base font-medium mb-1"},"Username Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ð°"),e("p",{class:"text-sm text-muted-foreground"}," Telegram username Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ð° Ð´Ð»Ñ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ð¸ ÑÑÑ‹Ð»Ð¾Ðº (Ð±ÐµÐ· @) ")],-1)),e("div",ae,[m(e("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>o.adminUsername=s),onChange:t[6]||(t[6]=(...s)=>o.saveSettings&&o.saveSettings(...s)),type:"text",placeholder:"admin_username",class:"w-64 h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,544),[[g,o.adminUsername]])])])])),o.loading?(d(),a("div",ie,[...t[18]||(t[18]=[e("p",{class:"text-muted-foreground"},"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° ÑÐµÐºÑ‚Ð¾Ñ€Ð¾Ð²...",-1)])])):u("",!0),o.error?(d(),a("div",de,[e("p",ce,k(o.error),1)])):u("",!0),o.loading?u("",!0):(d(),a("div",ue,[(d(!0),a(I,null,P(o.sectors,s=>(d(),a("div",{key:s.id,class:"bg-card rounded-lg border border-border p-6 space-y-4"},[e("div",me,[e("h3",be,"Ð¡ÐµÐºÑ‚Ð¾Ñ€ #"+k(s.sector_number),1),e("label",fe,[m(e("input",{"onUpdate:modelValue":n=>s.is_active=n,type:"checkbox",class:"w-4 h-4"},null,8,pe),[[C,s.is_active]]),t[19]||(t[19]=e("span",{class:"text-sm"},"ÐÐºÑ‚Ð¸Ð²ÐµÐ½",-1))])]),e("div",null,[t[21]||(t[21]=e("label",{class:"text-sm font-medium mb-1 block"},"Ð¢Ð¸Ð¿ Ð¿Ñ€Ð¸Ð·Ð°",-1)),m(e("select",{"onUpdate:modelValue":n=>s.prize_type=n,class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},[...t[20]||(t[20]=[e("option",{value:"empty"},"ÐŸÑƒÑÑ‚Ð¾",-1),e("option",{value:"money"},"Ð”ÐµÐ½ÑŒÐ³Ð¸",-1),e("option",{value:"ticket"},"Ð‘Ð¸Ð»ÐµÑ‚",-1),e("option",{value:"secret_box"},"Ð¡ÐµÐºÑ€ÐµÑ‚Ð½Ñ‹Ð¹ Ð±Ð¾ÐºÑ",-1)])],8,ge),[[G,s.prize_type]])]),s.prize_type==="money"?(d(),a("div",ve,[t[22]||(t[22]=e("label",{class:"text-sm font-medium mb-1 block"},"Ð¡ÑƒÐ¼Ð¼Ð° (â‚½)",-1)),m(e("input",{"onUpdate:modelValue":n=>s.prize_value=n,type:"number",min:"0",placeholder:"300",class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,8,xe),[[g,s.prize_value,void 0,{number:!0}]])])):u("",!0),e("div",null,[t[23]||(t[23]=e("label",{class:"text-sm font-medium mb-1 block"},[j(" Ð’ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚ÑŒ (%) "),e("span",{class:"text-xs text-muted-foreground"},"(0-100)")],-1)),m(e("input",{"onUpdate:modelValue":n=>s.probability_percent=n,type:"number",min:"0",max:"100",step:"0.01",placeholder:"0.00",class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,8,ye),[[g,s.probability_percent,void 0,{number:!0}]]),e("div",we,[e("div",{class:"h-full bg-accent transition-all",style:J({width:`${s.probability_percent}%`})},null,4)])]),e("div",null,[t[24]||(t[24]=e("label",{class:"text-sm font-medium mb-1 block"},"URL Ð¸ÐºÐ¾Ð½ÐºÐ¸",-1)),e("div",_e,[m(e("input",{"onUpdate:modelValue":n=>s.icon_url=n,type:"text",placeholder:"https://...",class:"flex-1 h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,8,he),[[g,s.icon_url]]),e("button",{onClick:n=>o.openMediaSelector(s),type:"button",class:"h-10 px-4 bg-accent/10 text-accent border border-accent/40 hover:bg-accent/20 rounded-lg inline-flex items-center justify-center gap-2 transition-colors",title:"Ð’Ñ‹Ð±Ñ€Ð°Ñ‚ÑŒ Ð¸Ð· Ð¼ÐµÐ´Ð¸Ð°Ñ‚ÐµÐºÐ¸"}," ðŸ“ ",8,ke)]),s.icon_url?(d(),a("div",Me,[e("img",{src:s.icon_url,alt:`Ð¡ÐµÐºÑ‚Ð¾Ñ€ ${s.sector_number}`,class:"w-16 h-16 object-contain rounded",onError:t[7]||(t[7]=(...n)=>o.handleImageError&&o.handleImageError(...n))},null,40,Se)])):u("",!0)])]))),128))])),o.showMediaModal?(d(),a("div",{key:4,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm",onClick:t[10]||(t[10]=F((...s)=>o.closeMediaModal&&o.closeMediaModal(...s),["self"]))},[e("div",{class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-6xl h-[90vh] flex flex-col",onClick:t[9]||(t[9]=F(()=>{},["stop"]))},[e("div",Ve,[t[25]||(t[25]=e("h3",{class:"text-lg font-semibold"},"Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¸ÐºÐ¾Ð½ÐºÑƒ",-1)),e("button",{onClick:t[8]||(t[8]=(...s)=>o.closeMediaModal&&o.closeMediaModal(...s)),class:"w-8 h-8 flex items-center justify-center rounded-lg hover:bg-muted transition-colors"}," âœ• ")]),e("div",Ue,[L(f,{selectionMode:!0,countFile:1,selectedFiles:o.selectedMediaFile?[o.selectedMediaFile]:[],onFileSelected:o.handleMediaFileSelected},null,8,["selectedFiles","onFileSelected"])])])])):u("",!0)])}const Be=R(Q,[["render",je]]);export{Be as default};
