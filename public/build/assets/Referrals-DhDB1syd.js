import{_ as I,c as a,a as e,b as x,t as u,d as p,v as _,F as S,q as D,r as b,m as y,k as T,o as c}from"./admin-BrDwK2J-.js";import{a as V}from"./api-DccBIR6h.js";const j={name:"Referrals",setup(){const f=b(!1),t=b(null),l=b([]),r=b({search:"",date_from:"",date_to:""});let m=null;const h=y(()=>l.value.length),o=y(()=>new Set(l.value.map(i=>i.inviter_id)).size),w=y(()=>{const d={};l.value.forEach(n=>{const s=n.inviter_id;d[s]=(d[s]||0)+1});const i=Object.keys(d).reduce((n,s)=>d[n]>d[s]?n:s,null);return l.value.find(n=>n.inviter_id==i)?.inviter||null}),v=async()=>{f.value=!0,t.value=null;try{const d=await V("/wow/users",{per_page:100});if(!d.ok)throw new Error("Ошибка загрузки данных");const i=await d.json(),n=[];i.data?.forEach(s=>{if(s.invited_by){const g=i.data?.find(R=>R.id===s.invited_by);g&&n.push({id:`${g.id}-${s.id}`,inviter_id:g.id,invited_id:s.id,inviter:g,invited:s,invited_at:s.created_at})}}),l.value=n}catch(d){t.value=d.message||"Ошибка загрузки рефералов"}finally{f.value=!1}},k=()=>{m&&clearTimeout(m),m=setTimeout(()=>{v()},500)};return T(()=>{v()}),{loading:f,error:t,referrals:l,filters:r,totalReferrals:h,activeReferrals:o,topInviter:w,fetchReferrals:v,handleSearch:k}}},E={class:"referrals-page space-y-6"},U={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},q={class:"bg-card rounded-lg border border-border p-6"},B={class:"text-2xl font-bold"},C={class:"bg-card rounded-lg border border-border p-6"},L={class:"text-2xl font-bold"},F={class:"bg-card rounded-lg border border-border p-6"},M={class:"text-lg font-semibold"},N={class:"bg-card rounded-lg border border-border p-4 space-y-4"},z={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},G={key:0,class:"flex items-center justify-center py-12"},O={key:1,class:"bg-card rounded-lg border border-border overflow-hidden"},A={class:"overflow-x-auto"},H={class:"w-full"},J={class:"divide-y divide-border"},K={class:"px-6 py-4 text-sm font-medium text-foreground"},P={class:"px-6 py-4 text-sm font-medium text-foreground"},Q={class:"px-6 py-4 text-sm text-muted-foreground"},W={key:2,class:"bg-card rounded-lg border border-border p-12 text-center"};function X(f,t,l,r,m,h){return c(),a("div",E,[t[15]||(t[15]=e("div",{class:"flex items-center justify-between"},[e("div",null,[e("h1",{class:"text-3xl font-semibold text-foreground"},"Рефералы"),e("p",{class:"text-muted-foreground mt-1"},"Управление реферальной системой")])],-1)),e("div",U,[e("div",q,[t[6]||(t[6]=e("p",{class:"text-sm text-muted-foreground mb-2"},"Всего реферальных связей",-1)),e("p",B,u(r.totalReferrals),1)]),e("div",C,[t[7]||(t[7]=e("p",{class:"text-sm text-muted-foreground mb-2"},"Активных рефералов",-1)),e("p",L,u(r.activeReferrals),1)]),e("div",F,[t[8]||(t[8]=e("p",{class:"text-sm text-muted-foreground mb-2"},"Топ приглашающий",-1)),e("p",M,u(r.topInviter?`@${r.topInviter.username||r.topInviter.telegram_id}`:"—"),1)])]),e("div",N,[e("div",z,[e("div",null,[t[9]||(t[9]=e("label",{class:"text-sm font-medium mb-1 block"},"Поиск",-1)),p(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>r.filters.search=o),type:"text",placeholder:"Telegram ID...",onInput:t[1]||(t[1]=(...o)=>r.handleSearch&&r.handleSearch(...o)),class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,544),[[_,r.filters.search]])]),e("div",null,[t[10]||(t[10]=e("label",{class:"text-sm font-medium mb-1 block"},"Дата от",-1)),p(e("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>r.filters.date_from=o),type:"date",onChange:t[3]||(t[3]=(...o)=>r.fetchReferrals&&r.fetchReferrals(...o)),class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,544),[[_,r.filters.date_from]])]),e("div",null,[t[11]||(t[11]=e("label",{class:"text-sm font-medium mb-1 block"},"Дата до",-1)),p(e("input",{"onUpdate:modelValue":t[4]||(t[4]=o=>r.filters.date_to=o),type:"date",onChange:t[5]||(t[5]=(...o)=>r.fetchReferrals&&r.fetchReferrals(...o)),class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,544),[[_,r.filters.date_to]])])])]),r.loading?(c(),a("div",G,[...t[12]||(t[12]=[e("p",{class:"text-muted-foreground"},"Загрузка рефералов...",-1)])])):x("",!0),!r.loading&&r.referrals.length>0?(c(),a("div",O,[e("div",A,[e("table",H,[t[13]||(t[13]=e("thead",{class:"bg-muted/30 border-b border-border"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase"},"Пригласивший"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase"},"Приглашенный"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase"},"Дата приглашения")])],-1)),e("tbody",J,[(c(!0),a(S,null,D(r.referrals,o=>(c(),a("tr",{key:o.id,class:"hover:bg-muted/10"},[e("td",K," @"+u(o.inviter?.username||o.inviter?.telegram_id||"—"),1),e("td",P," @"+u(o.invited?.username||o.invited?.telegram_id||"—"),1),e("td",Q,u(new Date(o.invited_at).toLocaleDateString("ru-RU")),1)]))),128))])])])])):x("",!0),!r.loading&&r.referrals.length===0?(c(),a("div",W,[...t[14]||(t[14]=[e("p",{class:"text-muted-foreground"},"Рефералы не найдены",-1)])])):x("",!0)])}const $=I(j,[["render",X]]);export{$ as default};
