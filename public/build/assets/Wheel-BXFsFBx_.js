import{_ as J,c as a,a as e,b as m,p as K,e as F,t as b,d as p,B as U,v as k,F as T,q as E,w as B,f as O,r as d,m as P,k as Q,h as X,o as i,A as Y,C as Z}from"./admin-DCecbpOE.js";import{a as D,c as I}from"./api-DccBIR6h.js";import{S as x}from"./sweetalert2.esm.all-C0u8rGqG.js";import $ from"./Media-BLg8ycZg.js";const ee={name:"Wheel",components:{Media:$},setup(){const _=d(!1),t=d(!1),w=d(!1),o=d(null),f=d([]),g=d([]),v=d(!1),n=d(3),r=d(""),M=d(!1),y=d(null),h=d(null),S=P(()=>f.value.reduce((s,l)=>s+(parseFloat(l.probability_percent)||0),0)),C=P(()=>Math.abs(S.value-100)<.01),A=async()=>{try{const s=await D("/wow/prize-types");if(s.ok){const l=await s.json();g.value=l.data||[]}}catch(s){console.error("ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ñ‚Ð¸Ð¿Ð¾Ð² Ð¿Ñ€Ð¸Ð·Ð¾Ð²:",s)}},z=async()=>{_.value=!0,o.value=null;try{const s=await D("/wow/wheel");if(!s.ok)throw new Error("ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ ÑÐµÐºÑ‚Ð¾Ñ€Ð¾Ð²");const l=await s.json();f.value=(l.data||[]).map(c=>({...c,probability_percent:parseFloat(c.probability_percent)||0,prize_value:c.prize_value||0,prize_type_id:c.prize_type_id||null})),l.settings&&(v.value=l.settings.always_empty_mode||!1,n.value=l.settings.ticket_restore_hours||3,r.value=l.settings.admin_username||"")}catch(s){o.value=s.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ ÑÐµÐºÑ‚Ð¾Ñ€Ð¾Ð²"}finally{_.value=!1}},V=s=>({money:"Ð”ÐµÐ½ÑŒÐ³Ð¸",ticket:"Ð‘Ð¸Ð»ÐµÑ‚",gift:"ÐŸÐ¾Ð´Ð°Ñ€Ð¾Ðº",secret_box:"Ð¡ÐµÐºÑ€ÐµÑ‚Ð½Ñ‹Ð¹ Ð±Ð¾ÐºÑ",empty:"ÐŸÑƒÑÑ‚Ð¾",sponsor_gift:"ÐŸÐ¾Ð´Ð°Ñ€Ð¾Ðº Ð¾Ñ‚ ÑÐ¿Ð¾Ð½ÑÐ¾Ñ€Ð°"})[s]||s,L=s=>{const l=g.value.find(u=>u.id===s);if(!l)return"";let c=`Ð¢Ð¸Ð¿: ${V(l.type)}`;return l.value&&(c+=`, Ð—Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ: ${l.value}`),l.action!=="none"&&(c+=`, Ð”ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ: ${l.action==="add_ticket"?"Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð±Ð¸Ð»ÐµÑ‚":l.action}`),c},N=s=>{const l=g.value.find(c=>c.id===s.prize_type_id);l&&(s.prize_type=l.type,s.prize_value=l.value||0,s.icon_url=l.icon_url||s.icon_url)},R=async()=>{if(!C.value){await x.fire({title:"ÐžÑˆÐ¸Ð±ÐºÐ°",text:"Ð¡ÑƒÐ¼Ð¼Ð° Ð²ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚ÐµÐ¹ Ð´Ð¾Ð»Ð¶Ð½Ð° Ð±Ñ‹Ñ‚ÑŒ Ñ€Ð°Ð²Ð½Ð° 100%",icon:"error",confirmButtonText:"ÐžÐš"});return}t.value=!0,o.value=null;try{const s=f.value.map(u=>({id:u.id,prize_type:u.prize_type,prize_value:u.prize_value||0,icon_url:u.icon_url||null,probability_percent:parseFloat(u.probability_percent)||0,is_active:u.is_active!==!1,prize_type_id:u.prize_type_id||null})),l=await I("/wow/wheel/bulk-update",{sectors:s});if(!l.ok){const u=await l.json();throw new Error(u.message||"ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ ÑÐµÐºÑ‚Ð¾Ñ€Ð¾Ð²")}const c=await l.json();await x.fire({title:"Ð¡ÐµÐºÑ‚Ð¾Ñ€Ñ‹ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ñ‹",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),await z()}catch(s){o.value=s.message||"ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ ÑÐµÐºÑ‚Ð¾Ñ€Ð¾Ð²",await x.fire({title:"ÐžÑˆÐ¸Ð±ÐºÐ°",text:s.message||"ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ ÑÐµÐºÑ‚Ð¾Ñ€Ð¾Ð²",icon:"error",confirmButtonText:"ÐžÐš"})}finally{t.value=!1}},H=s=>{s.target.style.display="none"},W=s=>{y.value=s,h.value=null,M.value=!0},j=()=>{M.value=!1,y.value=null,h.value=null},q=s=>{if(y.value&&s){const l=s.url||(s.metadata?.path?"/"+s.metadata.path:"");y.value.icon_url=l||"",h.value=s,setTimeout(()=>{j()},300)}},G=async()=>{w.value=!0;try{const s=await I("/wow/wheel/settings",{always_empty_mode:v.value,ticket_restore_hours:n.value,admin_username:r.value});if(!s.ok){const l=await s.json();throw new Error(l.message||"ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐº")}await x.fire({title:"ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ñ‹",icon:"success",timer:1500,showConfirmButton:!1,toast:!0,position:"top-end"})}catch(s){await x.fire({title:"ÐžÑˆÐ¸Ð±ÐºÐ°",text:s.message||"ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐº",icon:"error",confirmButtonText:"ÐžÐš"}),await z()}finally{w.value=!1}};return Q(async()=>{await A(),await z()}),{loading:_,saving:t,savingSettings:w,error:o,sectors:f,alwaysEmptyMode:v,ticketRestoreHours:n,adminUsername:r,totalProbability:S,probabilityValid:C,saveAllSectors:R,saveSettings:G,handleImageError:H,showMediaModal:M,currentSector:y,selectedMediaFile:h,openMediaSelector:W,closeMediaModal:j,handleMediaFileSelected:q,prizeTypes:g,getTypeLabel:V,getSelectedPrizeTypeInfo:L,onPrizeTypeChange:N}}},te={class:"wheel-page space-y-6"},oe={class:"flex items-center justify-between"},se={class:"flex items-center gap-4"},ne={key:0,class:"ml-2"},le=["disabled"],re={key:0,class:"bg-card rounded-lg border border-border p-6 space-y-6"},ae={class:"flex items-center justify-between"},ie={class:"relative inline-flex items-center cursor-pointer"},de={class:"flex items-center justify-between"},ce={class:"flex items-center gap-3"},ue={class:"flex items-center justify-between"},me={class:"flex items-center gap-3"},be={key:1,class:"flex items-center justify-center py-12"},pe={key:2,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},fe={class:"text-destructive"},ge={key:3,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},ve={class:"flex items-center justify-between"},ye={class:"text-lg font-semibold"},xe={class:"flex items-center gap-2 cursor-pointer"},_e=["onUpdate:modelValue"],we=["onUpdate:modelValue","onChange"],he=["value"],ke={key:0,class:"text-xs text-muted-foreground mt-1"},Me=["onUpdate:modelValue"],ze={class:"mt-1 h-2 bg-muted rounded-full overflow-hidden"},Se={class:"flex gap-2"},Ce=["onUpdate:modelValue"],Ve=["onClick"],je={key:0,class:"mt-2"},Fe=["src","alt"],Ue={class:"flex items-center justify-between p-4 border-b border-border"},Te={class:"flex-1 overflow-hidden"};function Ee(_,t,w,o,f,g){const v=X("Media");return i(),a("div",te,[e("div",oe,[t[11]||(t[11]=e("div",null,[e("h1",{class:"text-3xl font-semibold text-foreground"},"Ð ÐµÐ´Ð°ÐºÑ‚Ð¾Ñ€ Ñ€ÑƒÐ»ÐµÑ‚ÐºÐ¸"),e("p",{class:"text-muted-foreground mt-1"},"ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° ÑÐµÐºÑ‚Ð¾Ñ€Ð¾Ð² Ñ€ÑƒÐ»ÐµÑ‚ÐºÐ¸ Ð¸ Ð²ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚ÐµÐ¹ Ð²Ñ‹Ð¿Ð°Ð´ÐµÐ½Ð¸Ñ")],-1)),e("div",se,[e("div",{class:K(["px-4 py-2 rounded-lg text-sm font-medium",o.probabilityValid?"bg-green-500/10 text-green-600":"bg-red-500/10 text-red-600"])},[F(" Ð’ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚ÑŒ: "+b(o.totalProbability.toFixed(2))+"% ",1),o.probabilityValid?m("",!0):(i(),a("span",ne,"(Ð´Ð¾Ð»Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ 100%)"))],2),e("button",{onClick:t[0]||(t[0]=(...n)=>o.saveAllSectors&&o.saveAllSectors(...n)),disabled:!o.probabilityValid||o.saving,class:"h-11 px-6 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-2xl shadow-lg shadow-accent/10 inline-flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"},[e("span",null,b(o.saving?"Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ...":"Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ Ð²ÑÐµ"),1)],8,le)])]),o.loading?m("",!0):(i(),a("div",re,[t[17]||(t[17]=e("h2",{class:"text-xl font-semibold mb-4"},"ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ñ€ÑƒÐ»ÐµÑ‚ÐºÐ¸",-1)),e("div",ae,[t[13]||(t[13]=e("div",null,[e("h3",{class:"text-base font-medium mb-1"},'Ð ÐµÐ¶Ð¸Ð¼ "Ð’ÑÐµÐ³Ð´Ð° Ð¿ÑƒÑÑ‚Ð¾"'),e("p",{class:"text-sm text-muted-foreground"}," ÐŸÑ€Ð¸ Ð²ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ð¸ ÐºÐ¾Ð»ÐµÑÐ¾ Ð²ÑÐµÐ³Ð´Ð° Ð±ÑƒÐ´ÐµÑ‚ Ð¾ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°Ñ‚ÑŒÑÑ Ð½Ð° Ð¿ÑƒÑÑ‚Ð¾Ð¼ ÑÐµÐºÑ‚Ð¾Ñ€Ðµ ")],-1)),e("label",ie,[p(e("input",{"onUpdate:modelValue":t[1]||(t[1]=n=>o.alwaysEmptyMode=n),onChange:t[2]||(t[2]=(...n)=>o.saveSettings&&o.saveSettings(...n)),type:"checkbox",class:"sr-only peer"},null,544),[[U,o.alwaysEmptyMode]]),t[12]||(t[12]=e("div",{class:"w-11 h-6 bg-muted peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-accent/20 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-border after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-accent"},null,-1))])]),e("div",de,[t[15]||(t[15]=e("div",{class:"flex-1"},[e("h3",{class:"text-base font-medium mb-1"},"ÐŸÐµÑ€Ð¸Ð¾Ð´ Ð²Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ Ð±Ð¸Ð»ÐµÑ‚Ð°"),e("p",{class:"text-sm text-muted-foreground"}," Ð§ÐµÑ€ÐµÐ· ÑÐºÐ¾Ð»ÑŒÐºÐ¾ Ñ‡Ð°ÑÐ¾Ð² Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð¿Ð¾Ð»ÑƒÑ‡Ð°ÐµÑ‚ Ð½Ð¾Ð²Ñ‹Ð¹ Ð±Ð¸Ð»ÐµÑ‚ (Ð¾Ñ‚ 1 Ð´Ð¾ 24 Ñ‡Ð°ÑÐ¾Ð²) ")],-1)),e("div",ce,[p(e("input",{"onUpdate:modelValue":t[3]||(t[3]=n=>o.ticketRestoreHours=n),onChange:t[4]||(t[4]=(...n)=>o.saveSettings&&o.saveSettings(...n)),type:"number",min:"1",max:"24",step:"1",class:"w-24 h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent text-center"},null,544),[[k,o.ticketRestoreHours,void 0,{number:!0}]]),t[14]||(t[14]=e("span",{class:"text-sm text-muted-foreground"},"Ñ‡Ð°ÑÐ¾Ð²",-1))])]),e("div",ue,[t[16]||(t[16]=e("div",{class:"flex-1"},[e("h3",{class:"text-base font-medium mb-1"},"Username Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ð°"),e("p",{class:"text-sm text-muted-foreground"}," Telegram username Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ð° Ð´Ð»Ñ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ð¸ ÑÑÑ‹Ð»Ð¾Ðº (Ð±ÐµÐ· @) ")],-1)),e("div",me,[p(e("input",{"onUpdate:modelValue":t[5]||(t[5]=n=>o.adminUsername=n),onChange:t[6]||(t[6]=(...n)=>o.saveSettings&&o.saveSettings(...n)),type:"text",placeholder:"admin_username",class:"w-64 h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,544),[[k,o.adminUsername]])])])])),o.loading?(i(),a("div",be,[...t[18]||(t[18]=[e("p",{class:"text-muted-foreground"},"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° ÑÐµÐºÑ‚Ð¾Ñ€Ð¾Ð²...",-1)])])):m("",!0),o.error?(i(),a("div",pe,[e("p",fe,b(o.error),1)])):m("",!0),o.loading?m("",!0):(i(),a("div",ge,[(i(!0),a(T,null,E(o.sectors,n=>(i(),a("div",{key:n.id,class:"bg-card rounded-lg border border-border p-6 space-y-4"},[e("div",ve,[e("h3",ye,"Ð¡ÐµÐºÑ‚Ð¾Ñ€ #"+b(n.sector_number),1),e("label",xe,[p(e("input",{"onUpdate:modelValue":r=>n.is_active=r,type:"checkbox",class:"w-4 h-4"},null,8,_e),[[U,n.is_active]]),t[19]||(t[19]=e("span",{class:"text-sm"},"ÐÐºÑ‚Ð¸Ð²ÐµÐ½",-1))])]),e("div",null,[t[21]||(t[21]=e("label",{class:"text-sm font-medium mb-1 block"},"Ð¢Ð¸Ð¿ Ð¿Ñ€Ð¸Ð·Ð°",-1)),p(e("select",{"onUpdate:modelValue":r=>n.prize_type_id=r,onChange:r=>o.onPrizeTypeChange(n),class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},[t[20]||(t[20]=e("option",{value:null},"Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ñ‚Ð¸Ð¿ Ð¿Ñ€Ð¸Ð·Ð°",-1)),(i(!0),a(T,null,E(o.prizeTypes,r=>(i(),a("option",{key:r.id,value:r.id},b(r.name)+" ("+b(o.getTypeLabel(r.type))+") ",9,he))),128))],40,we),[[Y,n.prize_type_id]]),n.prize_type_id?(i(),a("p",ke,b(o.getSelectedPrizeTypeInfo(n.prize_type_id)),1)):m("",!0)]),e("div",null,[t[22]||(t[22]=e("label",{class:"text-sm font-medium mb-1 block"},[F(" Ð’ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚ÑŒ (%) "),e("span",{class:"text-xs text-muted-foreground"},"(0-100)")],-1)),p(e("input",{"onUpdate:modelValue":r=>n.probability_percent=r,type:"number",min:"0",max:"100",step:"0.01",placeholder:"0.00",class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,8,Me),[[k,n.probability_percent,void 0,{number:!0}]]),e("div",ze,[e("div",{class:"h-full bg-accent transition-all",style:Z({width:`${n.probability_percent}%`})},null,4)])]),e("div",null,[t[23]||(t[23]=e("label",{class:"text-sm font-medium mb-1 block"},"URL Ð¸ÐºÐ¾Ð½ÐºÐ¸",-1)),e("div",Se,[p(e("input",{"onUpdate:modelValue":r=>n.icon_url=r,type:"text",placeholder:"https://...",class:"flex-1 h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,8,Ce),[[k,n.icon_url]]),e("button",{onClick:r=>o.openMediaSelector(n),type:"button",class:"h-10 px-4 bg-accent/10 text-accent border border-accent/40 hover:bg-accent/20 rounded-lg inline-flex items-center justify-center gap-2 transition-colors",title:"Ð’Ñ‹Ð±Ñ€Ð°Ñ‚ÑŒ Ð¸Ð· Ð¼ÐµÐ´Ð¸Ð°Ñ‚ÐµÐºÐ¸"}," ðŸ“ ",8,Ve)]),n.icon_url?(i(),a("div",je,[e("img",{src:n.icon_url,alt:`Ð¡ÐµÐºÑ‚Ð¾Ñ€ ${n.sector_number}`,class:"w-16 h-16 object-contain rounded",onError:t[7]||(t[7]=(...r)=>o.handleImageError&&o.handleImageError(...r))},null,40,Fe)])):m("",!0)])]))),128))])),o.showMediaModal?(i(),a("div",{key:4,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm",onClick:t[10]||(t[10]=B((...n)=>o.closeMediaModal&&o.closeMediaModal(...n),["self"]))},[e("div",{class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-6xl h-[90vh] flex flex-col",onClick:t[9]||(t[9]=B(()=>{},["stop"]))},[e("div",Ue,[t[24]||(t[24]=e("h3",{class:"text-lg font-semibold"},"Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¸ÐºÐ¾Ð½ÐºÑƒ",-1)),e("button",{onClick:t[8]||(t[8]=(...n)=>o.closeMediaModal&&o.closeMediaModal(...n)),class:"w-8 h-8 flex items-center justify-center rounded-lg hover:bg-muted transition-colors"}," âœ• ")]),e("div",Te,[O(v,{selectionMode:!0,countFile:1,selectedFiles:o.selectedMediaFile?[o.selectedMediaFile]:[],onFileSelected:o.handleMediaFileSelected},null,8,["selectedFiles","onFileSelected"])])])])):m("",!0)])}const Ae=J(ee,[["render",Ee]]);export{Ae as default};
