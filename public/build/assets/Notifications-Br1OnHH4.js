import{_ as U,c as i,a as t,b as p,d as y,v as z,C,A as I,t as c,F as T,q as S,r as b,k as R,o as d,p as k}from"./admin-CbEWicFl.js";import{S as w}from"./sweetalert2.esm.all-C0u8rGqG.js";const M={name:"Notifications",setup(){const v=b(!1),r=b(null),_=b([]),e=b(null),g=b({search:"",read:null,type:""}),m=b(1),o=b(20),h=b(null),x=async(a=1)=>{v.value=!0,r.value=null;try{const n=new URLSearchParams;n.append("page",a),n.append("per_page",o.value),g.value.search&&n.append("search",g.value.search),g.value.read!==null&&n.append("read",g.value.read?"1":"0"),g.value.type&&n.append("type",g.value.type);const l=localStorage.getItem("token"),f={Accept:"application/json","Content-Type":"application/json"};l&&(f.Authorization=`Bearer ${l}`);const s=await fetch(`/api/notifications/all?${n.toString()}`,{method:"GET",headers:f});if(!s.ok)throw new Error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π");const u=await s.json();_.value=u.data||[],e.value={current_page:u.current_page||1,last_page:u.last_page||1,per_page:u.per_page||o.value,total:u.total||0,from:u.from||0,to:u.to||0},m.value=u.current_page||1}catch(n){r.value=n.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π"}finally{v.value=!1}},B=()=>{h.value&&clearTimeout(h.value),h.value=setTimeout(()=>{m.value=1,x(1)},500)},j=()=>{m.value=1,x(1)},A=a=>{x(a)},E=async a=>{try{const n=localStorage.getItem("token"),l={Accept:"application/json","Content-Type":"application/json"};n&&(l.Authorization=`Bearer ${n}`),(await fetch(`/api/notifications/${a}/read`,{method:"POST",headers:l})).ok&&await x(m.value)}catch(n){console.error("Error marking notification as read:",n)}},V=async a=>{if((await w.fire({title:"–£–¥–∞–ª–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ?",text:"–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ?",icon:"warning",showCancelButton:!0,confirmButtonText:"–î–∞, —É–¥–∞–ª–∏—Ç—å",cancelButtonText:"–û—Ç–º–µ–Ω–∞",confirmButtonColor:"#dc2626",cancelButtonColor:"#6b7280"})).isConfirmed)try{const l=localStorage.getItem("token"),f={Accept:"application/json","Content-Type":"application/json"};if(l&&(f.Authorization=`Bearer ${l}`),!(await fetch(`/api/notifications/${a}`,{method:"DELETE",headers:f})).ok)throw new Error("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è");await w.fire({title:"–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),await x(m.value)}catch(l){w.fire({title:"–û—à–∏–±–∫–∞",text:l.message||"–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è",icon:"error",confirmButtonText:"–û–ö"})}},D=a=>a?new Date(a).toLocaleString("ru-RU",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"",F=a=>({info:"–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è",success:"–£—Å–ø–µ—Ö",warning:"–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ",error:"–û—à–∏–±–∫–∞"})[a]||a,N=a=>({info:"bg-blue-500/10 text-blue-500",success:"bg-green-500/10 text-green-500",warning:"bg-yellow-500/10 text-yellow-500",error:"bg-red-500/10 text-red-500"})[a]||"bg-muted text-muted-foreground",L=(a,n)=>{const l=[];if(n<=5)for(let s=1;s<=n;s++)l.push(s);else if(a<=3)for(let s=1;s<=5;s++)l.push(s);else if(a>=n-2)for(let s=n-4;s<=n;s++)l.push(s);else for(let s=a-2;s<=a+2;s++)l.push(s);return l};return R(()=>{x(1)}),{loading:v,error:r,notifications:_,pagination:e,filters:g,handleSearch:B,handleFilterChange:j,handlePageChange:A,markAsRead:E,deleteNotification:V,formatDate:D,getTypeLabel:F,getTypeClass:N,getPageNumbers:L}}},P={class:"notifications-page space-y-6"},q={class:"bg-card rounded-lg border border-border p-4"},G={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},O={class:"md:col-span-2"},H={class:"relative"},J={key:0,class:"flex items-center justify-center py-12"},K={key:1,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},Q={class:"text-destructive"},W={key:2,class:"space-y-3"},X={class:"flex items-start justify-between gap-4"},Y={class:"flex-1 min-w-0"},Z={class:"flex items-center gap-2 mb-2"},$={class:"font-semibold text-foreground"},ee={key:0,class:"h-2 w-2 bg-accent rounded-full flex-shrink-0",title:"–ù–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ"},te={class:"text-sm text-muted-foreground mb-2"},oe={class:"flex items-center gap-4 text-xs text-muted-foreground"},re={key:0},ne={class:"flex items-center gap-2 flex-shrink-0"},ae=["onClick"],se=["onClick"],le={key:3,class:"bg-card rounded-lg border border-border p-12 text-center"},ie={key:4,class:"flex flex-col sm:flex-row items-center justify-between pt-6 border-t border-border gap-4"},de={class:"text-sm text-muted-foreground"},ce={class:"flex gap-2 items-center"},ge=["disabled"],ue={class:"flex gap-1"},pe=["onClick"],be=["disabled"];function fe(v,r,_,e,g,m){return d(),i("div",P,[r[13]||(r[13]=t("div",{class:"flex items-center justify-between"},[t("div",null,[t("h1",{class:"text-3xl font-semibold text-foreground"},"–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"),t("p",{class:"text-muted-foreground mt-1"},"–ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π")])],-1)),t("div",q,[t("div",G,[t("div",O,[t("div",H,[r[8]||(r[8]=t("span",{class:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"},"üîç",-1)),y(t("input",{type:"text","onUpdate:modelValue":r[0]||(r[0]=o=>e.filters.search=o),onInput:r[1]||(r[1]=(...o)=>e.handleSearch&&e.handleSearch(...o)),placeholder:"–ü–æ–∏—Å–∫ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫—É –∏ —Å–æ–æ–±—â–µ–Ω–∏—é...",class:"w-full h-10 pl-9 pr-3 border border-border rounded bg-background text-sm"},null,544),[[z,e.filters.search]])])]),t("div",null,[y(t("select",{"onUpdate:modelValue":r[2]||(r[2]=o=>e.filters.read=o),onChange:r[3]||(r[3]=(...o)=>e.handleFilterChange&&e.handleFilterChange(...o)),class:"w-full h-10 px-3 border border-border rounded bg-background text-sm"},[...r[9]||(r[9]=[t("option",{value:null},"–í—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è",-1),t("option",{value:!1},"–ù–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ",-1),t("option",{value:!0},"–ü—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ",-1)])],544),[[C,e.filters.read]])]),t("div",null,[y(t("select",{"onUpdate:modelValue":r[4]||(r[4]=o=>e.filters.type=o),onChange:r[5]||(r[5]=(...o)=>e.handleFilterChange&&e.handleFilterChange(...o)),class:"w-full h-10 px-3 border border-border rounded bg-background text-sm"},[...r[10]||(r[10]=[I('<option value="">–í—Å–µ —Ç–∏–ø—ã</option><option value="info">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</option><option value="success">–£—Å–ø–µ—Ö</option><option value="warning">–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ</option><option value="error">–û—à–∏–±–∫–∞</option>',5)])],544),[[C,e.filters.type]])])])]),e.loading?(d(),i("div",J,[...r[11]||(r[11]=[t("p",{class:"text-muted-foreground"},"–ó–∞–≥—Ä—É–∑–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π...",-1)])])):p("",!0),e.error?(d(),i("div",K,[t("p",Q,c(e.error),1)])):p("",!0),!e.loading&&e.notifications.length>0?(d(),i("div",W,[(d(!0),i(T,null,S(e.notifications,o=>(d(),i("div",{key:o.id,class:k(["bg-card rounded-lg border p-4 transition-colors",o.read?"border-border":"border-accent bg-accent/5"])},[t("div",X,[t("div",Y,[t("div",Z,[t("h3",$,c(o.title),1),o.read?p("",!0):(d(),i("span",ee)),t("span",{class:k(["px-2 py-1 text-xs rounded",e.getTypeClass(o.type)])},c(e.getTypeLabel(o.type)),3)]),t("p",te,c(o.message),1),t("div",oe,[t("span",null,c(e.formatDate(o.created_at)),1),o.read_at?(d(),i("span",re," –ü—Ä–æ—á–∏—Ç–∞–Ω–æ: "+c(e.formatDate(o.read_at)),1)):p("",!0)])]),t("div",ne,[o.read?p("",!0):(d(),i("button",{key:0,onClick:h=>e.markAsRead(o.id),class:"px-3 py-1 text-xs bg-blue-500 hover:bg-blue-600 text-white rounded transition-colors",title:"–û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ"}," –ü—Ä–æ—á–∏—Ç–∞–Ω–æ ",8,ae)),t("button",{onClick:h=>e.deleteNotification(o.id),class:"px-3 py-1 text-xs bg-red-500 hover:bg-red-600 text-white rounded transition-colors",title:"–£–¥–∞–ª–∏—Ç—å"}," –£–¥–∞–ª–∏—Ç—å ",8,se)])])],2))),128))])):p("",!0),!e.loading&&e.notifications.length===0?(d(),i("div",le,[...r[12]||(r[12]=[t("p",{class:"text-muted-foreground"},"–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã",-1)])])):p("",!0),e.pagination&&e.pagination.last_page>1?(d(),i("div",ie,[t("div",de,[t("span",null," –ü–æ–∫–∞–∑–∞–Ω–æ "+c(e.pagination.from)+"-"+c(e.pagination.to)+" –∏–∑ "+c(e.pagination.total),1)]),t("div",ce,[t("button",{onClick:r[6]||(r[6]=o=>e.handlePageChange(e.pagination.current_page-1)),disabled:e.pagination.current_page===1,class:"px-3 py-2 rounded-md border border-border bg-background hover:bg-accent/10 disabled:opacity-50 disabled:cursor-not-allowed text-sm transition-colors"}," ‚Üê –ù–∞–∑–∞–¥ ",8,ge),t("div",ue,[(d(!0),i(T,null,S(e.getPageNumbers(e.pagination.current_page,e.pagination.last_page),o=>(d(),i("button",{key:o,onClick:h=>e.handlePageChange(o),class:k(["px-3 py-2 rounded-md border text-sm transition-colors min-w-[40px]",o===e.pagination.current_page?"bg-accent text-accent-foreground border-accent font-semibold":"border-border bg-background hover:bg-accent/10"])},c(o),11,pe))),128))]),t("button",{onClick:r[7]||(r[7]=o=>e.handlePageChange(e.pagination.current_page+1)),disabled:e.pagination.current_page===e.pagination.last_page,class:"px-3 py-2 rounded-md border border-border bg-background hover:bg-accent/10 disabled:opacity-50 disabled:cursor-not-allowed text-sm transition-colors"}," –í–ø–µ—Ä–µ–¥ ‚Üí ",8,be)])])):p("",!0)])}const xe=U(M,[["render",fe]]);export{xe as default};
