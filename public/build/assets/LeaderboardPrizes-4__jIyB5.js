import{_ as B,c as a,a as e,b as m,t as k,d as l,A as C,e as U,F as D,q as T,w as j,v as f,B as z,r as b,k as K,o as u}from"./admin-CVJgAGJK.js";import{a as M,c as x,d as O}from"./api-DccBIR6h.js";import{S as c}from"./sweetalert2.esm.all-C0u8rGqG.js";const E={name:"LeaderboardPrizes",setup(){const g=b(!1),o=b(!1),p=b(null),r=b([]),v=b(1),w=b(!1),t=b({rank:1,prize_amount:0,prize_description:"",is_active:!0}),s=async()=>{g.value=!0,p.value=null;try{const n=await M("/wow/leaderboard-prizes");if(!n.ok)throw new Error("Ошибка загрузки призов");const d=await n.json();r.value=d.data||[],v.value=d.leaderboard_period_months||1}catch(n){p.value=n.message||"Ошибка загрузки призов"}finally{g.value=!1}},y=async()=>{o.value=!0;try{if(r.value.length>0){const d=await x("/wow/leaderboard-prizes/bulk-update",{prizes:r.value.map(i=>({id:i.id,prize_amount:i.prize_amount,prize_description:i.prize_description,is_active:i.is_active}))});if(!d.ok){const i=await d.json();throw new Error(i.message||"Ошибка сохранения призов")}}const n=await x("/wow/leaderboard-prizes/update-period",{leaderboard_period_months:v.value});if(!n.ok){const d=await n.json();throw new Error(d.message||"Ошибка сохранения периода")}await c.fire({title:"Успешно!",text:"Настройки сохранены",icon:"success",confirmButtonText:"OK"}),s()}catch(n){await c.fire({title:"Ошибка",text:n.message||"Не удалось сохранить настройки",icon:"error",confirmButtonText:"OK"})}finally{o.value=!1}},_=async()=>{try{const n=await x("/wow/leaderboard-prizes",t.value);if(!n.ok){const d=await n.json();throw new Error(d.message||"Ошибка создания приза")}await c.fire({title:"Успешно!",text:"Место добавлено",icon:"success",confirmButtonText:"OK"}),w.value=!1,t.value={rank:1,prize_amount:0,prize_description:"",is_active:!0},s()}catch(n){await c.fire({title:"Ошибка",text:n.message||"Не удалось добавить место",icon:"error",confirmButtonText:"OK"})}},P=async n=>{if((await c.fire({title:"Удалить место?",text:"Это действие нельзя отменить",icon:"warning",showCancelButton:!0,confirmButtonText:"Да, удалить",cancelButtonText:"Отмена"})).isConfirmed)try{const i=await O(`/wow/leaderboard-prizes/${n}`);if(!i.ok){const V=await i.json();throw new Error(V.message||"Ошибка удаления приза")}await c.fire({title:"Успешно!",text:"Место удалено",icon:"success",confirmButtonText:"OK"}),s()}catch(i){await c.fire({title:"Ошибка",text:i.message||"Не удалось удалить место",icon:"error",confirmButtonText:"OK"})}},h=async n=>{if(r.value.find(i=>i.id!==n.id&&i.rank===n.rank)){await c.fire({title:"Ошибка",text:"Место с таким номером уже существует",icon:"error",confirmButtonText:"OK"}),s();return}try{if(!(await x("/wow/leaderboard-prizes/bulk-update",{prizes:[{id:n.id,rank:n.rank,prize_amount:n.prize_amount,prize_description:n.prize_description,is_active:n.is_active}]})).ok)throw new Error("Ошибка обновления места")}catch(i){await c.fire({title:"Ошибка",text:i.message||"Не удалось обновить место",icon:"error",confirmButtonText:"OK"}),s()}};return K(()=>{s()}),{loading:g,saving:o,error:p,prizes:r,leaderboardPeriodMonths:v,showAddPrizeDialog:w,newPrize:t,fetchPrizes:s,savePrizes:y,addPrize:_,deletePrize:P,updatePrizeRank:h}}},A={class:"leaderboard-prizes-page space-y-6"},S={class:"flex items-center justify-between"},L={class:"flex gap-3"},R=["disabled"],N={key:0,class:"flex items-center justify-center py-12"},F={key:1,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},q={class:"text-destructive"},G={key:2,class:"bg-card rounded-lg border border-border p-6"},H={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},I={key:3,class:"bg-card rounded-lg border border-border p-12 text-center"},J={key:4,class:"space-y-4"},Q={class:"flex items-start justify-between mb-4"},W={class:"text-lg font-semibold"},X=["onClick"],Y={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},Z=["onUpdate:modelValue","onChange"],$=["onUpdate:modelValue"],ee=["onUpdate:modelValue"],oe={class:"mt-4 flex items-center"},re=["onUpdate:modelValue","id"],te=["for"],ne={class:"bg-card rounded-lg border border-border p-6 w-full max-w-md"},se={class:"space-y-4"},ie={class:"flex items-center"},de={class:"flex gap-3 mt-6"};function ae(g,o,p,r,v,w){return u(),a("div",A,[e("div",S,[o[10]||(o[10]=e("div",null,[e("h1",{class:"text-3xl font-semibold text-foreground"},"Призы лидерборда"),e("p",{class:"text-muted-foreground mt-1"},"Настройка призов за места в рейтинге")],-1)),e("div",L,[e("button",{onClick:o[0]||(o[0]=t=>r.showAddPrizeDialog=!0),class:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors"}," + Добавить место "),e("button",{onClick:o[1]||(o[1]=(...t)=>r.savePrizes&&r.savePrizes(...t)),disabled:r.saving,class:"px-6 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors disabled:opacity-50"},k(r.saving?"Сохранение...":"Сохранить"),9,R)])]),r.loading?(u(),a("div",N,[...o[11]||(o[11]=[e("p",{class:"text-muted-foreground"},"Загрузка призов...",-1)])])):m("",!0),r.error?(u(),a("div",F,[e("p",q,k(r.error),1)])):m("",!0),r.loading?m("",!0):(u(),a("div",G,[o[15]||(o[15]=e("h2",{class:"text-xl font-semibold mb-4"},"Настройки лидерборда",-1)),e("div",H,[e("div",null,[o[13]||(o[13]=e("label",{class:"text-sm font-medium mb-2 block"},"Период отображения",-1)),l(e("select",{"onUpdate:modelValue":o[2]||(o[2]=t=>r.leaderboardPeriodMonths=t),class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},[...o[12]||(o[12]=[e("option",{value:1},"1 месяц",-1),e("option",{value:2},"2 месяца",-1),e("option",{value:3},"3 месяца",-1),e("option",{value:4},"4 месяца",-1),e("option",{value:5},"5 месяцев",-1),e("option",{value:6},"6 месяцев",-1),e("option",{value:12},"12 месяцев",-1)])],512),[[C,r.leaderboardPeriodMonths,void 0,{number:!0}]]),o[14]||(o[14]=e("p",{class:"text-xs text-muted-foreground mt-2"}," Выберите период, за который будут учитываться рефералы в лидерборде ",-1))])])])),!r.loading&&r.prizes.length===0?(u(),a("div",I,[...o[16]||(o[16]=[e("p",{class:"text-muted-foreground mb-4"},"Призы за места не настроены",-1),e("p",{class:"text-sm text-muted-foreground"},[U(" Выполните команду: "),e("code",{class:"bg-muted px-2 py-1 rounded"},"php artisan db:seed --class=LeaderboardPrizeSeeder")],-1)])])):m("",!0),!r.loading&&r.prizes.length>0?(u(),a("div",J,[(u(!0),a(D,null,T(r.prizes,t=>(u(),a("div",{key:t.id,class:"bg-card rounded-lg border border-border p-6"},[e("div",Q,[e("h3",W,"Место "+k(t.rank),1),e("button",{onClick:s=>r.deletePrize(t.id),class:"px-4 py-2 bg-destructive text-destructive-foreground rounded-lg hover:bg-destructive/90 transition-colors text-sm"}," Удалить ",8,X)]),e("div",Y,[e("div",null,[o[17]||(o[17]=e("label",{class:"text-sm font-medium mb-2 block"},"Место",-1)),l(e("input",{"onUpdate:modelValue":s=>t.rank=s,type:"number",min:"1",class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent",onChange:s=>r.updatePrizeRank(t)},null,40,Z),[[f,t.rank,void 0,{number:!0}]])]),e("div",null,[o[18]||(o[18]=e("label",{class:"text-sm font-medium mb-2 block"},"Сумма приза (₽)",-1)),l(e("input",{"onUpdate:modelValue":s=>t.prize_amount=s,type:"number",min:"0",step:"100",class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,8,$),[[f,t.prize_amount,void 0,{number:!0}]])]),e("div",null,[o[19]||(o[19]=e("label",{class:"text-sm font-medium mb-2 block"},"Описание",-1)),l(e("input",{"onUpdate:modelValue":s=>t.prize_description=s,type:"text",placeholder:"Например: Золото",class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,8,ee),[[f,t.prize_description]])])]),e("div",oe,[l(e("input",{"onUpdate:modelValue":s=>t.is_active=s,type:"checkbox",id:`prize-active-${t.id}`,class:"w-4 h-4 border-border rounded focus:ring-2 focus:ring-accent"},null,8,re),[[z,t.is_active]]),e("label",{for:`prize-active-${t.id}`,class:"ml-2 text-sm text-muted-foreground"}," Активен ",8,te)])]))),128))])):m("",!0),r.showAddPrizeDialog?(u(),a("div",{key:5,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:o[9]||(o[9]=j(t=>r.showAddPrizeDialog=!1,["self"]))},[e("div",ne,[o[24]||(o[24]=e("h2",{class:"text-xl font-semibold mb-4"},"Добавить место",-1)),e("div",se,[e("div",null,[o[20]||(o[20]=e("label",{class:"text-sm font-medium mb-2 block"},"Место",-1)),l(e("input",{"onUpdate:modelValue":o[3]||(o[3]=t=>r.newPrize.rank=t),type:"number",min:"1",class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,512),[[f,r.newPrize.rank,void 0,{number:!0}]])]),e("div",null,[o[21]||(o[21]=e("label",{class:"text-sm font-medium mb-2 block"},"Сумма приза (₽)",-1)),l(e("input",{"onUpdate:modelValue":o[4]||(o[4]=t=>r.newPrize.prize_amount=t),type:"number",min:"0",step:"100",class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,512),[[f,r.newPrize.prize_amount,void 0,{number:!0}]])]),e("div",null,[o[22]||(o[22]=e("label",{class:"text-sm font-medium mb-2 block"},"Описание",-1)),l(e("input",{"onUpdate:modelValue":o[5]||(o[5]=t=>r.newPrize.prize_description=t),type:"text",placeholder:"Например: 1 место",class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,512),[[f,r.newPrize.prize_description]])]),e("div",ie,[l(e("input",{"onUpdate:modelValue":o[6]||(o[6]=t=>r.newPrize.is_active=t),type:"checkbox",id:"new-prize-active",class:"w-4 h-4 border-border rounded focus:ring-2 focus:ring-accent"},null,512),[[z,r.newPrize.is_active]]),o[23]||(o[23]=e("label",{for:"new-prize-active",class:"ml-2 text-sm text-muted-foreground"}," Активен ",-1))])]),e("div",de,[e("button",{onClick:o[7]||(o[7]=(...t)=>r.addPrize&&r.addPrize(...t)),class:"flex-1 px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors"}," Добавить "),e("button",{onClick:o[8]||(o[8]=t=>r.showAddPrizeDialog=!1),class:"flex-1 px-4 py-2 bg-muted text-muted-foreground rounded-lg hover:bg-muted/80 transition-colors"}," Отмена ")])])])):m("",!0)])}const be=B(E,[["render",ae]]);export{be as default};
