import{_ as K,c as i,a as e,b as c,d as g,v as k,A as W,t as r,F as z,q as F,r as l,k as N,o as a}from"./admin-DW4VoFCZ.js";import{a as R,c as D}from"./api-DccBIR6h.js";import{S as _}from"./sweetalert2.esm.all-C0u8rGqG.js";const q={name:"WowUsers",setup(){const y=l(!1),t=l(null),T=l([]),o=l(null),U=l(15),x=l({current_page:1,last_page:1,total:0,from:0,to:0}),s=l({search:"",date_from:"",date_to:""});let m=null;const b=async(d=1)=>{y.value=!0,t.value=null;try{const n={page:d,per_page:U.value};s.value.search&&(n.search=s.value.search),s.value.date_from&&(n.date_from=s.value.date_from),s.value.date_to&&(n.date_to=s.value.date_to);const u=await R("/wow/users",n);if(!u.ok)throw new Error("Ошибка загрузки пользователей");const f=await u.json();T.value=f.data||[],x.value={current_page:f.current_page||1,last_page:f.last_page||1,total:f.total||0,from:f.from||0,to:f.to||0}}catch(n){t.value=n.message||"Ошибка загрузки пользователей"}finally{y.value=!1}},B=()=>{m&&clearTimeout(m),m=setTimeout(()=>{b(1)},500)},V=d=>{b(d)},I=async d=>{try{const n=await R(`/wow/users/${d.id}`);if(!n.ok)throw new Error("Ошибка загрузки данных пользователя");const u=await n.json();o.value=u.data}catch(n){console.error("Error loading user details:",n)}},C=l(!1),w=l(null),h=l(1),j=l(!1),P=d=>{w.value=d,h.value=1,C.value=!0},S=async()=>{if(!(!w.value||h.value<1)){j.value=!0;try{const d=await D(`/wow/users/${w.value.id}/add-tickets`,{tickets:h.value});if(!d.ok){const u=await d.json();throw new Error(u.message||"Ошибка начисления билетов")}const n=await d.json();await _.fire({title:"Успешно!",text:n.message||"Билеты начислены",icon:"success",confirmButtonText:"OK"}),C.value=!1,b(x.value.current)}catch(d){await _.fire({title:"Ошибка",text:d.message||"Не удалось начислить билеты",icon:"error",confirmButtonText:"OK"})}finally{j.value=!1}}},A=l(!1),v=l(null),p=l(1),M=l(!1),E=d=>{v.value=d,p.value=1,A.value=!0},O=async()=>{if(!(!v.value||p.value<1)){if(p.value>(v.value.tickets_available||0)){await _.fire({title:"Ошибка",text:"Нельзя списать больше билетов, чем есть у пользователя",icon:"error",confirmButtonText:"OK"});return}M.value=!0;try{const d=await D(`/wow/users/${v.value.id}/remove-tickets`,{tickets:p.value});if(!d.ok){const u=await d.json();throw new Error(u.message||"Ошибка списания билетов")}const n=await d.json();await _.fire({title:"Успешно!",text:n.message||"Билеты списаны",icon:"success",confirmButtonText:"OK"}),A.value=!1,b(x.value.current)}catch(d){await _.fire({title:"Ошибка",text:d.message||"Не удалось списать билеты",icon:"error",confirmButtonText:"OK"})}finally{M.value=!1}}};return N(()=>{b()}),{loading:y,error:t,users:T,selectedUser:o,pagination:x,perPage:U,filters:s,fetchUsers:b,handleSearch:B,changePage:V,viewUser:I,showAddTicketsModal:C,addTicketsUser:w,ticketsToAdd:h,isAddingTickets:j,openAddTicketsModal:P,addTickets:S,showRemoveTicketsModal:A,removeTicketsUser:v,ticketsToRemove:p,isRemovingTickets:M,openRemoveTicketsModal:E,removeTickets:O}}},G={class:"wow-users-page space-y-6"},L={class:"bg-card rounded-lg border border-border p-4 space-y-4"},H={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},J={key:0,class:"flex items-center justify-center py-12"},Q={key:1,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},X={class:"text-destructive"},Y={key:2,class:"bg-card rounded-lg border border-border overflow-hidden"},Z={class:"overflow-x-auto"},$={class:"w-full"},ee={class:"divide-y divide-border"},te={class:"px-6 py-4 text-sm text-foreground"},oe={class:"px-6 py-4 text-sm text-foreground"},se={class:"px-6 py-4 text-sm font-medium text-foreground"},re={class:"px-6 py-4 text-sm text-foreground"},de={class:"px-2 py-1 bg-blue-500/10 text-blue-600 rounded"},ne={class:"px-6 py-4 text-sm text-foreground"},le={class:"px-6 py-4 text-sm text-foreground"},ie={class:"px-6 py-4 text-sm text-foreground"},ae={class:"px-6 py-4 text-sm text-right"},ce=["onClick"],ue=["onClick"],me=["onClick"],be={key:0,class:"px-6 py-4 border-t border-border flex items-center justify-between"},fe={class:"text-sm text-muted-foreground"},ge={class:"flex gap-2"},xe=["disabled"],ve=["disabled"],pe={key:3,class:"bg-card rounded-lg border border-border p-12 text-center"},ke={key:4,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4"},_e={class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-md"},ye={class:"p-6 border-b border-border"},we={class:"flex items-center justify-between"},he={class:"p-6 space-y-4"},Te={key:0},Ue={class:"text-sm font-medium"},Ce={class:"text-sm text-muted-foreground mt-1"},je={class:"flex items-center gap-3 pt-4"},Ae=["disabled"],Me=["disabled"],Re={key:5,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4"},De={class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-md"},Be={class:"p-6 border-b border-border"},Ve={class:"flex items-center justify-between"},Ie={class:"p-6 space-y-4"},Pe={key:0},Se={class:"text-sm font-medium"},Ee={class:"text-sm text-muted-foreground mt-1"},Oe=["max"],Ke={class:"text-xs text-muted-foreground mt-1"},We={class:"flex items-center gap-3 pt-4"},ze=["disabled"],Fe=["disabled"],Ne={key:6,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4"},qe={class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto"},Ge={class:"p-6 border-b border-border"},Le={class:"flex items-center justify-between"},He={class:"text-lg font-semibold"},Je={class:"p-6 space-y-6"},Qe={class:"grid grid-cols-2 gap-4"},Xe={class:"text-sm font-medium"},Ye={class:"text-sm font-medium"},Ze={class:"text-sm font-medium"},$e={class:"text-sm font-medium"},et={class:"text-sm font-medium"},tt={class:"text-sm font-medium"};function ot(y,t,T,o,U,x){return a(),i("div",G,[t[39]||(t[39]=e("div",{class:"flex items-center justify-between"},[e("div",null,[e("h1",{class:"text-3xl font-semibold text-foreground"},"Пользователи WOW"),e("p",{class:"text-muted-foreground mt-1"},"Управление пользователями рулетки")])],-1)),e("div",L,[e("div",H,[e("div",null,[t[19]||(t[19]=e("label",{class:"text-sm font-medium mb-1 block"},"Поиск",-1)),g(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>o.filters.search=s),type:"text",placeholder:"Username, Telegram ID...",onInput:t[1]||(t[1]=(...s)=>o.handleSearch&&o.handleSearch(...s)),class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,544),[[k,o.filters.search]])]),e("div",null,[t[20]||(t[20]=e("label",{class:"text-sm font-medium mb-1 block"},"Дата от",-1)),g(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>o.filters.date_from=s),type:"date",onChange:t[3]||(t[3]=(...s)=>o.fetchUsers&&o.fetchUsers(...s)),class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,544),[[k,o.filters.date_from]])]),e("div",null,[t[21]||(t[21]=e("label",{class:"text-sm font-medium mb-1 block"},"Дата до",-1)),g(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>o.filters.date_to=s),type:"date",onChange:t[5]||(t[5]=(...s)=>o.fetchUsers&&o.fetchUsers(...s)),class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,544),[[k,o.filters.date_to]])]),e("div",null,[t[23]||(t[23]=e("label",{class:"text-sm font-medium mb-1 block"},"На странице",-1)),g(e("select",{"onUpdate:modelValue":t[6]||(t[6]=s=>o.perPage=s),onChange:t[7]||(t[7]=(...s)=>o.fetchUsers&&o.fetchUsers(...s)),class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},[...t[22]||(t[22]=[e("option",{value:15},"15",-1),e("option",{value:25},"25",-1),e("option",{value:50},"50",-1),e("option",{value:100},"100",-1)])],544),[[W,o.perPage]])])])]),o.loading?(a(),i("div",J,[...t[24]||(t[24]=[e("p",{class:"text-muted-foreground"},"Загрузка пользователей...",-1)])])):c("",!0),o.error?(a(),i("div",Q,[e("p",X,r(o.error),1)])):c("",!0),!o.loading&&o.users.length>0?(a(),i("div",Y,[e("div",Z,[e("table",$,[t[25]||(t[25]=e("thead",{class:"bg-muted/30 border-b border-border"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase"},"ID"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase"},"Telegram ID"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase"},"Username"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase"},"Билеты"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase"},"Прокруты"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase"},"Выигрыши"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase"},"Приглашения"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-muted-foreground uppercase"},"Действия")])],-1)),e("tbody",ee,[(a(!0),i(z,null,F(o.users,s=>(a(),i("tr",{key:s.id,class:"hover:bg-muted/10"},[e("td",te,r(s.id),1),e("td",oe,r(s.telegram_id),1),e("td",se,r(s.username||"—"),1),e("td",re,[e("span",de,r(s.tickets_available||0)+"/3 ",1)]),e("td",ne,r(s.spins_count||0),1),e("td",le,r(s.total_wins||0),1),e("td",ie,r(s.invites_count||0),1),e("td",ae,[e("button",{onClick:m=>o.openAddTicketsModal(s),class:"mr-2 px-3 py-1 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors",title:"Начислить билеты"}," + ",8,ce),e("button",{onClick:m=>o.openRemoveTicketsModal(s),class:"mr-2 px-3 py-1 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors",title:"Списать билеты"}," − ",8,ue),e("button",{onClick:m=>o.viewUser(s),class:"px-3 py-1 text-xs bg-blue-500 hover:bg-blue-600 text-white rounded transition-colors"}," Подробнее ",8,me)])]))),128))])])]),o.pagination.last_page>1?(a(),i("div",be,[e("div",fe," Показано "+r(o.pagination.from)+" - "+r(o.pagination.to)+" из "+r(o.pagination.total),1),e("div",ge,[e("button",{onClick:t[8]||(t[8]=s=>o.changePage(o.pagination.current_page-1)),disabled:o.pagination.current_page===1,class:"px-4 py-2 text-sm border border-border rounded-lg hover:bg-muted/10 disabled:opacity-50 disabled:cursor-not-allowed"}," Назад ",8,xe),e("button",{onClick:t[9]||(t[9]=s=>o.changePage(o.pagination.current_page+1)),disabled:o.pagination.current_page===o.pagination.last_page,class:"px-4 py-2 text-sm border border-border rounded-lg hover:bg-muted/10 disabled:opacity-50 disabled:cursor-not-allowed"}," Вперед ",8,ve)])])):c("",!0)])):c("",!0),!o.loading&&o.users.length===0?(a(),i("div",pe,[...t[26]||(t[26]=[e("p",{class:"text-muted-foreground"},"Пользователи не найдены",-1)])])):c("",!0),o.showAddTicketsModal?(a(),i("div",ke,[e("div",_e,[e("div",ye,[e("div",we,[t[27]||(t[27]=e("h3",{class:"text-lg font-semibold"},"Начислить билеты",-1)),e("button",{onClick:t[10]||(t[10]=s=>o.showAddTicketsModal=!1),class:"text-muted-foreground hover:text-foreground"}," ✕ ")])]),e("div",he,[o.addTicketsUser?(a(),i("div",Te,[t[28]||(t[28]=e("p",{class:"text-sm text-muted-foreground mb-2"},"Пользователь:",-1)),e("p",Ue,r(o.addTicketsUser.username||`Telegram ID: ${o.addTicketsUser.telegram_id}`),1),e("p",Ce,"Текущее количество билетов: "+r(o.addTicketsUser.tickets_available||0),1)])):c("",!0),e("div",null,[t[29]||(t[29]=e("label",{class:"text-sm font-medium mb-1 block"},"Количество билетов",-1)),g(e("input",{"onUpdate:modelValue":t[11]||(t[11]=s=>o.ticketsToAdd=s),type:"number",min:"1",max:"100",class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,512),[[k,o.ticketsToAdd,void 0,{number:!0}]])]),e("div",je,[e("button",{onClick:t[12]||(t[12]=(...s)=>o.addTickets&&o.addTickets(...s)),disabled:o.isAddingTickets||o.ticketsToAdd<1,class:"flex-1 px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},r(o.isAddingTickets?"Начисление...":"Начислить"),9,Ae),e("button",{onClick:t[13]||(t[13]=s=>o.showAddTicketsModal=!1),disabled:o.isAddingTickets,class:"flex-1 px-4 py-2 border border-border rounded-lg hover:bg-muted/10 transition-colors disabled:opacity-50"}," Отмена ",8,Me)])])])])):c("",!0),o.showRemoveTicketsModal?(a(),i("div",Re,[e("div",De,[e("div",Be,[e("div",Ve,[t[30]||(t[30]=e("h3",{class:"text-lg font-semibold"},"Списать билеты",-1)),e("button",{onClick:t[14]||(t[14]=s=>o.showRemoveTicketsModal=!1),class:"text-muted-foreground hover:text-foreground"}," ✕ ")])]),e("div",Ie,[o.removeTicketsUser?(a(),i("div",Pe,[t[31]||(t[31]=e("p",{class:"text-sm text-muted-foreground mb-2"},"Пользователь:",-1)),e("p",Se,r(o.removeTicketsUser.username||`Telegram ID: ${o.removeTicketsUser.telegram_id}`),1),e("p",Ee,"Текущее количество билетов: "+r(o.removeTicketsUser.tickets_available||0),1)])):c("",!0),e("div",null,[t[32]||(t[32]=e("label",{class:"text-sm font-medium mb-1 block"},"Количество билетов для списания",-1)),g(e("input",{"onUpdate:modelValue":t[15]||(t[15]=s=>o.ticketsToRemove=s),type:"number",min:"1",max:o.removeTicketsUser?.tickets_available||0,class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,8,Oe),[[k,o.ticketsToRemove,void 0,{number:!0}]]),e("p",Ke," Можно списать не более "+r(o.removeTicketsUser?.tickets_available||0)+" билет(ов) ",1)]),e("div",We,[e("button",{onClick:t[16]||(t[16]=(...s)=>o.removeTickets&&o.removeTickets(...s)),disabled:o.isRemovingTickets||o.ticketsToRemove<1||o.ticketsToRemove>(o.removeTicketsUser?.tickets_available||0),class:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},r(o.isRemovingTickets?"Списание...":"Списать"),9,ze),e("button",{onClick:t[17]||(t[17]=s=>o.showRemoveTicketsModal=!1),disabled:o.isRemovingTickets,class:"flex-1 px-4 py-2 border border-border rounded-lg hover:bg-muted/10 transition-colors disabled:opacity-50"}," Отмена ",8,Fe)])])])])):c("",!0),o.selectedUser?(a(),i("div",Ne,[e("div",qe,[e("div",Ge,[e("div",Le,[e("h3",He,"Пользователь #"+r(o.selectedUser.id),1),e("button",{onClick:t[18]||(t[18]=s=>o.selectedUser=null),class:"text-muted-foreground hover:text-foreground"}," ✕ ")])]),e("div",Je,[e("div",Qe,[e("div",null,[t[33]||(t[33]=e("p",{class:"text-sm text-muted-foreground"},"Telegram ID",-1)),e("p",Xe,r(o.selectedUser.telegram_id),1)]),e("div",null,[t[34]||(t[34]=e("p",{class:"text-sm text-muted-foreground"},"Username",-1)),e("p",Ye,r(o.selectedUser.username||"—"),1)]),e("div",null,[t[35]||(t[35]=e("p",{class:"text-sm text-muted-foreground"},"Билеты",-1)),e("p",Ze,r(o.selectedUser.tickets_available||0)+"/3",1)]),e("div",null,[t[36]||(t[36]=e("p",{class:"text-sm text-muted-foreground"},"Звёзды",-1)),e("p",$e,r(o.selectedUser.stars_balance||0),1)]),e("div",null,[t[37]||(t[37]=e("p",{class:"text-sm text-muted-foreground"},"Всего прокрутов",-1)),e("p",et,r(o.selectedUser.spins_count||0),1)]),e("div",null,[t[38]||(t[38]=e("p",{class:"text-sm text-muted-foreground"},"Выигрышей",-1)),e("p",tt,r(o.selectedUser.total_wins||0),1)])])])])])):c("",!0)])}const nt=K(q,[["render",ot]]);export{nt as default};
