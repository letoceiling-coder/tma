import{_ as B,c as n,a as e,b,t as d,F as M,q as R,w as j,d as p,v as w,r as i,k as E,o as l}from"./admin-CVJgAGJK.js";import{a as D,b as S,c as T,d as V}from"./api-DccBIR6h.js";import{S as g}from"./sweetalert2.esm.all-C0u8rGqG.js";const q={name:"Roles",setup(){const x=i(!1),t=i(!1),c=i(null),o=i([]),v=i(!1),u=i(!1),s=i({id:null,name:"",slug:"",description:""}),f=async()=>{x.value=!0,c.value=null;try{const r=await D("/roles");if(!r.ok)throw new Error("Ошибка загрузки ролей");const a=await r.json();o.value=a.data||[]}catch(r){c.value=r.message||"Ошибка загрузки ролей"}finally{x.value=!1}},y=r=>{s.value={id:r.id,name:r.name,slug:r.slug,description:r.description||""},u.value=!0},k=async r=>{if((await g.fire({title:"Удалить роль?",html:`Вы уверены, что хотите удалить роль <strong>"${r.name}"</strong>?`,icon:"warning",showCancelButton:!0,confirmButtonText:"Да, удалить",cancelButtonText:"Отмена",confirmButtonColor:"#dc2626",cancelButtonColor:"#6b7280"})).isConfirmed)try{const m=await V(`/roles/${r.id}`);if(!m.ok){const C=await m.json();throw new Error(C.message||"Ошибка удаления роли")}await g.fire({title:"Роль удалена",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),await f()}catch(m){g.fire({title:"Ошибка",text:m.message||"Ошибка удаления роли",icon:"error",confirmButtonText:"ОК"})}},_=async()=>{t.value=!0,c.value=null;try{const r={name:s.value.name,slug:s.value.slug.toLowerCase().replace(/\s+/g,"-"),description:s.value.description};let a;if(u.value?a=await S(`/roles/${s.value.id}`,r):a=await T("/roles",r),!a.ok){const m=await a.json();throw new Error(m.message||"Ошибка сохранения роли")}await g.fire({title:u.value?"Роль обновлена":"Роль создана",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),h(),await f()}catch(r){c.value=r.message||"Ошибка сохранения роли",g.fire({title:"Ошибка",text:r.message||"Ошибка сохранения роли",icon:"error",confirmButtonText:"ОК"})}finally{t.value=!1}},h=()=>{v.value=!1,u.value=!1,s.value={id:null,name:"",slug:"",description:""}};return E(()=>{f()}),{loading:x,saving:t,error:c,roles:o,showCreateModal:v,showEditModal:u,form:s,editRole:y,deleteRole:k,saveRole:_,closeModal:h}}},U={class:"roles-page space-y-6"},z={class:"flex items-center justify-between"},F={key:0,class:"flex items-center justify-center py-12"},L={key:1,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},N={class:"text-destructive"},P={key:2,class:"grid gap-4 md:grid-cols-2 lg:grid-cols-3"},G={class:"flex items-start justify-between mb-4"},A={class:"text-lg font-semibold text-foreground"},H={class:"text-sm text-muted-foreground mt-1"},I={class:"flex gap-2"},J=["onClick"],K=["onClick"],O={key:0,class:"text-sm text-muted-foreground mb-4"},Q={class:"flex items-center gap-2 text-xs text-muted-foreground"},W={class:"font-medium"},X={key:3,class:"bg-card rounded-lg border border-border p-12 text-center"},Y={key:4,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm"},Z={class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-md p-6"},$={class:"text-lg font-semibold mb-4"},ee={class:"flex gap-2 pt-4"},te=["disabled"];function oe(x,t,c,o,v,u){return l(),n("div",U,[e("div",z,[t[7]||(t[7]=e("div",null,[e("h1",{class:"text-3xl font-semibold text-foreground"},"Роли"),e("p",{class:"text-muted-foreground mt-1"},"Управление ролями системы")],-1)),e("button",{onClick:t[0]||(t[0]=s=>o.showCreateModal=!0),class:"h-11 px-6 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-2xl shadow-lg shadow-accent/10 inline-flex items-center justify-center gap-2"},[...t[6]||(t[6]=[e("span",null,"+",-1),e("span",null,"Создать роль",-1)])])]),o.loading?(l(),n("div",F,[...t[8]||(t[8]=[e("p",{class:"text-muted-foreground"},"Загрузка ролей...",-1)])])):b("",!0),o.error?(l(),n("div",L,[e("p",N,d(o.error),1)])):b("",!0),!o.loading&&o.roles.length>0?(l(),n("div",P,[(l(!0),n(M,null,R(o.roles,s=>(l(),n("div",{key:s.id,class:"bg-card rounded-lg border border-border p-6 hover:shadow-md transition-shadow"},[e("div",G,[e("div",null,[e("h3",A,d(s.name),1),e("p",H,d(s.slug),1)]),e("div",I,[e("button",{onClick:f=>o.editRole(s),class:"px-3 py-1 text-xs bg-blue-500 hover:bg-blue-600 text-white rounded transition-colors"}," Редактировать ",8,J),e("button",{onClick:f=>o.deleteRole(s),class:"px-3 py-1 text-xs bg-red-500 hover:bg-red-600 text-white rounded transition-colors"}," Удалить ",8,K)])]),s.description?(l(),n("p",O,d(s.description),1)):b("",!0),e("div",Q,[t[9]||(t[9]=e("span",null,"Пользователей:",-1)),e("span",W,d(s.users?.length||0),1)])]))),128))])):b("",!0),!o.loading&&o.roles.length===0?(l(),n("div",X,[...t[10]||(t[10]=[e("p",{class:"text-muted-foreground"},"Роли не найдены",-1)])])):b("",!0),o.showCreateModal||o.showEditModal?(l(),n("div",Y,[e("div",Z,[e("h3",$,d(o.showEditModal?"Редактировать роль":"Создать роль"),1),e("form",{onSubmit:t[5]||(t[5]=j((...s)=>o.saveRole&&o.saveRole(...s),["prevent"])),class:"space-y-4"},[e("div",null,[t[11]||(t[11]=e("label",{class:"text-sm font-medium mb-1 block"},"Название",-1)),p(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>o.form.name=s),type:"text",required:"",class:"w-full h-10 px-3 border border-border rounded bg-background"},null,512),[[w,o.form.name]])]),e("div",null,[t[12]||(t[12]=e("label",{class:"text-sm font-medium mb-1 block"},"Slug",-1)),p(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>o.form.slug=s),type:"text",required:"",pattern:"[a-z0-9-]+",class:"w-full h-10 px-3 border border-border rounded bg-background"},null,512),[[w,o.form.slug]]),t[13]||(t[13]=e("p",{class:"text-xs text-muted-foreground mt-1"},"Только строчные буквы, цифры и дефисы",-1))]),e("div",null,[t[14]||(t[14]=e("label",{class:"text-sm font-medium mb-1 block"},"Описание",-1)),p(e("textarea",{"onUpdate:modelValue":t[3]||(t[3]=s=>o.form.description=s),rows:"3",class:"w-full px-3 py-2 border border-border rounded bg-background"},null,512),[[w,o.form.description]])]),e("div",ee,[e("button",{type:"button",onClick:t[4]||(t[4]=(...s)=>o.closeModal&&o.closeModal(...s)),class:"flex-1 h-10 px-4 border border-border bg-background/50 hover:bg-accent/10 rounded-lg transition-colors"}," Отмена "),e("button",{type:"submit",disabled:o.saving,class:"flex-1 h-10 px-4 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-lg transition-colors disabled:opacity-50"},d(o.saving?"Сохранение...":"Сохранить"),9,te)])],32)])])):b("",!0)])}const le=B(q,[["render",oe]]);export{le as default};
