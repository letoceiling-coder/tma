import{_ as S,c as l,a as e,b as c,d as x,v as y,A as V,t as r,F as I,q as B,r as a,k as E,o as i}from"./admin-BSQCa9Dd.js";import{a as T,c as W}from"./api-DccBIR6h.js";import{S as A}from"./sweetalert2.esm.all-C0u8rGqG.js";const O={name:"WowUsers",setup(){const b=a(!1),t=a(null),k=a([]),o=a(null),h=a(15),p=a({current_page:1,last_page:1,total:0,from:0,to:0}),s=a({search:"",date_from:"",date_to:""});let g=null;const f=async(d=1)=>{b.value=!0,t.value=null;try{const n={page:d,per_page:h.value};s.value.search&&(n.search=s.value.search),s.value.date_from&&(n.date_from=s.value.date_from),s.value.date_to&&(n.date_to=s.value.date_to);const u=await T("/wow/users",n);if(!u.ok)throw new Error("Ошибка загрузки пользователей");const m=await u.json();k.value=m.data||[],p.value={current_page:m.current_page||1,last_page:m.last_page||1,total:m.total||0,from:m.from||0,to:m.to||0}}catch(n){t.value=n.message||"Ошибка загрузки пользователей"}finally{b.value=!1}},C=()=>{g&&clearTimeout(g),g=setTimeout(()=>{f(1)},500)},j=d=>{f(d)},M=async d=>{try{const n=await T(`/wow/users/${d.id}`);if(!n.ok)throw new Error("Ошибка загрузки данных пользователя");const u=await n.json();o.value=u.data}catch(n){console.error("Error loading user details:",n)}},w=a(!1),v=a(null),_=a(1),U=a(!1),D=d=>{v.value=d,_.value=1,w.value=!0},P=async()=>{if(!(!v.value||_.value<1)){U.value=!0;try{const d=await W(`/wow/users/${v.value.id}/add-tickets`,{tickets:_.value});if(!d.ok){const u=await d.json();throw new Error(u.message||"Ошибка начисления билетов")}const n=await d.json();await A.fire({title:"Успешно!",text:n.message||"Билеты начислены",icon:"success",confirmButtonText:"OK"}),w.value=!1,f(p.value.current)}catch(d){await A.fire({title:"Ошибка",text:d.message||"Не удалось начислить билеты",icon:"error",confirmButtonText:"OK"})}finally{U.value=!1}}};return E(()=>{f()}),{loading:b,error:t,users:k,selectedUser:o,pagination:p,perPage:h,filters:s,fetchUsers:f,handleSearch:C,changePage:j,viewUser:M,showAddTicketsModal:w,addTicketsUser:v,ticketsToAdd:_,isAddingTickets:U,openAddTicketsModal:D,addTickets:P}}},z={class:"wow-users-page space-y-6"},F={class:"bg-card rounded-lg border border-border p-4 space-y-4"},K={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},N={key:0,class:"flex items-center justify-center py-12"},q={key:1,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},G={class:"text-destructive"},L={key:2,class:"bg-card rounded-lg border border-border overflow-hidden"},H={class:"overflow-x-auto"},J={class:"w-full"},Q={class:"divide-y divide-border"},R={class:"px-6 py-4 text-sm text-foreground"},X={class:"px-6 py-4 text-sm text-foreground"},Y={class:"px-6 py-4 text-sm font-medium text-foreground"},Z={class:"px-6 py-4 text-sm text-foreground"},$={class:"px-2 py-1 bg-blue-500/10 text-blue-600 rounded"},ee={class:"px-6 py-4 text-sm text-foreground"},te={class:"px-6 py-4 text-sm text-foreground"},oe={class:"px-6 py-4 text-sm text-foreground"},se={class:"px-6 py-4 text-sm text-right"},re=["onClick"],de=["onClick"],ne={key:0,class:"px-6 py-4 border-t border-border flex items-center justify-between"},le={class:"text-sm text-muted-foreground"},ae={class:"flex gap-2"},ie=["disabled"],ce=["disabled"],ue={key:3,class:"bg-card rounded-lg border border-border p-12 text-center"},me={key:4,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4"},ge={class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-md"},fe={class:"p-6 border-b border-border"},xe={class:"flex items-center justify-between"},be={class:"p-6 space-y-4"},pe={key:0},ve={class:"text-sm font-medium"},_e={class:"flex items-center gap-3 pt-4"},ye=["disabled"],ke=["disabled"],he={key:5,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4"},we={class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto"},Ue={class:"p-6 border-b border-border"},Te={class:"flex items-center justify-between"},Ae={class:"text-lg font-semibold"},Ce={class:"p-6 space-y-6"},je={class:"grid grid-cols-2 gap-4"},Me={class:"text-sm font-medium"},De={class:"text-sm font-medium"},Pe={class:"text-sm font-medium"},Se={class:"text-sm font-medium"},Ve={class:"text-sm font-medium"},Ie={class:"text-sm font-medium"};function Be(b,t,k,o,h,p){return i(),l("div",z,[t[32]||(t[32]=e("div",{class:"flex items-center justify-between"},[e("div",null,[e("h1",{class:"text-3xl font-semibold text-foreground"},"Пользователи WOW"),e("p",{class:"text-muted-foreground mt-1"},"Управление пользователями рулетки")])],-1)),e("div",F,[e("div",K,[e("div",null,[t[15]||(t[15]=e("label",{class:"text-sm font-medium mb-1 block"},"Поиск",-1)),x(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>o.filters.search=s),type:"text",placeholder:"Username, Telegram ID...",onInput:t[1]||(t[1]=(...s)=>o.handleSearch&&o.handleSearch(...s)),class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,544),[[y,o.filters.search]])]),e("div",null,[t[16]||(t[16]=e("label",{class:"text-sm font-medium mb-1 block"},"Дата от",-1)),x(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>o.filters.date_from=s),type:"date",onChange:t[3]||(t[3]=(...s)=>o.fetchUsers&&o.fetchUsers(...s)),class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,544),[[y,o.filters.date_from]])]),e("div",null,[t[17]||(t[17]=e("label",{class:"text-sm font-medium mb-1 block"},"Дата до",-1)),x(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>o.filters.date_to=s),type:"date",onChange:t[5]||(t[5]=(...s)=>o.fetchUsers&&o.fetchUsers(...s)),class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,544),[[y,o.filters.date_to]])]),e("div",null,[t[19]||(t[19]=e("label",{class:"text-sm font-medium mb-1 block"},"На странице",-1)),x(e("select",{"onUpdate:modelValue":t[6]||(t[6]=s=>o.perPage=s),onChange:t[7]||(t[7]=(...s)=>o.fetchUsers&&o.fetchUsers(...s)),class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},[...t[18]||(t[18]=[e("option",{value:15},"15",-1),e("option",{value:25},"25",-1),e("option",{value:50},"50",-1),e("option",{value:100},"100",-1)])],544),[[V,o.perPage]])])])]),o.loading?(i(),l("div",N,[...t[20]||(t[20]=[e("p",{class:"text-muted-foreground"},"Загрузка пользователей...",-1)])])):c("",!0),o.error?(i(),l("div",q,[e("p",G,r(o.error),1)])):c("",!0),!o.loading&&o.users.length>0?(i(),l("div",L,[e("div",H,[e("table",J,[t[21]||(t[21]=e("thead",{class:"bg-muted/30 border-b border-border"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase"},"ID"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase"},"Telegram ID"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase"},"Username"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase"},"Билеты"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase"},"Прокруты"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase"},"Выигрыши"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase"},"Приглашения"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-muted-foreground uppercase"},"Действия")])],-1)),e("tbody",Q,[(i(!0),l(I,null,B(o.users,s=>(i(),l("tr",{key:s.id,class:"hover:bg-muted/10"},[e("td",R,r(s.id),1),e("td",X,r(s.telegram_id),1),e("td",Y,r(s.username||"—"),1),e("td",Z,[e("span",$,r(s.tickets_available||0)+"/3 ",1)]),e("td",ee,r(s.spins_count||0),1),e("td",te,r(s.total_wins||0),1),e("td",oe,r(s.invites_count||0),1),e("td",se,[e("button",{onClick:g=>o.openAddTicketsModal(s),class:"mr-2 px-3 py-1 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors",title:"Начислить билеты"}," + ",8,re),e("button",{onClick:g=>o.viewUser(s),class:"px-3 py-1 text-xs bg-blue-500 hover:bg-blue-600 text-white rounded transition-colors"}," Подробнее ",8,de)])]))),128))])])]),o.pagination.last_page>1?(i(),l("div",ne,[e("div",le," Показано "+r(o.pagination.from)+" - "+r(o.pagination.to)+" из "+r(o.pagination.total),1),e("div",ae,[e("button",{onClick:t[8]||(t[8]=s=>o.changePage(o.pagination.current_page-1)),disabled:o.pagination.current_page===1,class:"px-4 py-2 text-sm border border-border rounded-lg hover:bg-muted/10 disabled:opacity-50 disabled:cursor-not-allowed"}," Назад ",8,ie),e("button",{onClick:t[9]||(t[9]=s=>o.changePage(o.pagination.current_page+1)),disabled:o.pagination.current_page===o.pagination.last_page,class:"px-4 py-2 text-sm border border-border rounded-lg hover:bg-muted/10 disabled:opacity-50 disabled:cursor-not-allowed"}," Вперед ",8,ce)])])):c("",!0)])):c("",!0),!o.loading&&o.users.length===0?(i(),l("div",ue,[...t[22]||(t[22]=[e("p",{class:"text-muted-foreground"},"Пользователи не найдены",-1)])])):c("",!0),o.showAddTicketsModal?(i(),l("div",me,[e("div",ge,[e("div",fe,[e("div",xe,[t[23]||(t[23]=e("h3",{class:"text-lg font-semibold"},"Начислить билеты",-1)),e("button",{onClick:t[10]||(t[10]=s=>o.showAddTicketsModal=!1),class:"text-muted-foreground hover:text-foreground"}," ✕ ")])]),e("div",be,[o.addTicketsUser?(i(),l("div",pe,[t[24]||(t[24]=e("p",{class:"text-sm text-muted-foreground mb-2"},"Пользователь:",-1)),e("p",ve,r(o.addTicketsUser.username||`Telegram ID: ${o.addTicketsUser.telegram_id}`),1)])):c("",!0),e("div",null,[t[25]||(t[25]=e("label",{class:"text-sm font-medium mb-1 block"},"Количество билетов",-1)),x(e("input",{"onUpdate:modelValue":t[11]||(t[11]=s=>o.ticketsToAdd=s),type:"number",min:"1",max:"100",class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,512),[[y,o.ticketsToAdd,void 0,{number:!0}]])]),e("div",_e,[e("button",{onClick:t[12]||(t[12]=(...s)=>o.addTickets&&o.addTickets(...s)),disabled:o.isAddingTickets||o.ticketsToAdd<1,class:"flex-1 px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},r(o.isAddingTickets?"Начисление...":"Начислить"),9,ye),e("button",{onClick:t[13]||(t[13]=s=>o.showAddTicketsModal=!1),disabled:o.isAddingTickets,class:"flex-1 px-4 py-2 border border-border rounded-lg hover:bg-muted/10 transition-colors disabled:opacity-50"}," Отмена ",8,ke)])])])])):c("",!0),o.selectedUser?(i(),l("div",he,[e("div",we,[e("div",Ue,[e("div",Te,[e("h3",Ae,"Пользователь #"+r(o.selectedUser.id),1),e("button",{onClick:t[14]||(t[14]=s=>o.selectedUser=null),class:"text-muted-foreground hover:text-foreground"}," ✕ ")])]),e("div",Ce,[e("div",je,[e("div",null,[t[26]||(t[26]=e("p",{class:"text-sm text-muted-foreground"},"Telegram ID",-1)),e("p",Me,r(o.selectedUser.telegram_id),1)]),e("div",null,[t[27]||(t[27]=e("p",{class:"text-sm text-muted-foreground"},"Username",-1)),e("p",De,r(o.selectedUser.username||"—"),1)]),e("div",null,[t[28]||(t[28]=e("p",{class:"text-sm text-muted-foreground"},"Билеты",-1)),e("p",Pe,r(o.selectedUser.tickets_available||0)+"/3",1)]),e("div",null,[t[29]||(t[29]=e("p",{class:"text-sm text-muted-foreground"},"Звёзды",-1)),e("p",Se,r(o.selectedUser.stars_balance||0),1)]),e("div",null,[t[30]||(t[30]=e("p",{class:"text-sm text-muted-foreground"},"Всего прокрутов",-1)),e("p",Ve,r(o.selectedUser.spins_count||0),1)]),e("div",null,[t[31]||(t[31]=e("p",{class:"text-sm text-muted-foreground"},"Выигрышей",-1)),e("p",Ie,r(o.selectedUser.total_wins||0),1)])])])])])):c("",!0)])}const ze=S(O,[["render",Be]]);export{ze as default};
