import{_ as V,c as s,a as e,b as u,p as z,e as h,t as f,F as U,q as S,r as g,m as w,k as j,o as n,d as p,L as E,G as B,v as y,H as F}from"./admin-BCbIefQp.js";import{c as C,b as M}from"./api-BACpyIk9.js";import{S as x}from"./sweetalert2.esm.all-C0u8rGqG.js";const D={name:"Wheel",setup(){const b=g(!1),t=g(!1),c=g(null),l=g([]),_=w(()=>l.value.reduce((a,d)=>a+(parseFloat(d.probability_percent)||0),0)),v=w(()=>Math.abs(_.value-100)<.01),o=async()=>{b.value=!0,c.value=null;try{const a=await C("/wow/wheel");if(!a.ok)throw new Error("Ошибка загрузки секторов");const d=await a.json();l.value=(d.data||[]).map(m=>({...m,probability_percent:parseFloat(m.probability_percent)||0,prize_value:m.prize_value||0}))}catch(a){c.value=a.message||"Ошибка загрузки секторов"}finally{b.value=!1}},r=async()=>{if(!v.value){await x.fire({title:"Ошибка",text:"Сумма вероятностей должна быть равна 100%",icon:"error",confirmButtonText:"ОК"});return}t.value=!0,c.value=null;try{const a=l.value.map(i=>({id:i.id,prize_type:i.prize_type,prize_value:i.prize_value||0,icon_url:i.icon_url||null,probability_percent:parseFloat(i.probability_percent)||0,is_active:i.is_active!==!1})),d=await M("/wow/wheel/bulk-update",{sectors:a});if(!d.ok){const i=await d.json();throw new Error(i.message||"Ошибка сохранения секторов")}const m=await d.json();await x.fire({title:"Секторы сохранены",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),await o()}catch(a){c.value=a.message||"Ошибка сохранения секторов",await x.fire({title:"Ошибка",text:a.message||"Ошибка сохранения секторов",icon:"error",confirmButtonText:"ОК"})}finally{t.value=!1}},k=a=>{a.target.style.display="none"};return j(()=>{o()}),{loading:b,saving:t,error:c,sectors:l,totalProbability:_,probabilityValid:v,saveAllSectors:r,handleImageError:k}}},T={class:"wheel-page space-y-6"},A={class:"flex items-center justify-between"},I={class:"flex items-center gap-4"},L={key:0,class:"ml-2"},N=["disabled"],P={key:0,class:"flex items-center justify-center py-12"},G={key:1,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},W={class:"text-destructive"},q={key:2,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},H={class:"flex items-center justify-between"},R={class:"text-lg font-semibold"},J={class:"flex items-center gap-2 cursor-pointer"},K=["onUpdate:modelValue"],O=["onUpdate:modelValue"],Q={key:0},X=["onUpdate:modelValue"],Y=["onUpdate:modelValue"],Z={class:"mt-1 h-2 bg-muted rounded-full overflow-hidden"},$=["onUpdate:modelValue"],ee={key:0,class:"mt-2"},te=["src","alt"];function oe(b,t,c,l,_,v){return n(),s("div",T,[e("div",A,[t[2]||(t[2]=e("div",null,[e("h1",{class:"text-3xl font-semibold text-foreground"},"Редактор рулетки"),e("p",{class:"text-muted-foreground mt-1"},"Настройка секторов рулетки и вероятностей выпадения")],-1)),e("div",I,[e("div",{class:z(["px-4 py-2 rounded-lg text-sm font-medium",l.probabilityValid?"bg-green-500/10 text-green-600":"bg-red-500/10 text-red-600"])},[h(" Вероятность: "+f(l.totalProbability.toFixed(2))+"% ",1),l.probabilityValid?u("",!0):(n(),s("span",L,"(должно быть 100%)"))],2),e("button",{onClick:t[0]||(t[0]=(...o)=>l.saveAllSectors&&l.saveAllSectors(...o)),disabled:!l.probabilityValid||l.saving,class:"h-11 px-6 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-2xl shadow-lg shadow-accent/10 inline-flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"},[e("span",null,f(l.saving?"Сохранение...":"Сохранить все"),1)],8,N)])]),l.loading?(n(),s("div",P,[...t[3]||(t[3]=[e("p",{class:"text-muted-foreground"},"Загрузка секторов...",-1)])])):u("",!0),l.error?(n(),s("div",G,[e("p",W,f(l.error),1)])):u("",!0),l.loading?u("",!0):(n(),s("div",q,[(n(!0),s(U,null,S(l.sectors,o=>(n(),s("div",{key:o.id,class:"bg-card rounded-lg border border-border p-6 space-y-4"},[e("div",H,[e("h3",R,"Сектор #"+f(o.sector_number),1),e("label",J,[p(e("input",{"onUpdate:modelValue":r=>o.is_active=r,type:"checkbox",class:"w-4 h-4"},null,8,K),[[E,o.is_active]]),t[4]||(t[4]=e("span",{class:"text-sm"},"Активен",-1))])]),e("div",null,[t[6]||(t[6]=e("label",{class:"text-sm font-medium mb-1 block"},"Тип приза",-1)),p(e("select",{"onUpdate:modelValue":r=>o.prize_type=r,class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},[...t[5]||(t[5]=[e("option",{value:"empty"},"Пусто",-1),e("option",{value:"money"},"Деньги",-1),e("option",{value:"ticket"},"Билет",-1),e("option",{value:"secret_box"},"Секретный бокс",-1)])],8,O),[[B,o.prize_type]])]),o.prize_type==="money"?(n(),s("div",Q,[t[7]||(t[7]=e("label",{class:"text-sm font-medium mb-1 block"},"Сумма (₽)",-1)),p(e("input",{"onUpdate:modelValue":r=>o.prize_value=r,type:"number",min:"0",placeholder:"300",class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,8,X),[[y,o.prize_value,void 0,{number:!0}]])])):u("",!0),e("div",null,[t[8]||(t[8]=e("label",{class:"text-sm font-medium mb-1 block"},[h(" Вероятность (%) "),e("span",{class:"text-xs text-muted-foreground"},"(0-100)")],-1)),p(e("input",{"onUpdate:modelValue":r=>o.probability_percent=r,type:"number",min:"0",max:"100",step:"0.01",placeholder:"0.00",class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,8,Y),[[y,o.probability_percent,void 0,{number:!0}]]),e("div",Z,[e("div",{class:"h-full bg-accent transition-all",style:F({width:`${o.probability_percent}%`})},null,4)])]),e("div",null,[t[9]||(t[9]=e("label",{class:"text-sm font-medium mb-1 block"},"URL иконки",-1)),p(e("input",{"onUpdate:modelValue":r=>o.icon_url=r,type:"text",placeholder:"https://...",class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,8,$),[[y,o.icon_url]]),o.icon_url?(n(),s("div",ee,[e("img",{src:o.icon_url,alt:`Сектор ${o.sector_number}`,class:"w-16 h-16 object-contain rounded",onError:t[1]||(t[1]=(...r)=>l.handleImageError&&l.handleImageError(...r))},null,40,te)])):u("",!0)])]))),128))]))])}const se=V(D,[["render",oe]]);export{se as default};
