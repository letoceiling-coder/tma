import{_ as M,c as l,a as e,b as f,t as a,F as B,q as j,w as D,d as b,v,D as E,r as u,k as U,o as n,p as V}from"./admin-CtYMnxVR.js";import{a as T,b as S,c as q,d as z}from"./api-DccBIR6h.js";import{S as p}from"./sweetalert2.esm.all-C0u8rGqG.js";const F={name:"Channels",setup(){const g=u(!1),t=u(!1),i=u(null),r=u([]),y=u(!1),c=u(!1),o=u({id:null,username:"",title:"",external_url:"",priority:0,is_active:!0}),x=async()=>{g.value=!0,i.value=null;try{const s=await T("/wow/channels");if(!s.ok)throw new Error("Ошибка загрузки каналов");const d=await s.json();r.value=d.data||[]}catch(s){i.value=s.message||"Ошибка загрузки каналов"}finally{g.value=!1}},h=s=>{o.value={id:s.id,username:s.username,title:s.title,external_url:s.external_url||"",priority:s.priority,is_active:s.is_active},c.value=!0},_=async s=>{if((await p.fire({title:"Удалить канал?",html:`Вы уверены, что хотите удалить канал <strong>"@${s.username}"</strong>?`,icon:"warning",showCancelButton:!0,confirmButtonText:"Да, удалить",cancelButtonText:"Отмена",confirmButtonColor:"#dc2626",cancelButtonColor:"#6b7280"})).isConfirmed)try{const m=await z(`/wow/channels/${s.id}`);if(!m.ok){const C=await m.json();throw new Error(C.message||"Ошибка удаления канала")}await p.fire({title:"Канал удален",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),await x()}catch(m){p.fire({title:"Ошибка",text:m.message||"Ошибка удаления канала",icon:"error",confirmButtonText:"ОК"})}},k=async()=>{t.value=!0,i.value=null;try{const s={username:o.value.username.replace("@",""),title:o.value.title,external_url:o.value.external_url||null,priority:o.value.priority||0,is_active:o.value.is_active};let d;if(c.value?d=await S(`/wow/channels/${o.value.id}`,s):d=await q("/wow/channels",s),!d.ok){const m=await d.json();throw new Error(m.message||"Ошибка сохранения канала")}await p.fire({title:c.value?"Канал обновлен":"Канал создан",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),w(),await x()}catch(s){i.value=s.message||"Ошибка сохранения канала",p.fire({title:"Ошибка",text:s.message||"Ошибка сохранения канала",icon:"error",confirmButtonText:"ОК"})}finally{t.value=!1}},w=()=>{y.value=!1,c.value=!1,o.value={id:null,username:"",title:"",external_url:"",priority:0,is_active:!0},i.value=null};return U(()=>{x()}),{loading:g,saving:t,error:i,channels:r,showCreateModal:y,showEditModal:c,form:o,editChannel:h,deleteChannel:_,saveChannel:k,closeModal:w}}},N={class:"channels-page space-y-6"},P={class:"flex items-center justify-between"},G={key:0,class:"flex items-center justify-center py-12"},L={key:1,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},A={class:"text-destructive"},H={key:2,class:"bg-card rounded-lg border border-border overflow-hidden"},I={class:"overflow-x-auto"},J={class:"w-full"},K={class:"divide-y divide-border"},O={class:"px-6 py-4 text-sm font-medium text-foreground"},Q={class:"px-6 py-4 text-sm text-foreground"},R={class:"px-6 py-4 text-sm text-foreground"},W=["title"],X={key:1,class:"text-muted-foreground"},Y={class:"px-6 py-4 text-sm text-foreground"},Z={class:"px-6 py-4 text-sm"},$={class:"px-6 py-4 text-sm text-right"},ee={class:"flex items-center justify-end gap-2"},te=["onClick"],oe=["onClick"],re={key:3,class:"bg-card rounded-lg border border-border p-12 text-center"},se={key:4,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm"},le={class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-md p-6"},ne={class:"text-lg font-semibold mb-4"},ae={class:"flex items-center gap-2 cursor-pointer"},ie={class:"flex gap-2 pt-4"},de=["disabled"];function ue(g,t,i,r,y,c){return n(),l("div",N,[e("div",P,[t[9]||(t[9]=e("div",null,[e("h1",{class:"text-3xl font-semibold text-foreground"},"Каналы"),e("p",{class:"text-muted-foreground mt-1"},"Управление обязательными каналами для подписки")],-1)),e("button",{onClick:t[0]||(t[0]=o=>r.showCreateModal=!0),class:"h-11 px-6 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-2xl shadow-lg shadow-accent/10 inline-flex items-center justify-center gap-2"},[...t[8]||(t[8]=[e("span",null,"+",-1),e("span",null,"Добавить канал",-1)])])]),r.loading?(n(),l("div",G,[...t[10]||(t[10]=[e("p",{class:"text-muted-foreground"},"Загрузка каналов...",-1)])])):f("",!0),r.error?(n(),l("div",L,[e("p",A,a(r.error),1)])):f("",!0),!r.loading&&r.channels.length>0?(n(),l("div",H,[e("div",I,[e("table",J,[t[11]||(t[11]=e("thead",{class:"bg-muted/30 border-b border-border"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase"},"Username"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase"},"Название"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase"},"Внешняя ссылка"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase"},"Приоритет"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase"},"Статус"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-muted-foreground uppercase"},"Действия")])],-1)),e("tbody",K,[(n(!0),l(B,null,j(r.channels,o=>(n(),l("tr",{key:o.id,class:"hover:bg-muted/10"},[e("td",O,"@"+a(o.username),1),e("td",Q,a(o.title),1),e("td",R,[o.external_url?(n(),l("span",{key:0,class:"text-blue-500 truncate max-w-xs block",title:o.external_url},a(o.external_url),9,W)):(n(),l("span",X,"—"))]),e("td",Y,a(o.priority),1),e("td",Z,[e("span",{class:V(["px-2 py-1 text-xs rounded-md",o.is_active?"bg-green-500/10 text-green-600":"bg-gray-500/10 text-gray-600"])},a(o.is_active?"Активен":"Неактивен"),3)]),e("td",$,[e("div",ee,[e("button",{onClick:x=>r.editChannel(o),class:"px-3 py-1 text-xs bg-blue-500 hover:bg-blue-600 text-white rounded transition-colors"}," Редактировать ",8,te),e("button",{onClick:x=>r.deleteChannel(o),class:"px-3 py-1 text-xs bg-red-500 hover:bg-red-600 text-white rounded transition-colors"}," Удалить ",8,oe)])])]))),128))])])])])):f("",!0),!r.loading&&r.channels.length===0?(n(),l("div",re,[...t[12]||(t[12]=[e("p",{class:"text-muted-foreground"},"Каналы не найдены. Добавьте первый канал.",-1)])])):f("",!0),r.showCreateModal||r.showEditModal?(n(),l("div",se,[e("div",le,[e("h3",ne,a(r.showEditModal?"Редактировать канал":"Добавить канал"),1),e("form",{onSubmit:t[7]||(t[7]=D((...o)=>r.saveChannel&&r.saveChannel(...o),["prevent"])),class:"space-y-4"},[e("div",null,[t[13]||(t[13]=e("label",{class:"text-sm font-medium mb-1 block"},"Username (без @)",-1)),b(e("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>r.form.username=o),type:"text",placeholder:"channel_username",required:"",class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,512),[[v,r.form.username]])]),e("div",null,[t[14]||(t[14]=e("label",{class:"text-sm font-medium mb-1 block"},"Название канала",-1)),b(e("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>r.form.title=o),type:"text",placeholder:"Название канала",required:"",class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,512),[[v,r.form.title]])]),e("div",null,[t[15]||(t[15]=e("label",{class:"text-sm font-medium mb-1 block"},"Внешняя ссылка (опционально)",-1)),b(e("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>r.form.external_url=o),type:"url",placeholder:"https://t.me/channel?utm_source=...",class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,512),[[v,r.form.external_url]]),t[16]||(t[16]=e("p",{class:"text-xs text-muted-foreground mt-1"},"Должна начинаться с https://t.me/",-1))]),e("div",null,[t[17]||(t[17]=e("label",{class:"text-sm font-medium mb-1 block"},"Приоритет",-1)),b(e("input",{"onUpdate:modelValue":t[4]||(t[4]=o=>r.form.priority=o),type:"number",min:"0",placeholder:"0",class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,512),[[v,r.form.priority,void 0,{number:!0}]]),t[18]||(t[18]=e("p",{class:"text-xs text-muted-foreground mt-1"},"Чем выше приоритет, тем выше канал в списке",-1))]),e("div",null,[e("label",ae,[b(e("input",{"onUpdate:modelValue":t[5]||(t[5]=o=>r.form.is_active=o),type:"checkbox",class:"w-4 h-4"},null,512),[[E,r.form.is_active]]),t[19]||(t[19]=e("span",{class:"text-sm"},"Активен",-1))])]),e("div",ie,[e("button",{type:"button",onClick:t[6]||(t[6]=(...o)=>r.closeModal&&r.closeModal(...o)),class:"flex-1 h-10 px-4 border border-border bg-background/50 hover:bg-accent/10 rounded-lg transition-colors"}," Отмена "),e("button",{type:"submit",disabled:r.saving,class:"flex-1 h-10 px-4 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-lg transition-colors disabled:opacity-50"},a(r.saving?"Сохранение...":"Сохранить"),9,de)])],32)])])):f("",!0)])}const fe=M(F,[["render",ue]]);export{fe as default};
