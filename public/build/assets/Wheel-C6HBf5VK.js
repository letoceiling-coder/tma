import{_ as N,c as a,a as e,b as u,p as R,e as F,t as _,d as b,B as j,v as h,F as H,q as I,w as C,f as P,r as d,m as z,k as L,h as W,o as i,A as q,C as G}from"./admin-jGV2dTpi.js";import{a as J,c as U}from"./api-DccBIR6h.js";import{S as p}from"./sweetalert2.esm.all-C0u8rGqG.js";import K from"./Media-B0414tQt.js";const O={name:"Wheel",components:{Media:K},setup(){const g=d(!1),t=d(!1),v=d(!1),o=d(null),m=d([]),x=d(!1),f=d(3),l=d(!1),r=d(null),y=d(null),M=z(()=>m.value.reduce((s,n)=>s+(parseFloat(n.probability_percent)||0),0)),S=z(()=>Math.abs(M.value-100)<.01),k=async()=>{g.value=!0,o.value=null;try{const s=await J("/wow/wheel");if(!s.ok)throw new Error("ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ ÑÐµÐºÑ‚Ð¾Ñ€Ð¾Ð²");const n=await s.json();m.value=(n.data||[]).map(w=>({...w,probability_percent:parseFloat(w.probability_percent)||0,prize_value:w.prize_value||0})),n.settings&&(x.value=n.settings.always_empty_mode||!1,f.value=n.settings.ticket_restore_hours||3)}catch(s){o.value=s.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ ÑÐµÐºÑ‚Ð¾Ñ€Ð¾Ð²"}finally{g.value=!1}},E=async()=>{if(!S.value){await p.fire({title:"ÐžÑˆÐ¸Ð±ÐºÐ°",text:"Ð¡ÑƒÐ¼Ð¼Ð° Ð²ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚ÐµÐ¹ Ð´Ð¾Ð»Ð¶Ð½Ð° Ð±Ñ‹Ñ‚ÑŒ Ñ€Ð°Ð²Ð½Ð° 100%",icon:"error",confirmButtonText:"ÐžÐš"});return}t.value=!0,o.value=null;try{const s=m.value.map(c=>({id:c.id,prize_type:c.prize_type,prize_value:c.prize_value||0,icon_url:c.icon_url||null,probability_percent:parseFloat(c.probability_percent)||0,is_active:c.is_active!==!1})),n=await U("/wow/wheel/bulk-update",{sectors:s});if(!n.ok){const c=await n.json();throw new Error(c.message||"ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ ÑÐµÐºÑ‚Ð¾Ñ€Ð¾Ð²")}const w=await n.json();await p.fire({title:"Ð¡ÐµÐºÑ‚Ð¾Ñ€Ñ‹ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ñ‹",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),await k()}catch(s){o.value=s.message||"ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ ÑÐµÐºÑ‚Ð¾Ñ€Ð¾Ð²",await p.fire({title:"ÐžÑˆÐ¸Ð±ÐºÐ°",text:s.message||"ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ ÑÐµÐºÑ‚Ð¾Ñ€Ð¾Ð²",icon:"error",confirmButtonText:"ÐžÐš"})}finally{t.value=!1}},B=s=>{s.target.style.display="none"},T=s=>{r.value=s,y.value=null,l.value=!0},V=()=>{l.value=!1,r.value=null,y.value=null},D=s=>{if(r.value&&s){const n=s.url||(s.metadata?.path?"/"+s.metadata.path:"");r.value.icon_url=n||"",y.value=s,setTimeout(()=>{V()},300)}},A=async()=>{v.value=!0;try{const s=await U("/wow/wheel/settings",{always_empty_mode:x.value,ticket_restore_hours:f.value});if(!s.ok){const n=await s.json();throw new Error(n.message||"ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐº")}await p.fire({title:"ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ñ‹",icon:"success",timer:1500,showConfirmButton:!1,toast:!0,position:"top-end"})}catch(s){await p.fire({title:"ÐžÑˆÐ¸Ð±ÐºÐ°",text:s.message||"ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐº",icon:"error",confirmButtonText:"ÐžÐš"}),await k()}finally{v.value=!1}};return L(()=>{k()}),{loading:g,saving:t,savingSettings:v,error:o,sectors:m,alwaysEmptyMode:x,ticketRestoreHours:f,totalProbability:M,probabilityValid:S,saveAllSectors:E,saveSettings:A,handleImageError:B,showMediaModal:l,currentSector:r,selectedMediaFile:y,openMediaSelector:T,closeMediaModal:V,handleMediaFileSelected:D}}},Q={class:"wheel-page space-y-6"},X={class:"flex items-center justify-between"},Y={class:"flex items-center gap-4"},Z={key:0,class:"ml-2"},$=["disabled"],ee={key:0,class:"bg-card rounded-lg border border-border p-6 space-y-6"},te={class:"flex items-center justify-between"},oe={class:"relative inline-flex items-center cursor-pointer"},le={class:"flex items-center justify-between"},se={class:"flex items-center gap-3"},re={key:1,class:"flex items-center justify-center py-12"},ne={key:2,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},ae={class:"text-destructive"},ie={key:3,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},de={class:"flex items-center justify-between"},ce={class:"text-lg font-semibold"},ue={class:"flex items-center gap-2 cursor-pointer"},be=["onUpdate:modelValue"],me=["onUpdate:modelValue"],fe={key:0},pe=["onUpdate:modelValue"],ge=["onUpdate:modelValue"],ve={class:"mt-1 h-2 bg-muted rounded-full overflow-hidden"},xe={class:"flex gap-2"},ye=["onUpdate:modelValue"],we=["onClick"],_e={key:0,class:"mt-2"},he=["src","alt"],ke={class:"flex items-center justify-between p-4 border-b border-border"},Me={class:"flex-1 overflow-hidden"};function Se(g,t,v,o,m,x){const f=W("Media");return i(),a("div",Q,[e("div",X,[t[9]||(t[9]=e("div",null,[e("h1",{class:"text-3xl font-semibold text-foreground"},"Ð ÐµÐ´Ð°ÐºÑ‚Ð¾Ñ€ Ñ€ÑƒÐ»ÐµÑ‚ÐºÐ¸"),e("p",{class:"text-muted-foreground mt-1"},"ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° ÑÐµÐºÑ‚Ð¾Ñ€Ð¾Ð² Ñ€ÑƒÐ»ÐµÑ‚ÐºÐ¸ Ð¸ Ð²ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚ÐµÐ¹ Ð²Ñ‹Ð¿Ð°Ð´ÐµÐ½Ð¸Ñ")],-1)),e("div",Y,[e("div",{class:R(["px-4 py-2 rounded-lg text-sm font-medium",o.probabilityValid?"bg-green-500/10 text-green-600":"bg-red-500/10 text-red-600"])},[F(" Ð’ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚ÑŒ: "+_(o.totalProbability.toFixed(2))+"% ",1),o.probabilityValid?u("",!0):(i(),a("span",Z,"(Ð´Ð¾Ð»Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ 100%)"))],2),e("button",{onClick:t[0]||(t[0]=(...l)=>o.saveAllSectors&&o.saveAllSectors(...l)),disabled:!o.probabilityValid||o.saving,class:"h-11 px-6 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-2xl shadow-lg shadow-accent/10 inline-flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"},[e("span",null,_(o.saving?"Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ...":"Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ Ð²ÑÐµ"),1)],8,$)])]),o.loading?u("",!0):(i(),a("div",ee,[t[14]||(t[14]=e("h2",{class:"text-xl font-semibold mb-4"},"ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ñ€ÑƒÐ»ÐµÑ‚ÐºÐ¸",-1)),e("div",te,[t[11]||(t[11]=e("div",null,[e("h3",{class:"text-base font-medium mb-1"},'Ð ÐµÐ¶Ð¸Ð¼ "Ð’ÑÐµÐ³Ð´Ð° Ð¿ÑƒÑÑ‚Ð¾"'),e("p",{class:"text-sm text-muted-foreground"}," ÐŸÑ€Ð¸ Ð²ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ð¸ ÐºÐ¾Ð»ÐµÑÐ¾ Ð²ÑÐµÐ³Ð´Ð° Ð±ÑƒÐ´ÐµÑ‚ Ð¾ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°Ñ‚ÑŒÑÑ Ð½Ð° Ð¿ÑƒÑÑ‚Ð¾Ð¼ ÑÐµÐºÑ‚Ð¾Ñ€Ðµ ")],-1)),e("label",oe,[b(e("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>o.alwaysEmptyMode=l),onChange:t[2]||(t[2]=(...l)=>o.saveSettings&&o.saveSettings(...l)),type:"checkbox",class:"sr-only peer"},null,544),[[j,o.alwaysEmptyMode]]),t[10]||(t[10]=e("div",{class:"w-11 h-6 bg-muted peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-accent/20 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-border after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-accent"},null,-1))])]),e("div",le,[t[13]||(t[13]=e("div",{class:"flex-1"},[e("h3",{class:"text-base font-medium mb-1"},"ÐŸÐµÑ€Ð¸Ð¾Ð´ Ð²Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ Ð±Ð¸Ð»ÐµÑ‚Ð°"),e("p",{class:"text-sm text-muted-foreground"}," Ð§ÐµÑ€ÐµÐ· ÑÐºÐ¾Ð»ÑŒÐºÐ¾ Ñ‡Ð°ÑÐ¾Ð² Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð¿Ð¾Ð»ÑƒÑ‡Ð°ÐµÑ‚ Ð½Ð¾Ð²Ñ‹Ð¹ Ð±Ð¸Ð»ÐµÑ‚ (Ð¾Ñ‚ 1 Ð´Ð¾ 24 Ñ‡Ð°ÑÐ¾Ð²) ")],-1)),e("div",se,[b(e("input",{"onUpdate:modelValue":t[3]||(t[3]=l=>o.ticketRestoreHours=l),onChange:t[4]||(t[4]=(...l)=>o.saveSettings&&o.saveSettings(...l)),type:"number",min:"1",max:"24",step:"1",class:"w-24 h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent text-center"},null,544),[[h,o.ticketRestoreHours,void 0,{number:!0}]]),t[12]||(t[12]=e("span",{class:"text-sm text-muted-foreground"},"Ñ‡Ð°ÑÐ¾Ð²",-1))])])])),o.loading?(i(),a("div",re,[...t[15]||(t[15]=[e("p",{class:"text-muted-foreground"},"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° ÑÐµÐºÑ‚Ð¾Ñ€Ð¾Ð²...",-1)])])):u("",!0),o.error?(i(),a("div",ne,[e("p",ae,_(o.error),1)])):u("",!0),o.loading?u("",!0):(i(),a("div",ie,[(i(!0),a(H,null,I(o.sectors,l=>(i(),a("div",{key:l.id,class:"bg-card rounded-lg border border-border p-6 space-y-4"},[e("div",de,[e("h3",ce,"Ð¡ÐµÐºÑ‚Ð¾Ñ€ #"+_(l.sector_number),1),e("label",ue,[b(e("input",{"onUpdate:modelValue":r=>l.is_active=r,type:"checkbox",class:"w-4 h-4"},null,8,be),[[j,l.is_active]]),t[16]||(t[16]=e("span",{class:"text-sm"},"ÐÐºÑ‚Ð¸Ð²ÐµÐ½",-1))])]),e("div",null,[t[18]||(t[18]=e("label",{class:"text-sm font-medium mb-1 block"},"Ð¢Ð¸Ð¿ Ð¿Ñ€Ð¸Ð·Ð°",-1)),b(e("select",{"onUpdate:modelValue":r=>l.prize_type=r,class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},[...t[17]||(t[17]=[e("option",{value:"empty"},"ÐŸÑƒÑÑ‚Ð¾",-1),e("option",{value:"money"},"Ð”ÐµÐ½ÑŒÐ³Ð¸",-1),e("option",{value:"ticket"},"Ð‘Ð¸Ð»ÐµÑ‚",-1),e("option",{value:"secret_box"},"Ð¡ÐµÐºÑ€ÐµÑ‚Ð½Ñ‹Ð¹ Ð±Ð¾ÐºÑ",-1)])],8,me),[[q,l.prize_type]])]),l.prize_type==="money"?(i(),a("div",fe,[t[19]||(t[19]=e("label",{class:"text-sm font-medium mb-1 block"},"Ð¡ÑƒÐ¼Ð¼Ð° (â‚½)",-1)),b(e("input",{"onUpdate:modelValue":r=>l.prize_value=r,type:"number",min:"0",placeholder:"300",class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,8,pe),[[h,l.prize_value,void 0,{number:!0}]])])):u("",!0),e("div",null,[t[20]||(t[20]=e("label",{class:"text-sm font-medium mb-1 block"},[F(" Ð’ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚ÑŒ (%) "),e("span",{class:"text-xs text-muted-foreground"},"(0-100)")],-1)),b(e("input",{"onUpdate:modelValue":r=>l.probability_percent=r,type:"number",min:"0",max:"100",step:"0.01",placeholder:"0.00",class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,8,ge),[[h,l.probability_percent,void 0,{number:!0}]]),e("div",ve,[e("div",{class:"h-full bg-accent transition-all",style:G({width:`${l.probability_percent}%`})},null,4)])]),e("div",null,[t[21]||(t[21]=e("label",{class:"text-sm font-medium mb-1 block"},"URL Ð¸ÐºÐ¾Ð½ÐºÐ¸",-1)),e("div",xe,[b(e("input",{"onUpdate:modelValue":r=>l.icon_url=r,type:"text",placeholder:"https://...",class:"flex-1 h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,8,ye),[[h,l.icon_url]]),e("button",{onClick:r=>o.openMediaSelector(l),type:"button",class:"h-10 px-4 bg-accent/10 text-accent border border-accent/40 hover:bg-accent/20 rounded-lg inline-flex items-center justify-center gap-2 transition-colors",title:"Ð’Ñ‹Ð±Ñ€Ð°Ñ‚ÑŒ Ð¸Ð· Ð¼ÐµÐ´Ð¸Ð°Ñ‚ÐµÐºÐ¸"}," ðŸ“ ",8,we)]),l.icon_url?(i(),a("div",_e,[e("img",{src:l.icon_url,alt:`Ð¡ÐµÐºÑ‚Ð¾Ñ€ ${l.sector_number}`,class:"w-16 h-16 object-contain rounded",onError:t[5]||(t[5]=(...r)=>o.handleImageError&&o.handleImageError(...r))},null,40,he)])):u("",!0)])]))),128))])),o.showMediaModal?(i(),a("div",{key:4,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm",onClick:t[8]||(t[8]=C((...l)=>o.closeMediaModal&&o.closeMediaModal(...l),["self"]))},[e("div",{class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-6xl h-[90vh] flex flex-col",onClick:t[7]||(t[7]=C(()=>{},["stop"]))},[e("div",ke,[t[22]||(t[22]=e("h3",{class:"text-lg font-semibold"},"Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¸ÐºÐ¾Ð½ÐºÑƒ",-1)),e("button",{onClick:t[6]||(t[6]=(...l)=>o.closeMediaModal&&o.closeMediaModal(...l)),class:"w-8 h-8 flex items-center justify-center rounded-lg hover:bg-muted transition-colors"}," âœ• ")]),e("div",Me,[P(f,{selectionMode:!0,countFile:1,selectedFiles:o.selectedMediaFile?[o.selectedMediaFile]:[],onFileSelected:o.handleMediaFileSelected},null,8,["selectedFiles","onFileSelected"])])])])):u("",!0)])}const ze=N(O,[["render",Se]]);export{ze as default};
