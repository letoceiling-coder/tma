import{_ as j,c as d,a as t,b as v,p as x,t as i,e as k,A as C,r as a,m as c,k as D,z as T,j as A,o as n}from"./admin-BUNtZ2ka.js";const B={name:"Subscription",setup(){const r=a(null),s=a(!0),b=a(null),e=a(null),g=a(window.location.hostname),y=a("/api/subscription/check"),l=c(()=>r.value&&r.value.is_active===!0),_=c(()=>r.value&&!r.value.is_active),w=c(()=>!r.value||!r.value.expires_at?!1:u.value<=3&&u.value>=0),u=c(()=>{if(!r.value||!r.value.expires_at)return null;try{const E=new Date(r.value.expires_at)-new Date,p=Math.ceil(E/(1e3*60*60*24));return p>=0?p:0}catch{return null}}),h=c(()=>{const o=u.value;return o===null?"":o===1?"день":o>=2&&o<=4?"дня":"дней"}),m=async()=>{s.value=!0;try{const o=await A.get("/api/subscription/check");o.data.success&&(r.value=o.data.subscription,b.value=new Date().toLocaleString("ru-RU"),o.data.is_active||setTimeout(()=>{window.location.href="/subscription-expired"},2e3))}catch(o){console.error("Ошибка проверки подписки:",o),o.response&&(o.response.status===403||o.response.status===404)&&setTimeout(()=>{window.location.href="/subscription-expired"},2e3)}finally{s.value=!1}},L=o=>{if(!o)return"-";try{return new Date(o).toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return o}},S=o=>({active:"Активна",expired:"Истекла",suspended:"Приостановлена"})[o]||o;return D(()=>{m(),e.value=setInterval(()=>{m()},300*1e3)}),T(()=>{e.value&&clearInterval(e.value)}),{subscription:r,loading:s,lastCheckTime:b,domain:g,apiUrl:y,isActive:l,isExpired:_,isExpiringSoon:w,daysLeft:u,daysText:h,checkSubscription:m,formatDate:L,getStatusLabel:S}}},I={class:"subscription-page"},U={key:0,class:"flex items-center justify-center py-12"},z={key:1,class:"space-y-6"},M={class:"flex items-center justify-between mb-6"},N={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},V={class:"space-y-4"},R={class:"mt-1 text-lg font-semibold"},P={key:0,class:"text-sm text-muted-foreground ml-1"},q={class:"space-y-4"},F={class:"mt-1 text-lg font-semibold"},G={class:"mt-1 text-lg font-semibold"},H={key:0,class:"bg-yellow-50 dark:bg-yellow-900/20 border-l-4 border-yellow-500 rounded-lg p-4"},J={class:"flex items-start gap-3"},K={class:"text-sm text-yellow-700 dark:text-yellow-300"},O={key:0},Q={key:1},W={key:1,class:"bg-red-50 dark:bg-red-900/20 border-l-4 border-red-500 rounded-lg p-4"},X={class:"bg-card rounded-lg border border-border p-6"},Y={class:"space-y-3 text-sm"},Z={class:"flex justify-between"},$={class:"font-medium"},ee={class:"flex justify-between"},te={class:"font-medium font-mono text-xs"},se={class:"flex justify-end"},oe=["disabled"],re={key:0},de={key:1},ne={key:2,class:"bg-card rounded-lg border border-border p-6"},ie={class:"text-center py-8"};function ae(r,s,b,e,g,y){return n(),d("div",I,[s[16]||(s[16]=t("div",{class:"mb-6"},[t("h1",{class:"text-2xl font-bold text-foreground"},"Подписка"),t("p",{class:"text-muted-foreground mt-1"},"Информация о подписке и сроке действия")],-1)),e.loading?(n(),d("div",U,[...s[2]||(s[2]=[t("div",{class:"text-muted-foreground"},"Загрузка информации о подписке...",-1)])])):e.subscription?(n(),d("div",z,[t("div",{class:x(["bg-card rounded-lg border p-6",{"border-border":e.isActive&&!e.isExpiringSoon,"border-yellow-500":e.isExpiringSoon&&e.daysLeft>0,"border-red-500":e.isExpired||e.daysLeft===0}])},[t("div",M,[s[3]||(s[3]=t("h2",{class:"text-xl font-semibold"},"Статус подписки",-1)),t("span",{class:x(["px-4 py-2 rounded-full text-sm font-bold",{"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":e.subscription.status==="active","bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400":e.subscription.status==="expired","bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400":e.subscription.status==="suspended"}])},i(e.getStatusLabel(e.subscription.status)),3)]),t("div",N,[t("div",V,[t("div",null,[s[4]||(s[4]=t("label",{class:"text-sm font-medium text-muted-foreground"},"Действует до",-1)),t("div",R,i(e.formatDate(e.subscription.expires_at)),1)]),t("div",null,[s[5]||(s[5]=t("label",{class:"text-sm font-medium text-muted-foreground"},"Осталось дней",-1)),t("div",{class:x(["mt-1 text-lg font-semibold",{"text-green-600 dark:text-green-400":e.daysLeft>3,"text-yellow-600 dark:text-yellow-400":e.daysLeft<=3&&e.daysLeft>0,"text-red-600 dark:text-red-400":e.daysLeft===0||e.isExpired}])},[k(i(e.daysLeft!==null?e.daysLeft:"-")+" ",1),e.daysLeft!==null?(n(),d("span",P,i(e.daysText),1)):v("",!0)],2)])]),t("div",q,[t("div",null,[s[6]||(s[6]=t("label",{class:"text-sm font-medium text-muted-foreground"},"Статус активности",-1)),t("div",F,[t("span",{class:x({"text-green-600 dark:text-green-400":e.isActive,"text-red-600 dark:text-red-400":!e.isActive})},i(e.isActive?"Активна":"Неактивна"),3)])]),t("div",null,[s[7]||(s[7]=t("label",{class:"text-sm font-medium text-muted-foreground"},"Домен",-1)),t("div",G,i(e.domain),1)])])])],2),e.isExpiringSoon?(n(),d("div",H,[t("div",J,[s[10]||(s[10]=t("svg",{class:"h-6 w-6 text-yellow-600 dark:text-yellow-400 flex-shrink-0 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),t("div",null,[s[9]||(s[9]=t("h3",{class:"font-semibold text-yellow-800 dark:text-yellow-200 mb-1"}," Внимание! Подписка скоро истечет ",-1)),t("p",K,[e.daysLeft>0?(n(),d("span",O," Ваша подписка истекает через "+i(e.daysLeft)+" "+i(e.daysText)+". ",1)):(n(),d("span",Q," Ваша подписка истекла! ")),s[8]||(s[8]=k(" Для продолжения работы с админ-панелью необходимо продлить подписку. ",-1))])])])])):v("",!0),e.isExpired?(n(),d("div",W,[...s[11]||(s[11]=[C('<div class="flex items-start gap-3" data-v-b22431e6><svg class="h-6 w-6 text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-b22431e6><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" data-v-b22431e6></path></svg><div data-v-b22431e6><h3 class="font-semibold text-red-800 dark:text-red-200 mb-1" data-v-b22431e6> Подписка истекла </h3><p class="text-sm text-red-700 dark:text-red-300" data-v-b22431e6> Доступ к админ-панели ограничен. Для продления подписки свяжитесь с администратором системы. </p></div></div>',1)])])):v("",!0),t("div",X,[s[14]||(s[14]=t("h3",{class:"text-lg font-semibold mb-4"},"Дополнительная информация",-1)),t("div",Y,[t("div",Z,[s[12]||(s[12]=t("span",{class:"text-muted-foreground"},"Последняя проверка:",-1)),t("span",$,i(e.lastCheckTime),1)]),t("div",ee,[s[13]||(s[13]=t("span",{class:"text-muted-foreground"},"API Endpoint:",-1)),t("span",te,i(e.apiUrl),1)])])]),t("div",se,[t("button",{onClick:s[0]||(s[0]=(...l)=>e.checkSubscription&&e.checkSubscription(...l)),disabled:e.loading,class:"px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},[e.loading?(n(),d("span",re,"Обновление...")):(n(),d("span",de,"Обновить информацию"))],8,oe)])])):(n(),d("div",ne,[t("div",ie,[s[15]||(s[15]=t("p",{class:"text-muted-foreground mb-4"},"Не удалось загрузить информацию о подписке",-1)),t("button",{onClick:s[1]||(s[1]=(...l)=>e.checkSubscription&&e.checkSubscription(...l)),class:"px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors"}," Попробовать снова ")])]))])}const ce=j(B,[["render",ae],["__scopeId","data-v-b22431e6"]]);export{ce as default};
