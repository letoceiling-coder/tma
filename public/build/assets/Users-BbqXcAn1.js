import{_ as S,c as l,a as e,b as m,t as c,F as h,q as y,w as T,d as g,v as _,e as q,r as u,m as A,k as R,u as I,o as n,B as N}from"./admin-Ou2hz_RL.js";import{a as U,b as P,c as F,d as L}from"./api-DccBIR6h.js";import{S as b}from"./sweetalert2.esm.all-C0u8rGqG.js";const z={name:"Users",setup(){const k=I(),o=u(!1),p=u(!1),t=u(null),f=u([]),v=u([]),s=u(!1),d=u(!1),i=u({id:null,name:"",email:"",password:"",roles:[]}),M=A(()=>k.getters.user?.id),w=async()=>{o.value=!0,t.value=null;try{const r=await U("/users");if(!r.ok)throw new Error("Ошибка загрузки пользователей");const a=await r.json();a.data&&Array.isArray(a.data)?f.value=a.data:Array.isArray(a)?f.value=a:f.value=[]}catch(r){t.value=r.message||"Ошибка загрузки пользователей"}finally{o.value=!1}},B=async()=>{try{const r=await U("/roles");if(!r.ok)throw new Error("Ошибка загрузки ролей");const a=await r.json();v.value=a.data||[]}catch(r){console.error("Error fetching roles:",r)}},E=r=>{i.value={id:r.id,name:r.name,email:r.email,password:"",roles:r.roles.map(a=>a.id)},d.value=!0},j=async r=>{if((await b.fire({title:"Удалить пользователя?",html:`Вы уверены, что хотите удалить пользователя <strong>"${r.name}"</strong>?`,icon:"warning",showCancelButton:!0,confirmButtonText:"Да, удалить",cancelButtonText:"Отмена",confirmButtonColor:"#dc2626",cancelButtonColor:"#6b7280"})).isConfirmed)try{const x=await L(`/users/${r.id}`);if(!x.ok){const V=await x.json();throw new Error(V.message||"Ошибка удаления пользователя")}await b.fire({title:"Пользователь удален",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),await w()}catch(x){b.fire({title:"Ошибка",text:x.message||"Ошибка удаления пользователя",icon:"error",confirmButtonText:"ОК"})}},D=async()=>{p.value=!0,t.value=null;try{const r={name:i.value.name,email:i.value.email,roles:i.value.roles};i.value.password&&(r.password=i.value.password);let a;if(d.value?a=await P(`/users/${i.value.id}`,r):a=await F("/users",r),!a.ok){const x=await a.json();throw new Error(x.message||"Ошибка сохранения пользователя")}await b.fire({title:d.value?"Пользователь обновлен":"Пользователь создан",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),C(),await w()}catch(r){t.value=r.message||"Ошибка сохранения пользователя",b.fire({title:"Ошибка",text:r.message||"Ошибка сохранения пользователя",icon:"error",confirmButtonText:"ОК"})}finally{p.value=!1}},C=()=>{s.value=!1,d.value=!1,i.value={id:null,name:"",email:"",password:"",roles:[]}};return R(async()=>{await Promise.all([w(),B()])}),{loading:o,saving:p,error:t,users:f,allRoles:v,showCreateModal:s,showEditModal:d,form:i,currentUserId:M,editUser:E,deleteUser:j,saveUser:D,closeModal:C}}},G={class:"users-page space-y-6"},H={class:"flex items-center justify-between"},J={key:0,class:"flex items-center justify-center py-12"},K={key:1,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},O={class:"text-destructive"},Q={key:2,class:"bg-card rounded-lg border border-border overflow-hidden"},W={class:"overflow-x-auto"},X={class:"w-full"},Y={class:"divide-y divide-border"},Z={class:"px-6 py-4 text-sm text-foreground"},$={class:"px-6 py-4 text-sm font-medium text-foreground"},ee={class:"px-6 py-4 text-sm text-foreground"},te={class:"px-6 py-4 text-sm text-foreground"},oe={class:"flex flex-wrap gap-1"},se={key:0,class:"text-muted-foreground text-xs"},re={class:"px-6 py-4 text-sm text-muted-foreground"},ae={class:"px-6 py-4 text-sm text-right"},le={class:"flex items-center justify-end gap-2"},ne=["onClick"],de=["onClick","disabled"],ie={key:3,class:"bg-card rounded-lg border border-border p-12 text-center"},ce={key:4,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm"},ue={class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-md p-6"},me={class:"text-lg font-semibold mb-4"},xe={class:"text-sm font-medium mb-1 block"},fe={key:0,class:"text-xs text-muted-foreground"},be=["required"],pe={class:"space-y-2 max-h-48 overflow-y-auto border border-border rounded p-2"},ge=["value"],ve={class:"text-sm"},we={class:"flex gap-2 pt-4"},he=["disabled"];function ye(k,o,p,t,f,v){return n(),l("div",G,[e("div",H,[o[8]||(o[8]=e("div",null,[e("h1",{class:"text-3xl font-semibold text-foreground"},"Пользователи"),e("p",{class:"text-muted-foreground mt-1"},"Управление пользователями системы")],-1)),e("button",{onClick:o[0]||(o[0]=s=>t.showCreateModal=!0),class:"h-11 px-6 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-2xl shadow-lg shadow-accent/10 inline-flex items-center justify-center gap-2"},[...o[7]||(o[7]=[e("span",null,"+",-1),e("span",null,"Создать пользователя",-1)])])]),t.loading?(n(),l("div",J,[...o[9]||(o[9]=[e("p",{class:"text-muted-foreground"},"Загрузка пользователей...",-1)])])):m("",!0),t.error?(n(),l("div",K,[e("p",O,c(t.error),1)])):m("",!0),!t.loading&&t.users.length>0?(n(),l("div",Q,[e("div",W,[e("table",X,[o[10]||(o[10]=e("thead",{class:"bg-muted/30 border-b border-border"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase"},"ID"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase"},"Имя"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase"},"Email"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase"},"Роли"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase"},"Дата создания"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-muted-foreground uppercase"},"Действия")])],-1)),e("tbody",Y,[(n(!0),l(h,null,y(t.users,s=>(n(),l("tr",{key:s.id,class:"hover:bg-muted/10"},[e("td",Z,c(s.id),1),e("td",$,c(s.name),1),e("td",ee,c(s.email),1),e("td",te,[e("div",oe,[(n(!0),l(h,null,y(s.roles,d=>(n(),l("span",{key:d.id,class:"px-2 py-1 text-xs rounded-md bg-accent/10 text-accent"},c(d.name),1))),128)),s.roles.length===0?(n(),l("span",se,"Нет ролей")):m("",!0)])]),e("td",re,c(new Date(s.created_at).toLocaleDateString("ru-RU")),1),e("td",ae,[e("div",le,[e("button",{onClick:d=>t.editUser(s),class:"px-3 py-1 text-xs bg-blue-500 hover:bg-blue-600 text-white rounded transition-colors"}," Редактировать ",8,ne),e("button",{onClick:d=>t.deleteUser(s),disabled:s.id===t.currentUserId,class:"px-3 py-1 text-xs bg-red-500 hover:bg-red-600 text-white rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed"}," Удалить ",8,de)])])]))),128))])])])])):m("",!0),!t.loading&&t.users.length===0?(n(),l("div",ie,[...o[11]||(o[11]=[e("p",{class:"text-muted-foreground"},"Пользователи не найдены",-1)])])):m("",!0),t.showCreateModal||t.showEditModal?(n(),l("div",ce,[e("div",ue,[e("h3",me,c(t.showEditModal?"Редактировать пользователя":"Создать пользователя"),1),e("form",{onSubmit:o[6]||(o[6]=T((...s)=>t.saveUser&&t.saveUser(...s),["prevent"])),class:"space-y-4"},[e("div",null,[o[12]||(o[12]=e("label",{class:"text-sm font-medium mb-1 block"},"Имя",-1)),g(e("input",{"onUpdate:modelValue":o[1]||(o[1]=s=>t.form.name=s),type:"text",required:"",class:"w-full h-10 px-3 border border-border rounded bg-background"},null,512),[[_,t.form.name]])]),e("div",null,[o[13]||(o[13]=e("label",{class:"text-sm font-medium mb-1 block"},"Email",-1)),g(e("input",{"onUpdate:modelValue":o[2]||(o[2]=s=>t.form.email=s),type:"email",required:"",class:"w-full h-10 px-3 border border-border rounded bg-background"},null,512),[[_,t.form.email]])]),e("div",null,[e("label",xe,[o[14]||(o[14]=q(" Пароль ",-1)),t.showEditModal?(n(),l("span",fe,"(оставьте пустым, чтобы не менять)")):m("",!0)]),g(e("input",{"onUpdate:modelValue":o[3]||(o[3]=s=>t.form.password=s),type:"password",required:!t.showEditModal,minlength:8,class:"w-full h-10 px-3 border border-border rounded bg-background"},null,8,be),[[_,t.form.password]])]),e("div",null,[o[15]||(o[15]=e("label",{class:"text-sm font-medium mb-1 block"},"Роли",-1)),e("div",pe,[(n(!0),l(h,null,y(t.allRoles,s=>(n(),l("label",{key:s.id,class:"flex items-center gap-2 cursor-pointer hover:bg-muted/10 p-2 rounded"},[g(e("input",{type:"checkbox",value:s.id,"onUpdate:modelValue":o[4]||(o[4]=d=>t.form.roles=d),class:"w-4 h-4"},null,8,ge),[[N,t.form.roles]]),e("span",ve,c(s.name),1)]))),128))])]),e("div",we,[e("button",{type:"button",onClick:o[5]||(o[5]=(...s)=>t.closeModal&&t.closeModal(...s)),class:"flex-1 h-10 px-4 border border-border bg-background/50 hover:bg-accent/10 rounded-lg transition-colors"}," Отмена "),e("button",{type:"submit",disabled:t.saving,class:"flex-1 h-10 px-4 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-lg transition-colors disabled:opacity-50"},c(t.saving?"Сохранение...":"Сохранить"),9,he)])],32)])])):m("",!0)])}const Ue=S(z,[["render",ye]]);export{Ue as default};
