import{_ as j,c as r,a as o,b as p,t as m,w as B,d as l,v as i,F as M,q as N,B as w,r as d,m as h,k as A,j as y,o as a}from"./admin-Bjm7cUDD.js";import{S as u}from"./sweetalert2.esm.all-C0u8rGqG.js";const S={name:"BotConfig",setup(){const x=d(!1),e=d(!1),k=d(!1),t=d(!1),f=d(null),v=d(null),s=d(!1),g=d(null),_=["message","callback_query","inline_query","pre_checkout_query","shipping_query"],b=d({bot_token:"",bot_username:"",webhook_url:"",mini_app_url:"",admin_ids:[],required_channels:[],webhook:{secret_token:"",allowed_updates:["message","callback_query"],max_connections:40},notifications:{enabled:!0,queue:"default"},rate_limiting:{enabled:!0,cache_driver:"redis"},validation:{enabled:!0,auto_truncate:!0}}),I=h({get:()=>b.value.admin_ids.join(","),set:n=>{b.value.admin_ids=n?n.split(",").map(c=>parseInt(c.trim())).filter(c=>!isNaN(c)):[]}}),U=h({get:()=>b.value.required_channels.join(","),set:n=>{b.value.required_channels=n?n.split(",").map(c=>c.trim()).filter(c=>c):[]}}),C=async()=>{x.value=!0,f.value=null;try{const n=await y.get("/api/v1/config/bot/");n.data&&(b.value={...n.data,webhook:{secret_token:n.data.webhook?.secret_token||"",allowed_updates:n.data.webhook?.allowed_updates||["message","callback_query"],max_connections:n.data.webhook?.max_connections||40}})}catch(n){f.value=n.response?.data?.message||"Ошибка загрузки настроек"}finally{x.value=!1}},q=async()=>{e.value=!0,f.value=null,v.value=null;try{const n=await y.post("/api/v1/config/bot/",b.value);n.data.error?u.fire({icon:"warning",title:"Внимание",text:n.data.message}):(v.value=n.data.message||"Настройки успешно сохранены",u.fire({icon:"success",title:"Успешно",text:n.data.message||"Настройки сохранены и webhook зарегистрирован"}))}catch(n){f.value=n.response?.data?.message||"Ошибка сохранения настроек",u.fire({icon:"error",title:"Ошибка",text:n.response?.data?.message||"Ошибка сохранения настроек"})}finally{e.value=!1}},V=async()=>{k.value=!0;try{const n=await y.post("/api/v1/config/bot/test-connection");n.data.success?u.fire({icon:"success",title:"Подключение успешно!",html:`
                            <p><strong>ID:</strong> ${n.data.data.id}</p>
                            <p><strong>Username:</strong> @${n.data.data.username||"N/A"}</p>
                            <p><strong>First Name:</strong> ${n.data.data.first_name||"N/A"}</p>
                        `}):u.fire({icon:"error",title:"Ошибка подключения",text:n.data.error})}catch(n){u.fire({icon:"error",title:"Ошибка",text:n.response?.data?.error||"Ошибка проверки подключения"})}finally{k.value=!1}},W=async()=>{t.value=!0,s.value=!0,g.value=null;try{const n=await y.get("/api/v1/config/bot/webhook-info");n.data.success?g.value=n.data.data:(u.fire({icon:"error",title:"Ошибка",text:n.data.error}),s.value=!1)}catch(n){u.fire({icon:"error",title:"Ошибка",text:n.response?.data?.error||"Ошибка получения информации о webhook"}),s.value=!1}finally{t.value=!1}};return A(()=>{C()}),{loading:x,saving:e,testing:k,loadingWebhook:t,error:f,successMessage:v,form:b,adminIdsInput:I,requiredChannelsInput:U,availableUpdates:_,showWebhookInfo:s,webhookInfo:g,saveConfig:q,testConnection:V,getWebhookInfo:W}}},D={class:"bot-config-page space-y-6"},T={key:0,class:"flex items-center justify-center py-12"},F={key:1,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},L={class:"text-destructive"},R={key:2,class:"p-4 bg-green-500/10 border border-green-500/20 rounded-lg"},z={class:"text-green-600"},O={class:"bg-card rounded-lg border border-border p-6"},E={class:"space-y-4"},G={class:"bg-card rounded-lg border border-border p-6"},H={class:"space-y-4"},J={class:"space-y-2"},K=["value"],P={class:"text-sm"},Q={class:"bg-card rounded-lg border border-border p-6"},X={class:"space-y-4"},Y={class:"space-y-2"},Z={class:"flex items-center gap-2 cursor-pointer"},$={class:"flex items-center gap-2 cursor-pointer"},ee={class:"flex items-center gap-2 cursor-pointer"},oe={class:"flex gap-4"},te=["disabled"],se=["disabled"],ne=["disabled"],le={key:4,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm"},re={class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-2xl p-6"},ae={class:"flex items-center justify-between mb-4"},de={key:0,class:"space-y-2"},ie={class:"p-4 bg-muted/30 rounded-lg"},ue={class:"text-sm whitespace-pre-wrap"},be={key:1,class:"text-muted-foreground"};function ce(x,e,k,t,f,v){return a(),r("div",D,[e[39]||(e[39]=o("div",null,[o("h1",{class:"text-3xl font-semibold text-foreground"},"Настройки бота"),o("p",{class:"text-muted-foreground mt-1"},"Настройка подключения Telegram бота и webhook")],-1)),t.loading?(a(),r("div",T,[...e[16]||(e[16]=[o("p",{class:"text-muted-foreground"},"Загрузка настроек...",-1)])])):p("",!0),t.error?(a(),r("div",F,[o("p",L,m(t.error),1)])):p("",!0),t.successMessage?(a(),r("div",R,[o("p",z,m(t.successMessage),1)])):p("",!0),t.loading?p("",!0):(a(),r("form",{key:3,onSubmit:e[14]||(e[14]=B((...s)=>t.saveConfig&&t.saveConfig(...s),["prevent"])),class:"space-y-6"},[o("div",O,[e[24]||(e[24]=o("h2",{class:"text-xl font-semibold mb-4"},"Основные настройки",-1)),o("div",E,[o("div",null,[e[17]||(e[17]=o("label",{class:"text-sm font-medium mb-1 block"},"Bot Token",-1)),l(o("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>t.form.bot_token=s),type:"password",placeholder:"123456789:ABCdefGHIjklMNOpqrsTUVwxyz",class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,512),[[i,t.form.bot_token]]),e[18]||(e[18]=o("p",{class:"text-xs text-muted-foreground mt-1"},"Токен бота от @BotFather",-1))]),o("div",null,[e[19]||(e[19]=o("label",{class:"text-sm font-medium mb-1 block"},"Bot Username",-1)),l(o("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>t.form.bot_username=s),type:"text",placeholder:"my_bot",class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,512),[[i,t.form.bot_username]]),e[20]||(e[20]=o("p",{class:"text-xs text-muted-foreground mt-1"},"Username бота без @",-1))]),o("div",null,[e[21]||(e[21]=o("label",{class:"text-sm font-medium mb-1 block"},"Webhook URL",-1)),l(o("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>t.form.webhook_url=s),type:"url",placeholder:"https://your-domain.com/api/telegram/webhook",class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,512),[[i,t.form.webhook_url]]),e[22]||(e[22]=o("p",{class:"text-xs text-muted-foreground mt-1"},"URL для получения обновлений",-1))]),o("div",null,[e[23]||(e[23]=o("label",{class:"text-sm font-medium mb-1 block"},"Mini App URL",-1)),l(o("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>t.form.mini_app_url=s),type:"url",placeholder:"https://your-domain.com",class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,512),[[i,t.form.mini_app_url]])])])]),o("div",G,[e[29]||(e[29]=o("h2",{class:"text-xl font-semibold mb-4"},"Webhook настройки",-1)),o("div",H,[o("div",null,[e[25]||(e[25]=o("label",{class:"text-sm font-medium mb-1 block"},"Secret Token",-1)),l(o("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>t.form.webhook.secret_token=s),type:"password",placeholder:"your_secret_token",class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,512),[[i,t.form.webhook.secret_token]]),e[26]||(e[26]=o("p",{class:"text-xs text-muted-foreground mt-1"},"Секретный токен для проверки webhook",-1))]),o("div",null,[e[27]||(e[27]=o("label",{class:"text-sm font-medium mb-1 block"},"Max Connections",-1)),l(o("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>t.form.webhook.max_connections=s),type:"number",min:"1",max:"100",class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,512),[[i,t.form.webhook.max_connections,void 0,{number:!0}]])]),o("div",null,[e[28]||(e[28]=o("label",{class:"text-sm font-medium mb-1 block"},"Allowed Updates",-1)),o("div",J,[(a(!0),r(M,null,N(t.availableUpdates,s=>(a(),r("label",{key:s,class:"flex items-center gap-2 cursor-pointer"},[l(o("input",{"onUpdate:modelValue":e[6]||(e[6]=g=>t.form.webhook.allowed_updates=g),type:"checkbox",value:s,class:"w-4 h-4"},null,8,K),[[w,t.form.webhook.allowed_updates]]),o("span",P,m(s),1)]))),128))])])])]),o("div",Q,[e[37]||(e[37]=o("h2",{class:"text-xl font-semibold mb-4"},"Дополнительные настройки",-1)),o("div",X,[o("div",null,[e[30]||(e[30]=o("label",{class:"text-sm font-medium mb-1 block"},"Admin IDs",-1)),l(o("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>t.adminIdsInput=s),type:"text",placeholder:"123456789,987654321",class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,512),[[i,t.adminIdsInput]]),e[31]||(e[31]=o("p",{class:"text-xs text-muted-foreground mt-1"},"ID администраторов через запятую",-1))]),o("div",null,[e[32]||(e[32]=o("label",{class:"text-sm font-medium mb-1 block"},"Required Channels",-1)),l(o("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>t.requiredChannelsInput=s),type:"text",placeholder:"@channel1,@channel2",class:"w-full h-10 px-4 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-accent"},null,512),[[i,t.requiredChannelsInput]]),e[33]||(e[33]=o("p",{class:"text-xs text-muted-foreground mt-1"},"Обязательные каналы через запятую",-1))]),o("div",Y,[o("label",Z,[l(o("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>t.form.notifications.enabled=s),type:"checkbox",class:"w-4 h-4"},null,512),[[w,t.form.notifications.enabled]]),e[34]||(e[34]=o("span",{class:"text-sm"},"Включить уведомления",-1))]),o("label",$,[l(o("input",{"onUpdate:modelValue":e[10]||(e[10]=s=>t.form.rate_limiting.enabled=s),type:"checkbox",class:"w-4 h-4"},null,512),[[w,t.form.rate_limiting.enabled]]),e[35]||(e[35]=o("span",{class:"text-sm"},"Включить rate limiting",-1))]),o("label",ee,[l(o("input",{"onUpdate:modelValue":e[11]||(e[11]=s=>t.form.validation.enabled=s),type:"checkbox",class:"w-4 h-4"},null,512),[[w,t.form.validation.enabled]]),e[36]||(e[36]=o("span",{class:"text-sm"},"Включить валидацию",-1))])])])]),o("div",oe,[o("button",{type:"submit",disabled:t.saving,class:"h-11 px-6 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-2xl shadow-lg shadow-accent/10 inline-flex items-center justify-center gap-2 disabled:opacity-50"},m(t.saving?"Сохранение...":"Сохранить настройки"),9,te),o("button",{type:"button",onClick:e[12]||(e[12]=(...s)=>t.testConnection&&t.testConnection(...s)),disabled:t.testing,class:"h-11 px-6 bg-blue-500/10 text-blue-600 border border-blue-500/40 hover:bg-blue-500/20 rounded-2xl inline-flex items-center justify-center gap-2 disabled:opacity-50"},m(t.testing?"Проверка...":"Тест подключения"),9,se),o("button",{type:"button",onClick:e[13]||(e[13]=(...s)=>t.getWebhookInfo&&t.getWebhookInfo(...s)),disabled:t.loadingWebhook,class:"h-11 px-6 bg-green-500/10 text-green-600 border border-green-500/40 hover:bg-green-500/20 rounded-2xl inline-flex items-center justify-center gap-2 disabled:opacity-50"},m(t.loadingWebhook?"Загрузка...":"Информация о webhook"),9,ne)])],32)),t.showWebhookInfo?(a(),r("div",le,[o("div",re,[o("div",ae,[e[38]||(e[38]=o("h3",{class:"text-lg font-semibold"},"Информация о webhook",-1)),o("button",{onClick:e[15]||(e[15]=s=>t.showWebhookInfo=!1),class:"text-muted-foreground hover:text-foreground"}," ✕ ")]),t.webhookInfo?(a(),r("div",de,[o("div",ie,[o("pre",ue,m(JSON.stringify(t.webhookInfo,null,2)),1)])])):(a(),r("div",be," Загрузка информации... "))])])):p("",!0)])}const ge=j(S,[["render",ce]]);export{ge as default};
